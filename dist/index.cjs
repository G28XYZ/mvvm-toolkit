"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("reflect-metadata");const f=require("./tslib.es6--9daFdVU.cjs"),J=require("lodash"),g=require("mobx"),Se=require("mobx-react"),ne=require("react"),P=(e,t,n)=>Reflect.getOwnMetadata(e,t)||n||{},j=(e,t,n)=>Reflect.defineMetadata(e,t,n);function Me(...e){try{return JSON.stringify(e),!0}catch{return!1}}function be(e){if(e&&typeof e=="string"){let[t]=e.split(`
`)[2].replace(/at (get)?/,"").match(/.*/g)||[];return t&&(t=t.trim()),t}}const fe={},ee=[];let he=!1;const ke=(e,...t)=>{const n=new Error().stack;if(!he)console.log("%c TODO","background: #222; color: #bada55",fe),he=!0;else{const i=be(n);ee.includes(i)===!1&&(ee.push(i),Reflect.set(fe,`${ee.length}) ${e}`,{msg:t,get path(){return console.info(t,i),i}}))}function o(...i){}return o},V=(e,t)=>!!e&&(typeof t=="string"||typeof t=="symbol"),E=e=>!!e&&typeof e=="object"&&"kind"in e,De=e=>({kind:"class",name:e,addInitializer:()=>{},metadata:{}}),q=Symbol("service-key"),se=new Proxy({},Reflect);function pe(e){const t=(o,i)=>{Object.defineProperty(o,i,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,i))return Reflect.get(this,i);const s=K(e,"instance");if(s)return Object.defineProperty(this,i,{value:s,writable:!0,configurable:!0,enumerable:!0}),s},set(s){const r=K(e,"instance");Object.defineProperty(this,i,{value:r??s,writable:!0,configurable:!0,enumerable:!0})}})};function n(o,i){if(V(o,i)){t(o,i);return}return i.addInitializer(function(){return f.__awaiter(this,void 0,void 0,function*(){const s=K(e,"instance");s&&Object.hasOwn(this,i.name)&&Reflect.set(this,i.name,s)})}),s=>s}return n}function K(e,t){var n;const o=P(q,se);if(typeof e!="string"){const i=P(q,e);if(i)return t&&t in i?i[t]:i;for(const s in o){const r=o[s];if(r.target===e){e=r.context.name;break}}}if(typeof e=="string")return t?(n=o[e])===null||n===void 0?void 0:n[t]:o[e]}function de(e,t){const n=(i,s)=>{const r=String(typeof e=="string"&&e||typeof e=="object"&&e?.id||s?.name||i?.name),c=P(q,se),l=new Proxy({target:i,instance:typeof e=="object"&&Reflect.get(e,"transient")||typeof e=="object"&&Reflect.get(e,"lazy")?i:new i,context:s,options:e},{get(u,v,p){var k,w;if(v==="instance"&&(!((k=u?.options)===null||k===void 0)&&k.transient))return new i;if(v==="instance"&&(!((w=u?.options)===null||w===void 0)&&w.lazy)&&u.instance===i){const I=new i;return Reflect.set(u,v,I,p),I}return Reflect.get(u,v,p)},set(u,v,p,k){return Reflect.set(u,v,p,k)}});c[r]=l,j(q,c,se),j(q,c[r],i)};function o(i,s){var r,c;const l=i.__legacy_source__,u=E(s)?s:De((c=(r=l?.name)!==null&&r!==void 0?r:i?.name)!==null&&c!==void 0?c:"");n(i,u),l&&l!==i&&j(q,P(q,i),l)}return J.isFunction(e)?o(e,t):e?(i,s)=>o(i,s):o}const Re=(e,t)=>{const{kind:n="class",name:o="",addInitializer:i=()=>{},metadata:s}=t?.ctx||{};return de(t)(e,{kind:n,name:o,addInitializer:i,metadata:s}),K(e).instance};function te(e){var t,n,o;const i=Object.assign({enumerable:!1,writable:!0},e),s=Object.assign({configurable:!0,enumerable:!1,writable:!0},e),r={configurable:(t=s.configurable)!==null&&t!==void 0?t:!0,enumerable:(n=s.enumerable)!==null&&n!==void 0?n:!1,writable:(o=s.writable)!==null&&o!==void 0?o:!0,value:void 0};return function(c,l){if(V(c,l)){Object.defineProperty(c,l,{configurable:!0,enumerable:i.enumerable,get(){},set(u){r.value=u,Object.defineProperty(this,l,r),r.value=void 0}});return}if(E(l)){const u=l;return u.kind==="field"?function(v){return r.value=v,Object.defineProperty(this,u.name,r),r.value=void 0,v}:(u.addInitializer(function(){const v=Object.getOwnPropertyDescriptor(this,u.name);v&&Object.defineProperty(this,u.name,Object.assign(Object.assign({},v),{enumerable:i.enumerable}))}),c)}}}function je(e,t){return V(e,t)||E(t)?te()(e,t):te(e)}function Pe(e,t){const n=s=>class extends s{constructor(...r){super(...r),g.makeObservable(this)}},o=(s,r)=>{if(typeof Reflect?.getOwnMetadataKeys=="function")for(const c of Reflect.getOwnMetadataKeys(s)){const l=Reflect.getOwnMetadata(c,s);Reflect.defineMetadata(c,l,r)}};function i(s,r){if(!E(r)){const c=s,l=n(c);return Object.defineProperty(l,"__legacy_source__",{value:c,configurable:!0}),o(c,l),l}r.addInitializer(function(){g.makeObservable(this)})}return e&&!E(t)||e?i(e,t):i}const L=Symbol("field-key"),B=Symbol("validation-key"),G=Symbol("submit-key"),Y=Symbol("exclude-key"),Fe=Symbol("prop-from-view-key");class W{isPrototypeObject(t){const n=t?.constructor;return!!(n&&n.prototype===t)}getCacheTarget(t){return!t||typeof t!="object"?null:this.isPrototypeObject(t)?t:Object.getPrototypeOf(t)}computeFromPrototype(t){const n=[],o=new Map,i=new Set;let s=t;for(;s;){const c=Reflect.getOwnMetadata(this.metadataKey,s);if(Array.isArray(c))for(const l of c){const u=l?.name,v=String(u);i.has(v)||(i.add(v),n.push(l),o.set(v,l))}s=Object.getPrototypeOf(s)}return{ownRef:Reflect.getOwnMetadata(this.metadataKey,t),list:n,map:o}}constructor(t={}){this.metadataKey=null,this.isInit=!1,this.cache=new WeakMap,this.name=t?.name,this.callback=t?.callback}isInstance(t={}){return t instanceof W||Object.getOwnPropertyNames(this).some(n=>Object.keys(t).includes(n))}fieldInstance(t,n){const o=n&&typeof n=="object"?Reflect.getOwnMetadata(this.metadataKey,n):void 0;if(Array.isArray(o))return o.find(c=>c.name===t);const i=this.getCacheTarget(n);if(!i)return;const s=Reflect.getOwnMetadata(this.metadataKey,i),r=this.cache.get(i);if(!r||r.ownRef!==s){const c=this.computeFromPrototype(i);return this.cache.set(i,c),c.map.get(String(t))}return r.map.get(String(t))}fields(t){const n=t&&typeof t=="object"?Reflect.getOwnMetadata(this.metadataKey,t):void 0;if(Array.isArray(n)){const c=[],l=new Set;let u=t;for(;u;){const v=Reflect.getOwnMetadata(this.metadataKey,u);if(Array.isArray(v))for(const p of v){const k=p?.name,w=String(k);l.has(w)||(l.add(w),c.push(p))}u=Object.getPrototypeOf(u)}return c}const o=this.getCacheTarget(t);if(!o)return[];const i=Reflect.getOwnMetadata(this.metadataKey,o),s=this.cache.get(o);if(s&&s.ownRef===i)return s.list;const r=this.computeFromPrototype(o);return this.cache.set(o,r),r.list}}class ae extends W{constructor(){super(...arguments),this.metadataKey=B}}class re extends W{constructor(){super(...arguments),this.metadataKey=G}}class oe extends W{constructor(){super(...arguments),this.metadataKey=Y}}class ce extends W{constructor(t={}){super(t),this.factory=null,this.mapping=null,this.noObserve=null,this.collectChanges=!1,this.name=null,this.ctx=null,this.metadataKey=L,this.isInit=!1,this.factory=t.factory,this.mapping=t.mapping,this.noObserve=t.noObserve,this.name=t.name,this.ctx=t.ctx,this.collectChanges=!!t.collectChanges}}class le extends W{constructor(t={}){super(t),this.metadataKey=Fe;for(const n in this)t&&n in t&&(this[n]=Reflect.get(t,n))}}function Ee(e){const t=(i,s)=>{const r=new le({name:e,originName:String(s)});r.name=e,r.originName=String(s);const c=P(r.metadataKey,i,new Array);j(r.metadataKey,[...c,r],i)},n=i=>{i.addInitializer(function(){const s=new le,r=s.fields(this);for(const c in this)r instanceof Array&&i.name===c&&(s.name=e,s.originName=c,s.value=this[c],r.push(s));j(s.metadataKey,r,this)})};function o(i,s){if(V(i,s)){t(i,s);return}if(E(s))return n(s),s.kind==="field"?r=>r:s}return e?((i,s)=>o(i,s)):(i=>i)}const me=new WeakMap,Ie=(e,t)=>{if(!e)return;let n=me.get(e);n||(n=new Set,me.set(e,n));const o=String(t.name);if(n.has(o))return;const i=P(t.metadataKey,e,new Array);i.some(s=>s.name===o)||j(t.metadataKey,[...i,t],e),n.add(o)};function Ce(e){const t=(i,s)=>{const r=new oe({callback:e,name:String(s)}),c=P(r.metadataKey,i,new Array);j(r.metadataKey,[...c,r],i)},n=i=>{i.addInitializer(function(){const s=new oe({callback:e,name:String(i.name)});Ie(Object.getPrototypeOf(this),s)})};function o(i,s){if(V(i,s)){t(i,s);return}if(E(s))return n(s),s.kind==="field"?void 0:s}if(e)return((i,s)=>o(i,s))}const Ae=new re,Ve=new ce,xe=new ae,Te=new oe;let we=(()=>{var e,t,n,o,i,s,r,c,l,u,v,p,k,w,I;let D=[],F,x=[],z=[],C,O,d,A,T,Q,$,N;return e=class{get initData(){return f.__classPrivateFieldGet(this,t,"f")}set initData(a){f.__classPrivateFieldSet(this,t,a,"f")}get committedData(){return f.__classPrivateFieldGet(this,n,"f")}set committedData(a){f.__classPrivateFieldSet(this,n,a,"f")}get modified_(){return f.__classPrivateFieldGet(this,o,"f")}set modified_(a){f.__classPrivateFieldSet(this,o,a,"f")}get legacyInitDone(){return f.__classPrivateFieldGet(this,i,"f")}set legacyInitDone(a){f.__classPrivateFieldSet(this,i,a,"f")}get options(){return f.__classPrivateFieldGet(this,s,"f")}set options(a){f.__classPrivateFieldSet(this,s,a,"f")}get[(t=new WeakMap,n=new WeakMap,o=new WeakMap,i=new WeakMap,s=new WeakMap,r=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,v=(F=[g.observable],L))](){return f.__classPrivateFieldGet(this,r,"f")}set[v](a){f.__classPrivateFieldSet(this,r,a,"f")}get[p=G](){return f.__classPrivateFieldGet(this,c,"f")}set[p](a){f.__classPrivateFieldSet(this,c,a,"f")}get[k=Y](){return f.__classPrivateFieldGet(this,l,"f")}set[k](a){f.__classPrivateFieldSet(this,l,a,"f")}get[w=B](){return f.__classPrivateFieldGet(this,u,"f")}set[w](a){f.__classPrivateFieldSet(this,u,a,"f")}constructor(a={},h){t.set(this,(f.__runInitializers(this,D),f.__runInitializers(this,x,null))),n.set(this,(f.__runInitializers(this,z),{})),o.set(this,{}),i.set(this,!1),s.set(this,{}),r.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),this.options=h,this.init(a),this.initLegacyFields()}getFieldMetaCache(){const a=Reflect.getOwnMetadata(L,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(L,h):null,_=this[L];if(_&&_!==!0&&_.ownRef===a&&_.protoRef===m)return _;const S=Ve.fields(this),y=new Map;for(const b of S)y.set(String(b.name),b);return this[L]={ownRef:a,protoRef:m,list:S,map:y},this[L]}getFieldMeta(a){return this.getFieldMetaCache().map.get(String(a))}getSubmitMetaCache(){const a=Reflect.getOwnMetadata(G,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(G,h):null,_=this[G];if(_&&_!==!0&&_.ownRef===a&&_.protoRef===m)return _;const S=Ae.fields(this),y=new Map;for(const M of S)y.set(String(M.name),M);const b={ownRef:a,protoRef:m,list:S,map:y};return this[G]=b,b}getExcludeMetaCache(){const a=Reflect.getOwnMetadata(Y,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(Y,h):null,_=this[Y];if(_&&_!==!0&&_.ownRef===a&&_.protoRef===m)return _;const S=Te.fields(this),y=new Map;for(const M of S)y.set(String(M.name),M);const b={ownRef:a,protoRef:m,list:S,map:y};return this[Y]=b,b}getValidationMetaCache(){const a=Reflect.getOwnMetadata(B,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(B,h):null,_=this[B];if(_&&_!==!0&&_.ownRef===a&&_.protoRef===m)return _;const S=xe.fields(this),y=new Map;for(const M of S)y.set(String(M.name),M);const b={ownRef:a,protoRef:m,list:S,map:y};return this[B]=b,b}initValidation(a){const h=this.validation;if(a)Reflect.get(h,a);else for(let m in h)h[m]}init(a={}){this.cloneForInit(a),this.defineData(this.initData)}initField(a,h){const m=this.getFieldMeta(a);if(m){const _=String(m.name);Object.prototype.hasOwnProperty.call(this.initData,_)||Reflect.set(this.initData,_,Reflect.get(this,_));let y=m?.factory?m.factory(this.initData,this):Reflect.get(this.initData,_);if(y===void 0&&!m?.factory){const b=Reflect.get(this,_);b!==void 0&&(y=b,Reflect.set(this.initData,_,b))}this.defineFieldValue(a,y,m),h?.skipValidation||this.initValidation(a)}}initLegacyFields(){if(this.legacyInitDone)return;const a=this.getFieldMetaCache().list;if(a.some(h=>Object.prototype.hasOwnProperty.call(this,h.name))){this.legacyInitDone=!0;for(let h of a){const m=String(h.name);this.initData&&m in this.initData||this.initField(m,{skipValidation:!0})}}}createObservable(a,h,m,_=m){return a=g.isObservable(a)?a:g.observable.box(a),new Proxy(a,{get:(S,y,b)=>{const M=Reflect.get(S,y,b);return M&&typeof M=="object"&&!(M instanceof e)&&!g.isObservable(a)?this.createObservable(M,String(y),h,`${_}.${String(y)}`):M},set:(S,y,b,M)=>(a=b,this.checkChange(m,Reflect.get(this,m)),Reflect.set(S,y,b,M))})}defineFieldValue(a,h,m){const _=m??this.getFieldMeta(a);return _.noObserve?Reflect.defineProperty(this,_.name,{value:h}):(h=g.observable.box(h),Reflect.defineProperty(this,_.name,{get:()=>h.get(),set:S=>{g.runInAction(()=>h.set(S)),this.checkChange(_.name,h.get())},enumerable:!0,configurable:!0})),h}cloneForInit(a={}){this.initData=a}checkChange(a,h){const m=Reflect.get(this.committedData,a)||Reflect.get(this.initData,a),_=a&&a in this.initData&&!J.isEqual(m,h);return g.runInAction(()=>{if(_){Reflect.set(this.modified_,a,m);return}a in this.modified_&&J.isEqual(m,h)&&delete this.modified_[a]}),_}defineData(a){const h=this.getFieldMetaCache().map;for(let m in this)Object.prototype.hasOwnProperty.call(this,m)&&h.has(m)&&(Reflect.set(this,m,Reflect.get(a,m)),this.initField(m))}get dirty(){return!J.isEmpty(this.modified_)}commit(){for(let a of this.getFieldMetaCache().list)this.commitField(a.name);this.modified_={}}commitField(a){for(let h in this)h in this.modified_&&Reflect.set(this.committedData,h,this[h]);delete this.modified_[a],this.modified_=Object.assign({},this.modified_)}reject(){for(let a in this)a in this.modified_&&(this[a]=Reflect.get(this.modified_,a),this.commitField(a),this.defineFieldValue(a,this[a]));this.commit()}toInit(){return this.init(this.initData),this}loadData(a){return this.init(a),this}get dumpData(){this.initLegacyFields();const a=Object.create({}),h=this.getSubmitMetaCache().map,m=this.getExcludeMetaCache().map,_=y=>{const b=Reflect.get(this,y),M=h.get(y),Z=M?.callback;return typeof Z=="function"?Z(b,this):b},S=y=>{const b=m.get(y);if(b)switch(typeof b.callback){case"boolean":return!!b.callback;case"function":return b.callback(Reflect.get(this,y),this)}return!1};return this.getFieldMetaCache().list.forEach(y=>{var b;if(y.name in this)return!((b=this.options)===null||b===void 0)&&b.byFields&&!this.options.byFields.includes(y.name)||S(y.name)?void 0:Reflect.set(a,y.name,_(y.name))}),a}get validation(){this.initLegacyFields();const a={};for(const h of this.getValidationMetaCache().list){const m=String(h.name);Reflect.set(a,m,h.callback(Reflect.get(this,m),this)||"")}return a}get validAndDirty(){return this.dirty&&Object.values(this.validation).filter(Boolean).length===0}get serviceApi(){return{loadData:a=>this.loadData(a),reject:()=>this.reject(),commit:()=>this.commit(),commitField:a=>this.commitField(a),toInit:()=>this.toInit()}}get service(){return Object.assign({dirty:this.dirty,dumpData:this.dumpData,validation:this.validation},this.serviceApi)}},(()=>{const R=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;C=[g.computed],O=[g.action],d=[g.action],A=[g.action],T=[g.action],Q=[g.computed],$=[g.computed],N=[(I=g.computed).struct.bind(I)],f.__esDecorate(e,null,F,{kind:"accessor",name:"initData",static:!1,private:!1,access:{has:a=>"initData"in a,get:a=>a.initData,set:(a,h)=>{a.initData=h}},metadata:R},x,z),f.__esDecorate(e,null,C,{kind:"getter",name:"dirty",static:!1,private:!1,access:{has:a=>"dirty"in a,get:a=>a.dirty},metadata:R},null,D),f.__esDecorate(e,null,O,{kind:"method",name:"commit",static:!1,private:!1,access:{has:a=>"commit"in a,get:a=>a.commit},metadata:R},null,D),f.__esDecorate(e,null,d,{kind:"method",name:"commitField",static:!1,private:!1,access:{has:a=>"commitField"in a,get:a=>a.commitField},metadata:R},null,D),f.__esDecorate(e,null,A,{kind:"method",name:"reject",static:!1,private:!1,access:{has:a=>"reject"in a,get:a=>a.reject},metadata:R},null,D),f.__esDecorate(e,null,T,{kind:"method",name:"toInit",static:!1,private:!1,access:{has:a=>"toInit"in a,get:a=>a.toInit},metadata:R},null,D),f.__esDecorate(e,null,Q,{kind:"getter",name:"validation",static:!1,private:!1,access:{has:a=>"validation"in a,get:a=>a.validation},metadata:R},null,D),f.__esDecorate(e,null,$,{kind:"getter",name:"validAndDirty",static:!1,private:!1,access:{has:a=>"validAndDirty"in a,get:a=>a.validAndDirty},metadata:R},null,D),f.__esDecorate(e,null,N,{kind:"getter",name:"service",static:!1,private:!1,access:{has:a=>"service"in a,get:a=>a.service},metadata:R},null,D),R&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:R})})(),e})();const _e=new WeakMap,ze=(e,t)=>{if(!e)return;let n=_e.get(e);n||(n=new Set,_e.set(e,n));const o=String(t.name);if(n.has(o))return;const i=P(t.metadataKey,e,new Array);i.some(s=>s.name===o)||j(t.metadataKey,[...i,t],e),n.add(o)},X=function(t,n){const o=V(t,n)?void 0:t,i=(c,l)=>{const u=new ce(Object.assign(Object.assign({},o),{name:String(l),ctx:null}));j(u.metadataKey,[...P(u.metadataKey,c,new Array),u],c),Object.getOwnPropertyDescriptor(c,l)||Object.defineProperty(c,l,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,l))return Reflect.get(this,l);if(this.initData&&l in this.initData&&typeof this.initField=="function")return this.initField.call(this,String(l),{skipValidation:!0}),Reflect.get(this,l)},set(p){if(this.initData&&!(l in this.initData)&&Reflect.set(this.initData,l,p),typeof this.initField=="function"){this.initField.call(this,String(l),{skipValidation:!0});return}Object.defineProperty(this,l,{value:p,writable:!0,configurable:!0,enumerable:!0})}})},s=c=>{c.addInitializer(function(){if(this instanceof we&&typeof this.initField=="function"){const l=new ce(Object.assign(Object.assign({},o),{name:String(c.name),ctx:c}));ze(Object.getPrototypeOf(this),l),this.initField.call(this,String(c.name))}})};function r(c,l){if(V(c,l)){i(c,l);return}if(E(l))return s(l),l.kind==="field"?u=>u:l}return V(t,n)?r(t,n):o&&!E(n)?(c,l)=>r(c,l):E(n)?r(void 0,n):(c,l)=>r(c,l)},Ke=e=>!e||typeof e!="object"?{noObserve:!0}:Object.assign(Object.assign({},e),{noObserve:!0}),Le=function(t,n){return V(t,n)||E(n)?X({noObserve:!0})(t,n):X(Ke(t))};X.noObserve=Le;const ge=new WeakMap,qe=(e,t)=>{if(!e)return;let n=ge.get(e);n||(n=new Set,ge.set(e,n));const o=String(t.name);if(n.has(o))return;const i=P(t.metadataKey,e,new Array);i.some(s=>s.name===o)||j(t.metadataKey,[...i,t],e),n.add(o)};function We(e){const t=(i,s)=>{const r=new re({callback:e,name:String(s)}),c=P(r.metadataKey,i,new Array);j(r.metadataKey,[...c,r],i)},n=i=>{const s=new re({callback:e,name:String(i.name)});i.addInitializer(function(){qe(Object.getPrototypeOf(this),s)})};function o(i,s){if(V(i,s)){t(i,s);return}if(E(s))return n(s),s.kind==="field"?r=>r:s}return e?((i,s)=>o(i,s)):(i=>i)}const ve=new WeakMap,Be=(e,t)=>{if(!e)return;let n=ve.get(e);n||(n=new Set,ve.set(e,n));const o=String(t.name);if(n.has(o))return;const i=P(t.metadataKey,e,new Array);i.some(s=>s.name===o)||j(t.metadataKey,[...i,t],e),n.add(o)};function Ge(e){const t=(i,s)=>{const r=new ae({callback:e,name:String(s)}),c=P(r.metadataKey,i,new Array);j(r.metadataKey,[...c,r],i)},n=i=>{const s=new ae({callback:e,name:String(i.name)});i.addInitializer(function(){Be(Object.getPrototypeOf(this),s)})};function o(i,s){if(V(i,s)){t(i,s);return}if(E(s))return n(s),s.kind==="field"?r=>r:s}return e?((i,s)=>o(i,s)):(i=>i)}const Ye=e=>({items:e.items.map(t=>{var n,o;return{name:(o=(n=t.constructor)===null||n===void 0?void 0:n.name)!==null&&o!==void 0?o:"Model",data:t.service.dumpData}})});let H=(()=>{var e,t,n;let o=[],i,s=[],r=[],c,l=[],u=[],v,p,k,w,I,D,F,x,z,C;return e=class{get items(){return f.__classPrivateFieldGet(this,t,"f")}set items(d){f.__classPrivateFieldSet(this,t,d,"f")}get _cash(){return f.__classPrivateFieldGet(this,n,"f")}set _cash(d){f.__classPrivateFieldSet(this,n,d,"f")}constructor(){t.set(this,(f.__runInitializers(this,o),f.__runInitializers(this,s,[]))),n.set(this,(f.__runInitializers(this,r),f.__runInitializers(this,l,[]))),this._model=f.__runInitializers(this,u),g.makeObservable(this)}add(d){this.items.push(d)}addMany(d){d?.length&&(this.items=this.items.concat(d))}remove(d){this.items=this.items.filter(A=>A!==d)}find(d){return this.items.find(d)}filter(d){return this.items.filter(d)}findBy(d,A){return this.items.find(T=>T?.[d]===A)}clear(){this.items=[]}get size(){return this.items.length}get snapshot(){return Ye(this)}get cash(){return this._cash}reset(){this.clear()}applyLoaded(d,A={}){const{model:T,mode:Q="replace",cash:$=!0}=A,N=T===void 0?this._model:T;$&&this.setCash(d);const R=N?d.map(a=>new N(a)):d;if(Q==="append"){this.addMany(R);return}this.items=R}setCash(d){this._cash=d??[]}},t=new WeakMap,n=new WeakMap,(()=>{const O=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;i=[g.observable],c=[g.observable],v=[g.action],p=[g.action],k=[g.action],w=[g.action],I=[g.computed],D=[g.computed],F=[g.computed],x=[g.action],z=[g.action],C=[g.action],f.__esDecorate(e,null,i,{kind:"accessor",name:"items",static:!1,private:!1,access:{has:d=>"items"in d,get:d=>d.items,set:(d,A)=>{d.items=A}},metadata:O},s,r),f.__esDecorate(e,null,c,{kind:"accessor",name:"_cash",static:!1,private:!1,access:{has:d=>"_cash"in d,get:d=>d._cash,set:(d,A)=>{d._cash=A}},metadata:O},l,u),f.__esDecorate(e,null,v,{kind:"method",name:"add",static:!1,private:!1,access:{has:d=>"add"in d,get:d=>d.add},metadata:O},null,o),f.__esDecorate(e,null,p,{kind:"method",name:"addMany",static:!1,private:!1,access:{has:d=>"addMany"in d,get:d=>d.addMany},metadata:O},null,o),f.__esDecorate(e,null,k,{kind:"method",name:"remove",static:!1,private:!1,access:{has:d=>"remove"in d,get:d=>d.remove},metadata:O},null,o),f.__esDecorate(e,null,w,{kind:"method",name:"clear",static:!1,private:!1,access:{has:d=>"clear"in d,get:d=>d.clear},metadata:O},null,o),f.__esDecorate(e,null,I,{kind:"getter",name:"size",static:!1,private:!1,access:{has:d=>"size"in d,get:d=>d.size},metadata:O},null,o),f.__esDecorate(e,null,D,{kind:"getter",name:"snapshot",static:!1,private:!1,access:{has:d=>"snapshot"in d,get:d=>d.snapshot},metadata:O},null,o),f.__esDecorate(e,null,F,{kind:"getter",name:"cash",static:!1,private:!1,access:{has:d=>"cash"in d,get:d=>d.cash},metadata:O},null,o),f.__esDecorate(e,null,x,{kind:"method",name:"reset",static:!1,private:!1,access:{has:d=>"reset"in d,get:d=>d.reset},metadata:O},null,o),f.__esDecorate(e,null,z,{kind:"method",name:"applyLoaded",static:!1,private:!1,access:{has:d=>"applyLoaded"in d,get:d=>d.applyLoaded},metadata:O},null,o),f.__esDecorate(e,null,C,{kind:"method",name:"setCash",static:!1,private:!1,access:{has:d=>"setCash"in d,get:d=>d.setCash},metadata:O},null,o),O&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:O})})(),e})();const ue=function(t){return new.target?Reflect.construct(H,[],new.target):class extends H{constructor(){super(),this._model=t}}};ue.prototype=H.prototype;Object.setPrototypeOf(ue,H);function Ne(e){return K(e,"instance")}function Qe(e){return((t,n)=>pe(e)(t,n))}function $e(e,t){const n=(o,i)=>{var s;const r=typeof e=="string"?{id:e}:typeof e=="object"?e:{id:(s=i?.name)!==null&&s!==void 0?s:o?.name};de(r)(o,i)};return typeof e=="function"?n(e,t):(o,i)=>n(o,i)}class Ue{}const ie=new le,Je=e=>typeof Node<"u"&&e instanceof Node,Xe=e=>{if(e==null)return!0;const t=typeof e;return t==="function"?!1:t!=="object"?!0:ne.isValidElement(e)?!1:!Je(e)},He=(e,t)=>{if(!Xe(t))throw new TypeError(`PropFromView only accepts object or primitive values; functions, React elements, and DOM nodes are not allowed for prop "${e}".`)};function Ze(e,t){return Se.observer((n={})=>{const{resolved:o,instance:i}=ne.useMemo(()=>{const r=K(e)||(typeof e!="string"?{instance:new e}:void 0),c=r?.instance;return{resolved:r,instance:c}},[e]);if(ne.useEffect(()=>{if(i)return typeof i.onInit=="function"&&i.onInit(),()=>{typeof i.onDispose=="function"&&i.onDispose()}},[i]),o){const s=ie.fields(i),r=s.length>0?s:ie.fields(Object.getPrototypeOf(i));for(const c in n)if(r instanceof Array){const l=r.find(u=>u.name===c);if(l){const u=Reflect.get(n,c);He(c,u),Reflect.set(i,l.originName,u)}}return j(ie.metadataKey,r,i),t(Object.assign({viewModel:i},n))}return t(Object.assign({},n))})}const ye={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},et={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},U=()=>{};class tt{constructor(t,n){var o,i,s,r,c,l,u;this.isExecuting=!1,this.activeCount=0,this.isCanceled=!1,this.isDisposed=!1,this.error=null,this.controllers=new Set,this.queue=[],this.runningPromise=null,this.queueTail=Promise.resolve(),this.cancelToken=0,this.fn=t,this.opt=Object.assign({concurrency:(o=n?.concurrency)!==null&&o!==void 0?o:"ignore",trackError:(i=n?.trackError)!==null&&i!==void 0?i:!0,resetErrorOnExecute:(s=n?.resetErrorOnExecute)!==null&&s!==void 0?s:!0,swallowError:(r=n?.swallowError)!==null&&r!==void 0?r:!0,abortable:(c=n?.abortable)!==null&&c!==void 0?c:!1},n),this.states=Object.assign(Object.assign({},ye),(l=n?.states)!==null&&l!==void 0?l:{}),this.stateKeys=Object.assign(Object.assign({},et),(u=n?.stateKeys)!==null&&u!==void 0?u:{}),g.makeAutoObservable(this,{fn:!1,opt:!1,states:!1,stateKeys:!1,resolveState:!1,getScope:!1,controllers:!1,queue:!1,runningPromise:!1,queueTail:!1,cancelToken:!1},{autoBind:!0})}get canExecute(){return this.isDisposed||!(this.opt.canExecute?this.opt.canExecute(this.getScope()):!0)?!1:this.opt.concurrency==="ignore"?!this.isExecuting:!0}resolveState(t){var n,o;const i=(n=this.stateKeys[t])!==null&&n!==void 0?n:t;return(o=this.states[i])!==null&&o!==void 0?o:ye[t]}getScope(){return{state:this.state,states:this.states,isExecuting:this.isExecuting,activeCount:this.activeCount,isCanceled:this.isCanceled,isDisposed:this.isDisposed,error:this.error}}get state(){return this.isDisposed?this.resolveState("disposed"):this.isExecuting?this.resolveState("load"):this.error?this.resolveState("failure"):this.isCanceled?this.resolveState("canceled"):this.resolveState("ready")}resetError(){this.error=null}cancel(){var t,n;this.cancelToken+=1,this.isCanceled=!0,(n=(t=this.opt).onCancel)===null||n===void 0||n.call(t),this.opt.cancelQueued&&this.clearQueue();for(const o of this.controllers)o.abort()}dispose(){this.isDisposed||(this.isDisposed=!0,this.clearQueue(),this.cancel())}clearQueue(){if(this.queue.length===0)return;const t=this.queue.splice(0,this.queue.length);for(const n of t)n.canceled=!0,n.settled||(n.settled=!0,n.resolve(void 0))}execute(...t){var n;if(this.isDisposed)return Promise.resolve(void 0);if(!this.canExecute)return(n=this.runningPromise)!==null&&n!==void 0?n:Promise.resolve(void 0);const o=s=>{this.runningPromise=s;const r=()=>{this.runningPromise===s&&(this.runningPromise=null)};return s.then(r,r),s},i=()=>f.__awaiter(this,void 0,void 0,function*(){var s,r,c,l,u,v,p,k;if(this.isDisposed)return;const w=this.opt.abortable?new AbortController:null;w&&this.controllers.add(w),g.runInAction(()=>{this.activeCount+=1,this.isExecuting=this.activeCount>0,this.isCanceled=!1,this.opt.trackError&&this.opt.resetErrorOnExecute&&(this.error=null)});const I=this.cancelToken;let D=!1,F=!1,x=null,z=null;try{(r=(s=this.opt).onStart)===null||r===void 0||r.call(s,...t);const C=this.opt.abortable?w.signal:void 0;z=this.fn(...t,C);const O=yield z;return F=this.cancelToken!==I,F?void 0:((l=(c=this.opt).onSuccess)===null||l===void 0||l.call(c,O,...t),D=!0,O)}catch(C){if(this.opt.abortable&&w?.signal.aborted){g.runInAction(()=>{this.isCanceled=!0}),F=!0,x=null;return}if(x=C,F=this.cancelToken!==I,this.opt.trackError&&g.runInAction(()=>{this.error=C}),(v=(u=this.opt).onError)===null||v===void 0||v.call(u,C),!this.opt.swallowError)throw C;return}finally{g.runInAction(()=>{this.activeCount=Math.max(0,this.activeCount-1),this.isExecuting=this.activeCount>0}),w&&this.controllers.delete(w),!F&&this.cancelToken!==I&&(F=!0),(k=(p=this.opt).onFinally)===null||k===void 0||k.call(p,{ok:D,canceled:F,error:x},...t)}});switch(this.opt.concurrency){case"parallel":return o(i());case"restart":return this.cancel(),o(i());case"queue":{const s=this.opt.queueLimit;if(typeof s=="number"&&s>0&&this.queue.length>=s)return Promise.resolve(void 0);const r={promise:Promise.resolve(void 0),resolve:U,reject:U,canceled:!1,settled:!1},c=this.activeCount===0&&this.queue.length===0;r.promise=new Promise((v,p)=>{r.resolve=v,r.reject=p}),this.queue.push(r);const l=()=>f.__awaiter(this,void 0,void 0,function*(){if(r.settled)return;if(r.canceled||this.isDisposed){r.settled=!0,r.resolve(void 0);return}const v=this.queue.indexOf(r);v>=0&&this.queue.splice(v,1);try{const p=yield i();r.settled||(r.settled=!0,r.resolve(p))}catch(p){r.settled||(r.settled=!0,r.reject(p))}}),u=c?l():this.queueTail.then(l,l);return this.queueTail=u.then(U,U),o(r.promise)}default:return this.isExecuting&&this.runningPromise?this.runningPromise:o(i())}}}function Oe(e,t){return new tt(e,t)}function it(e,t){const n=g.flow(e),o=new Set,i=t?.onCancel;return Oe((...r)=>{const c=n(...r);o.add(c);const l=()=>{o.delete(c)};return c.then(l,l),new Promise((u,v)=>{c.then(u,p=>{if(g.isFlowCancellationError(p)){u(void 0);return}v(p)})})},Object.assign(Object.assign({},t),{onCancel:()=>{var r;for(const c of o)(r=c.cancel)===null||r===void 0||r.call(c);i?.()}}))}function nt(e){return function(...t){return g.runInAction(()=>e.apply(this,t))}}exports.GetService=K;exports.GetStore=Ne;exports.Inject=pe;exports.InjectStore=Qe;exports.MakeObservable=Pe;exports.Model=we;exports.PropFromView=Ee;exports.Service=de;exports.SetService=Re;exports.Store=$e;exports.StoreBase=ue;exports.TODO=ke;exports.ViewModel=Ue;exports.asyncCommand=Oe;exports.commandAction=nt;exports.defineMetadata=j;exports.define_prop=je;exports.exclude=Ce;exports.field=X;exports.flowCommand=it;exports.getExecutingFunctionNameByStack=be;exports.getOwnMetadata=P;exports.isSerializable=Me;exports.submit=We;exports.validation=Ge;exports.view=Ze;
