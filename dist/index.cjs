"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("reflect-metadata");const f=require("./tslib.es6--9daFdVU.cjs"),J=require("lodash"),g=require("mobx"),we=require("mobx-react"),ie=require("react"),P=(e,t,n)=>Reflect.getOwnMetadata(e,t)||n||{},R=(e,t,n)=>Reflect.defineMetadata(e,t,n);function Oe(...e){try{return JSON.stringify(e),!0}catch{return!1}}function ve(e){if(e&&typeof e=="string"){let[t]=e.split(`
`)[2].replace(/at (get)?/,"").match(/.*/g)||[];return t&&(t=t.trim()),t}}const de={},Z=[];let ue=!1;const Se=(e,...t)=>{const n=new Error().stack;if(!ue)console.log("%c TODO","background: #222; color: #bada55",de),ue=!0;else{const i=ve(n);Z.includes(i)===!1&&(Z.push(i),Reflect.set(de,`${Z.length}) ${e}`,{msg:t,get path(){return console.info(t,i),i}}))}function o(...i){}return o},x=(e,t)=>!!e&&(typeof t=="string"||typeof t=="symbol"),E=e=>!!e&&typeof e=="object"&&"kind"in e,Me=e=>({kind:"class",name:e,addInitializer:()=>{},metadata:{}}),q=Symbol("service-key"),ne=new Proxy({},Reflect);function be(e){const t=(o,i)=>{Object.defineProperty(o,i,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,i))return Reflect.get(this,i);const a=K(e,"instance");if(a)return Object.defineProperty(this,i,{value:a,writable:!0,configurable:!0,enumerable:!0}),a},set(a){const r=K(e,"instance");Object.defineProperty(this,i,{value:r??a,writable:!0,configurable:!0,enumerable:!0})}})};function n(o,i){if(x(o,i)){t(o,i);return}return i.addInitializer(function(){return f.__awaiter(this,void 0,void 0,function*(){const a=K(e,"instance");a&&Object.hasOwn(this,i.name)&&Reflect.set(this,i.name,a)})}),a=>a}return n}function K(e,t){var n;const o=P(q,ne);if(typeof e!="string"){const i=P(q,e);if(i)return t&&t in i?i[t]:i;for(const a in o){const r=o[a];if(r.target===e){e=r.context.name;break}}}if(typeof e=="string")return t?(n=o[e])===null||n===void 0?void 0:n[t]:o[e]}function le(e,t){const n=(i,a)=>{const r=String(typeof e=="string"&&e||typeof e=="object"&&e?.id||a?.name||i?.name),c=P(q,ne),d=new Proxy({target:i,instance:typeof e=="object"&&Reflect.get(e,"transient")||typeof e=="object"&&Reflect.get(e,"lazy")?i:new i,context:a,options:e},{get(u,v,p){var k,w;if(v==="instance"&&(!((k=u?.options)===null||k===void 0)&&k.transient))return new i;if(v==="instance"&&(!((w=u?.options)===null||w===void 0)&&w.lazy)&&u.instance===i){const I=new i;return Reflect.set(u,v,I,p),I}return Reflect.get(u,v,p)},set(u,v,p,k){return Reflect.set(u,v,p,k)}});c[r]=d,R(q,c,ne),R(q,c[r],i)};function o(i,a){var r,c;const d=i.__legacy_source__,u=E(a)?a:Me((c=(r=d?.name)!==null&&r!==void 0?r:i?.name)!==null&&c!==void 0?c:"");n(i,u),d&&d!==i&&R(q,P(q,i),d)}return J.isFunction(e)?o(e,t):e?(i,a)=>o(i,a):o}const ke=(e,t)=>{const{kind:n="class",name:o="",addInitializer:i=()=>{},metadata:a}=t?.ctx||{};return le(t)(e,{kind:n,name:o,addInitializer:i,metadata:a}),K(e).instance};function ee(e){var t,n,o;const i=Object.assign({enumerable:!1,writable:!0},e),a=Object.assign({configurable:!0,enumerable:!1,writable:!0},e),r={configurable:(t=a.configurable)!==null&&t!==void 0?t:!0,enumerable:(n=a.enumerable)!==null&&n!==void 0?n:!1,writable:(o=a.writable)!==null&&o!==void 0?o:!0,value:void 0};return function(c,d){if(x(c,d)){Object.defineProperty(c,d,{configurable:!0,enumerable:i.enumerable,get(){},set(u){r.value=u,Object.defineProperty(this,d,r),r.value=void 0}});return}if(E(d)){const u=d;return u.kind==="field"?function(v){return r.value=v,Object.defineProperty(this,u.name,r),r.value=void 0,v}:(u.addInitializer(function(){const v=Object.getOwnPropertyDescriptor(this,u.name);v&&Object.defineProperty(this,u.name,Object.assign(Object.assign({},v),{enumerable:i.enumerable}))}),c)}}}function De(e,t){return x(e,t)||E(t)?ee()(e,t):ee(e)}function Re(e,t){const n=a=>class extends a{constructor(...r){super(...r),g.makeObservable(this)}},o=(a,r)=>{if(typeof Reflect?.getOwnMetadataKeys=="function")for(const c of Reflect.getOwnMetadataKeys(a)){const d=Reflect.getOwnMetadata(c,a);Reflect.defineMetadata(c,d,r)}};function i(a,r){if(!E(r)){const c=a,d=n(c);return Object.defineProperty(d,"__legacy_source__",{value:c,configurable:!0}),o(c,d),d}r.addInitializer(function(){g.makeObservable(this)})}return e&&!E(t)||e?i(e,t):i}const L=Symbol("field-key"),B=Symbol("validation-key"),Y=Symbol("submit-key"),N=Symbol("exclude-key"),je=Symbol("prop-from-view-key");class W{isPrototypeObject(t){const n=t?.constructor;return!!(n&&n.prototype===t)}getCacheTarget(t){return!t||typeof t!="object"?null:this.isPrototypeObject(t)?t:Object.getPrototypeOf(t)}computeFromPrototype(t){const n=[],o=new Map,i=new Set;let a=t;for(;a;){const c=Reflect.getOwnMetadata(this.metadataKey,a);if(Array.isArray(c))for(const d of c){const u=d?.name,v=String(u);i.has(v)||(i.add(v),n.push(d),o.set(v,d))}a=Object.getPrototypeOf(a)}return{ownRef:Reflect.getOwnMetadata(this.metadataKey,t),list:n,map:o}}constructor(t={}){this.metadataKey=null,this.isInit=!1,this.cache=new WeakMap,this.name=t?.name,this.callback=t?.callback}isInstance(t={}){return t instanceof W||Object.getOwnPropertyNames(this).some(n=>Object.keys(t).includes(n))}fieldInstance(t,n){const o=n&&typeof n=="object"?Reflect.getOwnMetadata(this.metadataKey,n):void 0;if(Array.isArray(o))return o.find(c=>c.name===t);const i=this.getCacheTarget(n);if(!i)return;const a=Reflect.getOwnMetadata(this.metadataKey,i),r=this.cache.get(i);if(!r||r.ownRef!==a){const c=this.computeFromPrototype(i);return this.cache.set(i,c),c.map.get(String(t))}return r.map.get(String(t))}fields(t){const n=t&&typeof t=="object"?Reflect.getOwnMetadata(this.metadataKey,t):void 0;if(Array.isArray(n)){const c=[],d=new Set;let u=t;for(;u;){const v=Reflect.getOwnMetadata(this.metadataKey,u);if(Array.isArray(v))for(const p of v){const k=p?.name,w=String(k);d.has(w)||(d.add(w),c.push(p))}u=Object.getPrototypeOf(u)}return c}const o=this.getCacheTarget(t);if(!o)return[];const i=Reflect.getOwnMetadata(this.metadataKey,o),a=this.cache.get(o);if(a&&a.ownRef===i)return a.list;const r=this.computeFromPrototype(o);return this.cache.set(o,r),r.list}}class ae extends W{constructor(){super(...arguments),this.metadataKey=B}}class se extends W{constructor(){super(...arguments),this.metadataKey=Y}}class re extends W{constructor(){super(...arguments),this.metadataKey=N}}class oe extends W{constructor(t={}){super(t),this.factory=null,this.mapping=null,this.noObserve=null,this.collectChanges=!1,this.name=null,this.ctx=null,this.metadataKey=L,this.isInit=!1,this.factory=t.factory,this.mapping=t.mapping,this.noObserve=t.noObserve,this.name=t.name,this.ctx=t.ctx,this.collectChanges=!!t.collectChanges}}class ce extends W{constructor(t={}){super(t),this.metadataKey=je;for(const n in this)t&&n in t&&(this[n]=Reflect.get(t,n))}}function Pe(e){const t=(i,a)=>{const r=new ce({name:e,originName:String(a)});r.name=e,r.originName=String(a);const c=P(r.metadataKey,i,new Array);R(r.metadataKey,[...c,r],i)},n=i=>{i.addInitializer(function(){const a=new ce,r=a.fields(this);for(const c in this)r instanceof Array&&i.name===c&&(a.name=e,a.originName=c,a.value=this[c],r.push(a));R(a.metadataKey,r,this)})};function o(i,a){if(x(i,a)){t(i,a);return}if(E(a))return n(a),a.kind==="field"?r=>r:a}return e?((i,a)=>o(i,a)):(i=>i)}const fe=new WeakMap,Fe=(e,t)=>{if(!e)return;let n=fe.get(e);n||(n=new Set,fe.set(e,n));const o=String(t.name);if(n.has(o))return;const i=P(t.metadataKey,e,new Array);i.some(a=>a.name===o)||R(t.metadataKey,[...i,t],e),n.add(o)};function Ee(e){const t=(i,a)=>{const r=new re({callback:e,name:String(a)}),c=P(r.metadataKey,i,new Array);R(r.metadataKey,[...c,r],i)},n=i=>{i.addInitializer(function(){const a=new re({callback:e,name:String(i.name)});Fe(Object.getPrototypeOf(this),a)})};function o(i,a){if(x(i,a)){t(i,a);return}if(E(a))return n(a),a.kind==="field"?void 0:a}if(e)return((i,a)=>o(i,a))}const Ie=new se,Ae=new oe,Ce=new ae,Ve=new re;let ye=(()=>{var e,t,n,o,i,a,r,c,d,u,v,p,k,w,I;let D=[],F,T=[],z=[],A,O,l,C,V,Q,$,G;return e=class{get initData(){return f.__classPrivateFieldGet(this,t,"f")}set initData(s){f.__classPrivateFieldSet(this,t,s,"f")}get committedData(){return f.__classPrivateFieldGet(this,n,"f")}set committedData(s){f.__classPrivateFieldSet(this,n,s,"f")}get modified_(){return f.__classPrivateFieldGet(this,o,"f")}set modified_(s){f.__classPrivateFieldSet(this,o,s,"f")}get legacyInitDone(){return f.__classPrivateFieldGet(this,i,"f")}set legacyInitDone(s){f.__classPrivateFieldSet(this,i,s,"f")}get options(){return f.__classPrivateFieldGet(this,a,"f")}set options(s){f.__classPrivateFieldSet(this,a,s,"f")}get[(t=new WeakMap,n=new WeakMap,o=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,v=(F=[g.observable],L))](){return f.__classPrivateFieldGet(this,r,"f")}set[v](s){f.__classPrivateFieldSet(this,r,s,"f")}get[p=Y](){return f.__classPrivateFieldGet(this,c,"f")}set[p](s){f.__classPrivateFieldSet(this,c,s,"f")}get[k=N](){return f.__classPrivateFieldGet(this,d,"f")}set[k](s){f.__classPrivateFieldSet(this,d,s,"f")}get[w=B](){return f.__classPrivateFieldGet(this,u,"f")}set[w](s){f.__classPrivateFieldSet(this,u,s,"f")}constructor(s={},h){t.set(this,(f.__runInitializers(this,D),f.__runInitializers(this,T,null))),n.set(this,(f.__runInitializers(this,z),{})),o.set(this,{}),i.set(this,!1),a.set(this,{}),r.set(this,void 0),c.set(this,void 0),d.set(this,void 0),u.set(this,void 0),this.options=h,this.init(s),this.initLegacyFields()}getFieldMetaCache(){const s=Reflect.getOwnMetadata(L,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(L,h):null,_=this[L];if(_&&_!==!0&&_.ownRef===s&&_.protoRef===m)return _;const S=Ae.fields(this),b=new Map;for(const y of S)b.set(String(y.name),y);return this[L]={ownRef:s,protoRef:m,list:S,map:b},this[L]}getFieldMeta(s){return this.getFieldMetaCache().map.get(String(s))}getSubmitMetaCache(){const s=Reflect.getOwnMetadata(Y,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(Y,h):null,_=this[Y];if(_&&_!==!0&&_.ownRef===s&&_.protoRef===m)return _;const S=Ie.fields(this),b=new Map;for(const M of S)b.set(String(M.name),M);const y={ownRef:s,protoRef:m,list:S,map:b};return this[Y]=y,y}getExcludeMetaCache(){const s=Reflect.getOwnMetadata(N,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(N,h):null,_=this[N];if(_&&_!==!0&&_.ownRef===s&&_.protoRef===m)return _;const S=Ve.fields(this),b=new Map;for(const M of S)b.set(String(M.name),M);const y={ownRef:s,protoRef:m,list:S,map:b};return this[N]=y,y}getValidationMetaCache(){const s=Reflect.getOwnMetadata(B,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(B,h):null,_=this[B];if(_&&_!==!0&&_.ownRef===s&&_.protoRef===m)return _;const S=Ce.fields(this),b=new Map;for(const M of S)b.set(String(M.name),M);const y={ownRef:s,protoRef:m,list:S,map:b};return this[B]=y,y}initValidation(s){const h=this.validation;if(s)Reflect.get(h,s);else for(let m in h)h[m]}init(s={}){this.cloneForInit(s),this.defineData(this.initData)}initField(s,h){const m=this.getFieldMeta(s);if(m){const _=String(m.name);Object.prototype.hasOwnProperty.call(this.initData,_)||Reflect.set(this.initData,_,Reflect.get(this,_));let b=m?.factory?m.factory(this.initData,this):Reflect.get(this.initData,_);if(b===void 0&&!m?.factory){const y=Reflect.get(this,_);y!==void 0&&(b=y,Reflect.set(this.initData,_,y))}this.defineFieldValue(s,b,m),h?.skipValidation||this.initValidation(s)}}initLegacyFields(){if(this.legacyInitDone)return;const s=this.getFieldMetaCache().list;if(s.some(h=>Object.prototype.hasOwnProperty.call(this,h.name))){this.legacyInitDone=!0;for(let h of s){const m=String(h.name);this.initData&&m in this.initData||this.initField(m,{skipValidation:!0})}}}createObservable(s,h,m,_=m){return s=g.isObservable(s)?s:g.observable.box(s),new Proxy(s,{get:(S,b,y)=>{const M=Reflect.get(S,b,y);return M&&typeof M=="object"&&!(M instanceof e)&&!g.isObservable(s)?this.createObservable(M,String(b),h,`${_}.${String(b)}`):M},set:(S,b,y,M)=>(s=y,this.checkChange(m,Reflect.get(this,m)),Reflect.set(S,b,y,M))})}defineFieldValue(s,h,m){const _=m??this.getFieldMeta(s);return _.noObserve?Reflect.defineProperty(this,_.name,{value:h}):(h=g.observable.box(h),Reflect.defineProperty(this,_.name,{get:()=>h.get(),set:S=>{g.runInAction(()=>h.set(S)),this.checkChange(_.name,h.get())},enumerable:!0,configurable:!0})),h}cloneForInit(s={}){this.initData=s}checkChange(s,h){const m=Reflect.get(this.committedData,s)||Reflect.get(this.initData,s),_=s&&s in this.initData&&!J.isEqual(m,h);return g.runInAction(()=>{if(_){Reflect.set(this.modified_,s,m);return}s in this.modified_&&J.isEqual(m,h)&&delete this.modified_[s]}),_}defineData(s){const h=this.getFieldMetaCache().map;for(let m in this)Object.prototype.hasOwnProperty.call(this,m)&&h.has(m)&&(Reflect.set(this,m,Reflect.get(s,m)),this.initField(m))}get dirty(){return!J.isEmpty(this.modified_)}commit(){for(let s of this.getFieldMetaCache().list)this.commitField(s.name);this.modified_={}}commitField(s){for(let h in this)h in this.modified_&&Reflect.set(this.committedData,h,this[h]);delete this.modified_[s],this.modified_=Object.assign({},this.modified_)}reject(){for(let s in this)s in this.modified_&&(this[s]=Reflect.get(this.modified_,s),this.commitField(s),this.defineFieldValue(s,this[s]));this.commit()}toInit(){return this.init(this.initData),this}loadData(s){return this.init(s),this}get dumpData(){this.initLegacyFields();const s=Object.create({}),h=this.getSubmitMetaCache().map,m=this.getExcludeMetaCache().map,_=b=>{const y=Reflect.get(this,b),M=h.get(b),H=M?.callback;return typeof H=="function"?H(y,this):y},S=b=>{const y=m.get(b);if(y)switch(typeof y.callback){case"boolean":return!!y.callback;case"function":return y.callback(Reflect.get(this,b),this)}return!1};return this.getFieldMetaCache().list.forEach(b=>{var y;if(b.name in this)return!((y=this.options)===null||y===void 0)&&y.byFields&&!this.options.byFields.includes(b.name)||S(b.name)?void 0:Reflect.set(s,b.name,_(b.name))}),s}get validation(){this.initLegacyFields();const s={};for(const h of this.getValidationMetaCache().list){const m=String(h.name);Reflect.set(s,m,h.callback(Reflect.get(this,m),this)||"")}return s}get validAndDirty(){return this.dirty&&Object.values(this.validation).filter(Boolean).length===0}get serviceApi(){return{loadData:s=>this.loadData(s),reject:()=>this.reject(),commit:()=>this.commit(),commitField:s=>this.commitField(s),toInit:()=>this.toInit()}}get service(){return Object.assign({dirty:this.dirty,dumpData:this.dumpData,validation:this.validation},this.serviceApi)}},(()=>{const j=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;A=[g.computed],O=[g.action],l=[g.action],C=[g.action],V=[g.action],Q=[g.computed],$=[g.computed],G=[(I=g.computed).struct.bind(I)],f.__esDecorate(e,null,F,{kind:"accessor",name:"initData",static:!1,private:!1,access:{has:s=>"initData"in s,get:s=>s.initData,set:(s,h)=>{s.initData=h}},metadata:j},T,z),f.__esDecorate(e,null,A,{kind:"getter",name:"dirty",static:!1,private:!1,access:{has:s=>"dirty"in s,get:s=>s.dirty},metadata:j},null,D),f.__esDecorate(e,null,O,{kind:"method",name:"commit",static:!1,private:!1,access:{has:s=>"commit"in s,get:s=>s.commit},metadata:j},null,D),f.__esDecorate(e,null,l,{kind:"method",name:"commitField",static:!1,private:!1,access:{has:s=>"commitField"in s,get:s=>s.commitField},metadata:j},null,D),f.__esDecorate(e,null,C,{kind:"method",name:"reject",static:!1,private:!1,access:{has:s=>"reject"in s,get:s=>s.reject},metadata:j},null,D),f.__esDecorate(e,null,V,{kind:"method",name:"toInit",static:!1,private:!1,access:{has:s=>"toInit"in s,get:s=>s.toInit},metadata:j},null,D),f.__esDecorate(e,null,Q,{kind:"getter",name:"validation",static:!1,private:!1,access:{has:s=>"validation"in s,get:s=>s.validation},metadata:j},null,D),f.__esDecorate(e,null,$,{kind:"getter",name:"validAndDirty",static:!1,private:!1,access:{has:s=>"validAndDirty"in s,get:s=>s.validAndDirty},metadata:j},null,D),f.__esDecorate(e,null,G,{kind:"getter",name:"service",static:!1,private:!1,access:{has:s=>"service"in s,get:s=>s.service},metadata:j},null,D),j&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:j})})(),e})();const he=new WeakMap,xe=(e,t)=>{if(!e)return;let n=he.get(e);n||(n=new Set,he.set(e,n));const o=String(t.name);if(n.has(o))return;const i=P(t.metadataKey,e,new Array);i.some(a=>a.name===o)||R(t.metadataKey,[...i,t],e),n.add(o)},X=function(t,n){const o=x(t,n)?void 0:t,i=(c,d)=>{const u=new oe(Object.assign(Object.assign({},o),{name:String(d),ctx:null}));R(u.metadataKey,[...P(u.metadataKey,c,new Array),u],c),Object.getOwnPropertyDescriptor(c,d)||Object.defineProperty(c,d,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,d))return Reflect.get(this,d);if(this.initData&&d in this.initData&&typeof this.initField=="function")return this.initField.call(this,String(d),{skipValidation:!0}),Reflect.get(this,d)},set(p){if(this.initData&&!(d in this.initData)&&Reflect.set(this.initData,d,p),typeof this.initField=="function"){this.initField.call(this,String(d),{skipValidation:!0});return}Object.defineProperty(this,d,{value:p,writable:!0,configurable:!0,enumerable:!0})}})},a=c=>{c.addInitializer(function(){if(this instanceof ye&&typeof this.initField=="function"){const d=new oe(Object.assign(Object.assign({},o),{name:String(c.name),ctx:c}));xe(Object.getPrototypeOf(this),d),this.initField.call(this,String(c.name))}})};function r(c,d){if(x(c,d)){i(c,d);return}if(E(d))return a(d),d.kind==="field"?u=>u:d}return x(t,n)?r(t,n):o&&!E(n)?(c,d)=>r(c,d):E(n)?r(void 0,n):(c,d)=>r(c,d)},Te=e=>!e||typeof e!="object"?{noObserve:!0}:Object.assign(Object.assign({},e),{noObserve:!0}),ze=function(t,n){return x(t,n)||E(n)?X({noObserve:!0})(t,n):X(Te(t))};X.noObserve=ze;const me=new WeakMap,Ke=(e,t)=>{if(!e)return;let n=me.get(e);n||(n=new Set,me.set(e,n));const o=String(t.name);if(n.has(o))return;const i=P(t.metadataKey,e,new Array);i.some(a=>a.name===o)||R(t.metadataKey,[...i,t],e),n.add(o)};function Le(e){const t=(i,a)=>{const r=new se({callback:e,name:String(a)}),c=P(r.metadataKey,i,new Array);R(r.metadataKey,[...c,r],i)},n=i=>{const a=new se({callback:e,name:String(i.name)});i.addInitializer(function(){Ke(Object.getPrototypeOf(this),a)})};function o(i,a){if(x(i,a)){t(i,a);return}if(E(a))return n(a),a.kind==="field"?r=>r:a}return e?((i,a)=>o(i,a)):(i=>i)}const _e=new WeakMap,qe=(e,t)=>{if(!e)return;let n=_e.get(e);n||(n=new Set,_e.set(e,n));const o=String(t.name);if(n.has(o))return;const i=P(t.metadataKey,e,new Array);i.some(a=>a.name===o)||R(t.metadataKey,[...i,t],e),n.add(o)};function We(e){const t=(i,a)=>{const r=new ae({callback:e,name:String(a)}),c=P(r.metadataKey,i,new Array);R(r.metadataKey,[...c,r],i)},n=i=>{const a=new ae({callback:e,name:String(i.name)});i.addInitializer(function(){qe(Object.getPrototypeOf(this),a)})};function o(i,a){if(x(i,a)){t(i,a);return}if(E(a))return n(a),a.kind==="field"?r=>r:a}return e?((i,a)=>o(i,a)):(i=>i)}const Ge=e=>({items:e.items.map(t=>{var n,o;return{name:(o=(n=t.constructor)===null||n===void 0?void 0:n.name)!==null&&o!==void 0?o:"Model",data:t.service.dumpData}})});let Be=(()=>{var e,t,n;let o=[],i,a=[],r=[],c,d=[],u=[],v,p,k,w,I,D,F,T,z,A;return e=class{get items(){return f.__classPrivateFieldGet(this,t,"f")}set items(l){f.__classPrivateFieldSet(this,t,l,"f")}get _cash(){return f.__classPrivateFieldGet(this,n,"f")}set _cash(l){f.__classPrivateFieldSet(this,n,l,"f")}constructor(){t.set(this,(f.__runInitializers(this,o),f.__runInitializers(this,a,[]))),n.set(this,(f.__runInitializers(this,r),f.__runInitializers(this,d,[]))),f.__runInitializers(this,u),g.makeObservable(this)}add(l){this.items.push(l)}addMany(l){l?.length&&(this.items=this.items.concat(l))}remove(l){this.items=this.items.filter(C=>C!==l)}find(l){return this.items.find(l)}filter(l){return this.items.filter(l)}findBy(l,C){return this.items.find(V=>V?.[l]===C)}clear(){this.items=[]}get size(){return this.items.length}get snapshot(){return Ge(this)}get cash(){return this._cash}reset(){this.clear()}applyLoaded(l,C={}){const{model:V,mode:Q="replace",cash:$=!0}=C;if($&&this.setCash(l),Q==="append"){const G=V?l.map(j=>new V(j)):l;this.addMany(G);return}this.items=V?l.map(G=>new V(G)):l}setCash(l){this._cash=l??[]}},t=new WeakMap,n=new WeakMap,(()=>{const O=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;i=[g.observable],c=[g.observable],v=[g.action],p=[g.action],k=[g.action],w=[g.action],I=[g.computed],D=[g.computed],F=[g.computed],T=[g.action],z=[g.action],A=[g.action],f.__esDecorate(e,null,i,{kind:"accessor",name:"items",static:!1,private:!1,access:{has:l=>"items"in l,get:l=>l.items,set:(l,C)=>{l.items=C}},metadata:O},a,r),f.__esDecorate(e,null,c,{kind:"accessor",name:"_cash",static:!1,private:!1,access:{has:l=>"_cash"in l,get:l=>l._cash,set:(l,C)=>{l._cash=C}},metadata:O},d,u),f.__esDecorate(e,null,v,{kind:"method",name:"add",static:!1,private:!1,access:{has:l=>"add"in l,get:l=>l.add},metadata:O},null,o),f.__esDecorate(e,null,p,{kind:"method",name:"addMany",static:!1,private:!1,access:{has:l=>"addMany"in l,get:l=>l.addMany},metadata:O},null,o),f.__esDecorate(e,null,k,{kind:"method",name:"remove",static:!1,private:!1,access:{has:l=>"remove"in l,get:l=>l.remove},metadata:O},null,o),f.__esDecorate(e,null,w,{kind:"method",name:"clear",static:!1,private:!1,access:{has:l=>"clear"in l,get:l=>l.clear},metadata:O},null,o),f.__esDecorate(e,null,I,{kind:"getter",name:"size",static:!1,private:!1,access:{has:l=>"size"in l,get:l=>l.size},metadata:O},null,o),f.__esDecorate(e,null,D,{kind:"getter",name:"snapshot",static:!1,private:!1,access:{has:l=>"snapshot"in l,get:l=>l.snapshot},metadata:O},null,o),f.__esDecorate(e,null,F,{kind:"getter",name:"cash",static:!1,private:!1,access:{has:l=>"cash"in l,get:l=>l.cash},metadata:O},null,o),f.__esDecorate(e,null,T,{kind:"method",name:"reset",static:!1,private:!1,access:{has:l=>"reset"in l,get:l=>l.reset},metadata:O},null,o),f.__esDecorate(e,null,z,{kind:"method",name:"applyLoaded",static:!1,private:!1,access:{has:l=>"applyLoaded"in l,get:l=>l.applyLoaded},metadata:O},null,o),f.__esDecorate(e,null,A,{kind:"method",name:"setCash",static:!1,private:!1,access:{has:l=>"setCash"in l,get:l=>l.setCash},metadata:O},null,o),O&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:O})})(),e})();function Ye(e){return K(e,"instance")}function Ne(e){return((t,n)=>be(e)(t,n))}function Qe(e,t){const n=(o,i)=>{var a;const r=typeof e=="string"?{id:e}:typeof e=="object"?e:{id:(a=i?.name)!==null&&a!==void 0?a:o?.name};le(r)(o,i)};return typeof e=="function"?n(e,t):(o,i)=>n(o,i)}class $e{}const te=new ce,Ue=e=>typeof Node<"u"&&e instanceof Node,Je=e=>{if(e==null)return!0;const t=typeof e;return t==="function"?!1:t!=="object"?!0:ie.isValidElement(e)?!1:!Ue(e)},Xe=(e,t)=>{if(!Je(t))throw new TypeError(`PropFromView only accepts object or primitive values; functions, React elements, and DOM nodes are not allowed for prop "${e}".`)};function He(e,t){return we.observer((n={})=>{const{resolved:o,instance:i}=ie.useMemo(()=>{const r=K(e)||(typeof e!="string"?{instance:new e}:void 0),c=r?.instance;return{resolved:r,instance:c}},[e]);if(ie.useEffect(()=>{if(i)return typeof i.onInit=="function"&&i.onInit(),()=>{typeof i.onDispose=="function"&&i.onDispose()}},[i]),o){const a=te.fields(i),r=a.length>0?a:te.fields(Object.getPrototypeOf(i));for(const c in n)if(r instanceof Array){const d=r.find(u=>u.name===c);if(d){const u=Reflect.get(n,c);Xe(c,u),Reflect.set(i,d.originName,u)}}return R(te.metadataKey,r,i),t(Object.assign({viewModel:i},n))}return t(Object.assign({},n))})}const ge={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},Ze={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},U=()=>{};class et{constructor(t,n){var o,i,a,r,c,d,u;this.isExecuting=!1,this.activeCount=0,this.isCanceled=!1,this.isDisposed=!1,this.error=null,this.controllers=new Set,this.queue=[],this.runningPromise=null,this.queueTail=Promise.resolve(),this.cancelToken=0,this.fn=t,this.opt=Object.assign({concurrency:(o=n?.concurrency)!==null&&o!==void 0?o:"ignore",trackError:(i=n?.trackError)!==null&&i!==void 0?i:!0,resetErrorOnExecute:(a=n?.resetErrorOnExecute)!==null&&a!==void 0?a:!0,swallowError:(r=n?.swallowError)!==null&&r!==void 0?r:!0,abortable:(c=n?.abortable)!==null&&c!==void 0?c:!1},n),this.states=Object.assign(Object.assign({},ge),(d=n?.states)!==null&&d!==void 0?d:{}),this.stateKeys=Object.assign(Object.assign({},Ze),(u=n?.stateKeys)!==null&&u!==void 0?u:{}),g.makeAutoObservable(this,{fn:!1,opt:!1,states:!1,stateKeys:!1,resolveState:!1,getScope:!1,controllers:!1,queue:!1,runningPromise:!1,queueTail:!1,cancelToken:!1},{autoBind:!0})}get canExecute(){return this.isDisposed||!(this.opt.canExecute?this.opt.canExecute(this.getScope()):!0)?!1:this.opt.concurrency==="ignore"?!this.isExecuting:!0}resolveState(t){var n,o;const i=(n=this.stateKeys[t])!==null&&n!==void 0?n:t;return(o=this.states[i])!==null&&o!==void 0?o:ge[t]}getScope(){return{state:this.state,states:this.states,isExecuting:this.isExecuting,activeCount:this.activeCount,isCanceled:this.isCanceled,isDisposed:this.isDisposed,error:this.error}}get state(){return this.isDisposed?this.resolveState("disposed"):this.isExecuting?this.resolveState("load"):this.error?this.resolveState("failure"):this.isCanceled?this.resolveState("canceled"):this.resolveState("ready")}resetError(){this.error=null}cancel(){var t,n;this.cancelToken+=1,this.isCanceled=!0,(n=(t=this.opt).onCancel)===null||n===void 0||n.call(t),this.opt.cancelQueued&&this.clearQueue();for(const o of this.controllers)o.abort()}dispose(){this.isDisposed||(this.isDisposed=!0,this.clearQueue(),this.cancel())}clearQueue(){if(this.queue.length===0)return;const t=this.queue.splice(0,this.queue.length);for(const n of t)n.canceled=!0,n.settled||(n.settled=!0,n.resolve(void 0))}execute(...t){var n;if(this.isDisposed)return Promise.resolve(void 0);if(!this.canExecute)return(n=this.runningPromise)!==null&&n!==void 0?n:Promise.resolve(void 0);const o=a=>{this.runningPromise=a;const r=()=>{this.runningPromise===a&&(this.runningPromise=null)};return a.then(r,r),a},i=()=>f.__awaiter(this,void 0,void 0,function*(){var a,r,c,d,u,v,p,k;if(this.isDisposed)return;const w=this.opt.abortable?new AbortController:null;w&&this.controllers.add(w),g.runInAction(()=>{this.activeCount+=1,this.isExecuting=this.activeCount>0,this.isCanceled=!1,this.opt.trackError&&this.opt.resetErrorOnExecute&&(this.error=null)});const I=this.cancelToken;let D=!1,F=!1,T=null,z=null;try{(r=(a=this.opt).onStart)===null||r===void 0||r.call(a,...t);const A=this.opt.abortable?w.signal:void 0;z=this.fn(...t,A);const O=yield z;return F=this.cancelToken!==I,F?void 0:((d=(c=this.opt).onSuccess)===null||d===void 0||d.call(c,O,...t),D=!0,O)}catch(A){if(this.opt.abortable&&w?.signal.aborted){g.runInAction(()=>{this.isCanceled=!0}),F=!0,T=null;return}if(T=A,F=this.cancelToken!==I,this.opt.trackError&&g.runInAction(()=>{this.error=A}),(v=(u=this.opt).onError)===null||v===void 0||v.call(u,A),!this.opt.swallowError)throw A;return}finally{g.runInAction(()=>{this.activeCount=Math.max(0,this.activeCount-1),this.isExecuting=this.activeCount>0}),w&&this.controllers.delete(w),!F&&this.cancelToken!==I&&(F=!0),(k=(p=this.opt).onFinally)===null||k===void 0||k.call(p,{ok:D,canceled:F,error:T},...t)}});switch(this.opt.concurrency){case"parallel":return o(i());case"restart":return this.cancel(),o(i());case"queue":{const a=this.opt.queueLimit;if(typeof a=="number"&&a>0&&this.queue.length>=a)return Promise.resolve(void 0);const r={promise:Promise.resolve(void 0),resolve:U,reject:U,canceled:!1,settled:!1},c=this.activeCount===0&&this.queue.length===0;r.promise=new Promise((v,p)=>{r.resolve=v,r.reject=p}),this.queue.push(r);const d=()=>f.__awaiter(this,void 0,void 0,function*(){if(r.settled)return;if(r.canceled||this.isDisposed){r.settled=!0,r.resolve(void 0);return}const v=this.queue.indexOf(r);v>=0&&this.queue.splice(v,1);try{const p=yield i();r.settled||(r.settled=!0,r.resolve(p))}catch(p){r.settled||(r.settled=!0,r.reject(p))}}),u=c?d():this.queueTail.then(d,d);return this.queueTail=u.then(U,U),o(r.promise)}default:return this.isExecuting&&this.runningPromise?this.runningPromise:o(i())}}}function pe(e,t){return new et(e,t)}function tt(e,t){const n=g.flow(e),o=new Set,i=t?.onCancel;return pe((...r)=>{const c=n(...r);o.add(c);const d=()=>{o.delete(c)};return c.then(d,d),new Promise((u,v)=>{c.then(u,p=>{if(g.isFlowCancellationError(p)){u(void 0);return}v(p)})})},Object.assign(Object.assign({},t),{onCancel:()=>{var r;for(const c of o)(r=c.cancel)===null||r===void 0||r.call(c);i?.()}}))}function it(e){return function(...t){return g.runInAction(()=>e.apply(this,t))}}exports.GetService=K;exports.GetStore=Ye;exports.Inject=be;exports.InjectStore=Ne;exports.MakeObservable=Re;exports.Model=ye;exports.PropFromView=Pe;exports.Service=le;exports.SetService=ke;exports.Store=Qe;exports.StoreBase=Be;exports.TODO=Se;exports.ViewModel=$e;exports.asyncCommand=pe;exports.commandAction=it;exports.defineMetadata=R;exports.define_prop=De;exports.exclude=Ee;exports.field=X;exports.flowCommand=tt;exports.getExecutingFunctionNameByStack=ve;exports.getOwnMetadata=P;exports.isSerializable=Oe;exports.submit=Le;exports.validation=We;exports.view=He;
