"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("reflect-metadata");const h=require("./tslib.es6--9daFdVU.cjs"),X=require("lodash"),y=require("mobx"),U=require("immer"),Ee=require("mobx-react"),ge=require("react"),x=(e,t,a)=>Reflect.getOwnMetadata(e,t)||a||{},R=(e,t,a)=>Reflect.defineMetadata(e,t,a);function Te(...e){try{return JSON.stringify(e),!0}catch{return!1}}function Se(e){if(e&&typeof e=="string"){let[t]=e.split(`
`)[2].replace(/at (get)?/,"").match(/.*/g)||[];return t&&(t=t.trim()),t}}const be={},ae=[];let pe=!1;const je=(e,...t)=>{const a=new Error().stack;if(!pe)console.log("%c TODO","background: #222; color: #bada55",be),pe=!0;else{const s=Se(a);ae.includes(s)===!1&&(ae.push(s),Reflect.set(be,`${ae.length}) ${e}`,{msg:t,get path(){return console.info(t,s),s}}))}function o(...s){}return o},K=(e,t)=>!!e&&(typeof t=="string"||typeof t=="symbol"),H=e=>!!e&&typeof e=="object"&&"kind"in e,Fe=e=>({kind:"class",name:e,addInitializer:()=>{},metadata:{}}),$=Symbol("service-key"),le=new Proxy({},Reflect);function Me(e){const t=(o,s)=>{Object.defineProperty(o,s,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,s))return Reflect.get(this,s);const n=Y(e,"instance");if(n)return Object.defineProperty(this,s,{value:n,writable:!0,configurable:!0,enumerable:!0}),n},set(n){const r=Y(e,"instance");Object.defineProperty(this,s,{value:r??n,writable:!0,configurable:!0,enumerable:!0})}})};function a(o,s){if(K(o,s)){t(o,s);return}return s.addInitializer(function(){return h.__awaiter(this,void 0,void 0,function*(){const n=Y(e,"instance");n&&Object.hasOwn(this,s.name)&&Reflect.set(this,s.name,n)})}),n=>n}return a}function Y(e,t){var a;const o=x($,le);if(typeof e!="string"){const s=x($,e);if(s)return t&&t in s?s[t]:s;for(const n in o){const r=o[n];if(r.target===e){e=r.context.name;break}}}if(typeof e=="string")return t?(a=o[e])===null||a===void 0?void 0:a[t]:o[e]}function ve(e,t){const a=(s,n)=>{const r=String(typeof e=="string"&&e||typeof e=="object"&&e?.id||n?.name||s?.name),l=x($,le),c=new Proxy({target:s,instance:typeof e=="object"&&Reflect.get(e,"transient")||typeof e=="object"&&Reflect.get(e,"lazy")?s:new s,context:n,options:e},{get(u,_,v){var p,b;if(_==="instance"&&(!((p=u?.options)===null||p===void 0)&&p.transient))return new s;if(_==="instance"&&(!((b=u?.options)===null||b===void 0)&&b.lazy)&&u.instance===s){const A=new s;return Reflect.set(u,_,A,v),A}return Reflect.get(u,_,v)},set(u,_,v,p){return Reflect.set(u,_,v,p)}});l[r]=c,R($,l,le),R($,l[r],s)};function o(s,n){var r,l;const c=s.__legacy_source__,u=H(n)?n:Fe((l=(r=c?.name)!==null&&r!==void 0?r:s?.name)!==null&&l!==void 0?l:"");a(s,u),c&&c!==s&&R($,x($,s),c)}return X.isFunction(e)?o(e,t):e?(s,n)=>o(s,n):o}const Ve=(e,t)=>{const{kind:a="class",name:o="",addInitializer:s=()=>{},metadata:n}=t?.ctx||{};return ve(t)(e,{kind:a,name:o,addInitializer:s,metadata:n}),Y(e).instance};function re(e){var t,a,o;const s=Object.assign({enumerable:!1,writable:!0},e),n=Object.assign({configurable:!0,enumerable:!1,writable:!0},e),r={configurable:(t=n.configurable)!==null&&t!==void 0?t:!0,enumerable:(a=n.enumerable)!==null&&a!==void 0?a:!1,writable:(o=n.writable)!==null&&o!==void 0?o:!0,value:void 0};return function(l,c){if(K(l,c)){Object.defineProperty(l,c,{configurable:!0,enumerable:s.enumerable,get(){},set(u){r.value=u,Object.defineProperty(this,c,r),r.value=void 0}});return}if(H(c)){const u=c;return u.kind==="field"?function(_){return r.value=_,Object.defineProperty(this,u.name,r),r.value=void 0,_}:(u.addInitializer(function(){const _=Object.getOwnPropertyDescriptor(this,u.name);_&&Object.defineProperty(this,u.name,Object.assign(Object.assign({},_),{enumerable:s.enumerable}))}),l)}}}function Re(e,t){return K(e,t)||H(t)?re()(e,t):re(e)}function Ce(e,t){const a=n=>class extends n{constructor(...r){super(...r),y.makeObservable(this)}},o=(n,r)=>{if(typeof Reflect?.getOwnMetadataKeys=="function")for(const l of Reflect.getOwnMetadataKeys(n)){const c=Reflect.getOwnMetadata(l,n);Reflect.defineMetadata(l,c,r)}};function s(n,r){if(!H(r)){const l=n,c=a(l);return Object.defineProperty(c,"__legacy_source__",{value:l,configurable:!0}),o(l,c),c}r.addInitializer(function(){y.makeObservable(this)})}return e&&!H(t)||e?s(e,t):s}const xe=Symbol("field-key"),Le=Symbol("validation-key"),ze=Symbol("submit-key"),He=Symbol("exclude-key"),Ke=Symbol("prop-from-view-key");class Q{isPrototypeObject(t){const a=t?.constructor;return!!(a&&a.prototype===t)}getCacheTarget(t){return!t||typeof t!="object"?null:this.isPrototypeObject(t)?t:Object.getPrototypeOf(t)}computeFromPrototype(t){const a=[],o=new Map,s=new Set;let n=t;for(;n;){const l=Reflect.getOwnMetadata(this.metadataKey,n);if(Array.isArray(l))for(const c of l){const u=c?.name,_=String(u);s.has(_)||(s.add(_),a.push(c),o.set(_,c))}n=Object.getPrototypeOf(n)}return{ownRef:Reflect.getOwnMetadata(this.metadataKey,t),list:a,map:o}}constructor(t={}){this.metadataKey=null,this.isInit=!1,this.cache=new WeakMap,this.name=t?.name,this.callback=t?.callback}isInstance(t={}){return t instanceof Q||Object.getOwnPropertyNames(this).some(a=>Object.keys(t).includes(a))}fieldInstance(t,a){const o=a&&typeof a=="object"?Reflect.getOwnMetadata(this.metadataKey,a):void 0;if(Array.isArray(o))return o.find(l=>l.name===t);const s=this.getCacheTarget(a);if(!s)return;const n=Reflect.getOwnMetadata(this.metadataKey,s),r=this.cache.get(s);if(!r||r.ownRef!==n){const l=this.computeFromPrototype(s);return this.cache.set(s,l),l.map.get(String(t))}return r.map.get(String(t))}fields(t){const a=t&&typeof t=="object"?Reflect.getOwnMetadata(this.metadataKey,t):void 0;if(Array.isArray(a)){const l=[],c=new Set;let u=t;for(;u;){const _=Reflect.getOwnMetadata(this.metadataKey,u);if(Array.isArray(_))for(const v of _){const p=v?.name,b=String(p);c.has(b)||(c.add(b),l.push(v))}u=Object.getPrototypeOf(u)}return l}const o=this.getCacheTarget(t);if(!o)return[];const s=Reflect.getOwnMetadata(this.metadataKey,o),n=this.cache.get(o);if(n&&n.ownRef===s)return n.list;const r=this.computeFromPrototype(o);return this.cache.set(o,r),r.list}}class ce extends Q{constructor(){super(...arguments),this.metadataKey=Le}}class de extends Q{constructor(){super(...arguments),this.metadataKey=ze}}class ue extends Q{constructor(){super(...arguments),this.metadataKey=He}}class he extends Q{constructor(t={}){super(t),this.factory=null,this.mapping=null,this.noObserve=null,this.collectChanges=!1,this.name=null,this.ctx=null,this.metadataKey=xe,this.isInit=!1,this.factory=t.factory,this.mapping=t.mapping,this.noObserve=t.noObserve,this.name=t.name,this.ctx=t.ctx,this.collectChanges=!!t.collectChanges}}class fe extends Q{constructor(t={}){super(t),this.metadataKey=Ke;for(const a in this)t&&a in t&&(this[a]=Reflect.get(t,a))}}function Ge(e){const t=(s,n)=>{const r=new fe({name:e,originName:String(n)});r.name=e,r.originName=String(n);const l=x(r.metadataKey,s,new Array);R(r.metadataKey,[...l,r],s)},a=s=>{s.addInitializer(function(){const n=new fe,r=n.fields(this);for(const l in this)r instanceof Array&&s.name===l&&(n.name=e,n.originName=l,n.value=this[l],r.push(n));R(n.metadataKey,r,this)})};function o(s,n){if(K(s,n)){t(s,n);return}if(H(n))return a(n),n.kind==="field"?r=>r:n}return e?((s,n)=>o(s,n)):(s=>s)}function qe(e){const t=(s,n)=>{const r=new ue({callback:e,name:String(n)}),l=x(r.metadataKey,s,new Array);R(r.metadataKey,[...l,r],s)},a=s=>{s.addInitializer(function(){const n=new ue({callback:e,name:String(s.name)}),r=x(n.metadataKey,this,new Array);R(n.metadataKey,[...r,n],this)})};function o(s,n){if(K(s,n)){t(s,n);return}if(H(n))return a(n),n.kind==="field"?void 0:n}if(e)return((s,n)=>o(s,n))}const Be=()=>{var e;return(e=globalThis.__REDUX_DEVTOOLS_EXTENSION__)!==null&&e!==void 0?e:null},Ye=()=>{var e;return(e=globalThis.__MVVM_DEVTOOLS_APPLYING__)!==null&&e!==void 0?e:0},Z=e=>{var t,a;const o=globalThis;o.__MVVM_DEVTOOLS_APPLYING__=((t=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&t!==void 0?t:0)+1;try{return e()}finally{o.__MVVM_DEVTOOLS_APPLYING__=Math.max(0,((a=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&a!==void 0?a:1)-1)}},Ne=()=>Ye()>0,De=e=>({data:e.service.dumpData,historyIndex:e.service.historyIndex}),we=(e,t={})=>{const a=Be();if(!a)return()=>{};const o=a.connect({name:t.name,instanceId:t.instanceId});let s=!1;try{o.init(De(e))}catch{}const n=y.reaction(()=>De(e),l=>{var c;if(!(s||Ne()))try{o.send({type:(c=t.actionType)!==null&&c!==void 0?c:"model:update"},l)}catch{}}),r=o.subscribe(l=>{var c;if(l.type!=="DISPATCH")return;const u=(c=l.payload)===null||c===void 0?void 0:c.type;if(u==="RESET"){s=!0,Z(()=>{try{e.service.toInit()}finally{s=!1}});return}if(u==="COMMIT"){s=!0,Z(()=>{try{e.service.commit()}finally{s=!1}});return}if(u==="ROLLBACK"){s=!0,Z(()=>{try{e.service.toInit()}finally{s=!1}});return}if(u==="JUMP_TO_ACTION"||u==="JUMP_TO_STATE"){if(!l.state)return;try{const _=JSON.parse(l.state),v=_.historyIndex,p=e.service.history,b=Array.isArray(p)&&p.length>0,A=typeof v=="number"&&(v===-1&&b||v>=0&&b&&v<p.length);s=!0,Z(()=>{var O;try{if(A){e.service.goToHistory(v);return}const E=(O=_.data)!==null&&O!==void 0?O:_;y.runInAction(()=>{e.service.loadData(E)})}finally{s=!1}})}catch{}}});return()=>{n(),typeof r=="function"&&r(),typeof o.unsubscribe=="function"&&o.unsubscribe(),typeof o.disconnect=="function"&&o.disconnect()}};U.enablePatches();const We=new de,B=new he,Ue=new ce,$e=new ue;let Ie=(()=>{var e,t,a,o,s,n,r,l,c,u,_,v,p,b,A;let O=[],E,L=[],G=[],F,M,d,D,w,V,k,C,z,N,W,J;return e=class{get[(t=new WeakMap,a=new WeakMap,o=new WeakMap,s=new WeakMap,n=new WeakMap,r=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,_=new WeakMap,v=new WeakMap,p=new WeakMap,b=U.immerable)](){return h.__classPrivateFieldGet(this,t,"f")}set[b](i){h.__classPrivateFieldSet(this,t,i,"f")}get initData(){return h.__classPrivateFieldGet(this,a,"f")}set initData(i){h.__classPrivateFieldSet(this,a,i,"f")}get committedData(){return h.__classPrivateFieldGet(this,o,"f")}set committedData(i){h.__classPrivateFieldSet(this,o,i,"f")}get modified_(){return h.__classPrivateFieldGet(this,s,"f")}set modified_(i){h.__classPrivateFieldSet(this,s,i,"f")}get draft(){return h.__classPrivateFieldGet(this,n,"f")}set draft(i){h.__classPrivateFieldSet(this,n,i,"f")}get changes(){return h.__classPrivateFieldGet(this,r,"f")}set changes(i){h.__classPrivateFieldSet(this,r,i,"f")}get inverseChanges(){return h.__classPrivateFieldGet(this,l,"f")}set inverseChanges(i){h.__classPrivateFieldSet(this,l,i,"f")}get history(){return h.__classPrivateFieldGet(this,c,"f")}set history(i){h.__classPrivateFieldSet(this,c,i,"f")}get historyIndex(){return h.__classPrivateFieldGet(this,u,"f")}set historyIndex(i){h.__classPrivateFieldSet(this,u,i,"f")}get legacyInitDone(){return h.__classPrivateFieldGet(this,_,"f")}set legacyInitDone(i){h.__classPrivateFieldSet(this,_,i,"f")}get options(){return h.__classPrivateFieldGet(this,v,"f")}set options(i){h.__classPrivateFieldSet(this,v,i,"f")}get historyMuted(){return h.__classPrivateFieldGet(this,p,"f")}set historyMuted(i){h.__classPrivateFieldSet(this,p,i,"f")}constructor(i={},f){t.set(this,(h.__runInitializers(this,O),!0)),a.set(this,h.__runInitializers(this,L,null)),o.set(this,(h.__runInitializers(this,G),{})),s.set(this,{}),n.set(this,null),r.set(this,[]),l.set(this,[]),c.set(this,[]),u.set(this,-1),_.set(this,!1),v.set(this,{}),p.set(this,!1),this.options=f,this[U.immerable]=!0,this.init(i),this.initLegacyFields(),this.autoAttachDevtools()}initValidation(i){if(i)Reflect.get(this.validation,i);else for(let f in this.validation)this.validation[f]}init(i={}){this.cloneForInit(i),this.createDraft(i),this.defineData(this.initData)}initField(i,f){const m=B.fieldInstance(i,this);if(m){i in this.initData||Reflect.set(this.initData,i,Reflect.get(this,i));const g=m?.factory?m.factory(this.initData,this):this.initData[m.name];this.defineFieldValue(i,g,m),f?.skipValidation||this.initValidation(i)}}initLegacyFields(){if(this.legacyInitDone)return;const i=B.fields(this);if(i.some(f=>Object.prototype.hasOwnProperty.call(this,f.name))){this.legacyInitDone=!0;for(let f of i)this.initData&&String(f.name)in this.initData||!B.fieldInstance(String(f.name),this)||this.initField(String(f.name),{skipValidation:!0})}}createDraft(i){this.draft=U.createDraft(i)}autoAttachDevtools(){var i,f,m,g,S,j,I,P,q,ie,se;const ne=globalThis;if(!ne.__MVVM_DEVTOOLS_AUTO__||((f=(i=this.options)===null||i===void 0?void 0:i.devtools)===null||f===void 0?void 0:f.enabled)===!1)return;const ye=(I=(S=(g=(m=this.options)===null||m===void 0?void 0:m.devtools)===null||g===void 0?void 0:g.name)!==null&&S!==void 0?S:(j=this.constructor)===null||j===void 0?void 0:j.name)!==null&&I!==void 0?I:"Model",me=((P=ne.__MVVM_DEVTOOLS_SEQ__)!==null&&P!==void 0?P:0)+1;ne.__MVVM_DEVTOOLS_SEQ__=me,we(this,{name:ye,instanceId:(se=(ie=(q=this.options)===null||q===void 0?void 0:q.devtools)===null||ie===void 0?void 0:ie.instanceId)!==null&&se!==void 0?se:`${ye}#${me}`})}withHistoryMuted(i){this.historyMuted=!0;try{i()}finally{this.historyMuted=!1}}syncChangesFromHistory(){const i=this.historyIndex>=0?this.history.slice(0,this.historyIndex+1):[];this.changes=i.flatMap(f=>f.patches),this.inverseChanges=i.flatMap(f=>f.inversePatches)}applyHistoryPatches(i){if(!i.length)return;U.applyPatches(this.draft,i);const f=new Set(i.map(m=>m.field).filter(Boolean));f.size!==0&&this.withHistoryMuted(()=>{var m;for(let g of f){const S=(m=Reflect.get(this.draft,g))!==null&&m!==void 0?m:Reflect.get(this.initData,g);Reflect.set(this,g,S),this.defineFieldValue(g,Reflect.get(this,g))}})}produceDraft(i,f,m){if(this.historyMuted)return;let g,S=[];i&&(g=i.split(".")[0],g&&!B.fieldInstance(g,this).collectChanges)||(U.produce(this.draft,j=>{if(i){let I=j;const P=i.split(".");if(P.length>1)for(let q=0;q<P.length&&!(q!=P.length-1&&!X.isObject(I));q++)X.isObject(I)&&(I=I[P[q]]);else m=i;I&&(I[m]=f)}},(j,I)=>{g&&(j=j.map(P=>Object.assign(Object.assign({},P),{field:g})),I=I.map(P=>Object.assign(Object.assign({},P),{field:g}))),S=j,!(!j.length&&!I.length)&&(this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1),this.syncChangesFromHistory()),this.changes.push(...j),this.inverseChanges.push(...I),this.history.push({patches:j,inversePatches:I}),this.historyIndex=this.history.length-1)}),S.length&&U.applyPatches(this.draft,S))}createObservable(i,f,m,g=m){return i=y.isObservable(i)?i:y.observable.box(i),new Proxy(i,{get:(S,j,I)=>{const P=Reflect.get(S,j,I);return P&&typeof P=="object"&&!(P instanceof e)&&!y.isObservable(i)?this.createObservable(P,String(j),f,`${g}.${String(j)}`):P},set:(S,j,I,P)=>(i=I,this.produceDraft(g,i,String(j)),this.checkChange(m,Reflect.get(this,m)),Reflect.set(S,j,I,P))})}defineFieldValue(i,f,m=B.fieldInstance(i,this)){return m.noObserve?Reflect.defineProperty(this,m.name,{value:f}):(f=y.observable.box(f),Reflect.defineProperty(this,m.name,{get:()=>f.get(),set:g=>{y.runInAction(()=>f.set(g)),this.produceDraft(m.name,f.get()),this.checkChange(m.name,f.get())},enumerable:!0,configurable:!0})),f}cloneForInit(i={}){this.initData=i}checkChange(i,f){const m=Reflect.get(this.committedData,i)||Reflect.get(this.initData,i),g=i&&i in this.initData&&!X.isEqual(m,f);return y.runInAction(()=>{g&&Reflect.set(this.modified_,i,m);for(const S in this.modified_)i===S&&i in this.modified_&&X.isEqual(m,f)&&delete this.modified_[S]}),g}defineData(i){for(let f in this)Object.prototype.hasOwnProperty.call(this,f)&&B.fieldInstance(f,this)&&(Reflect.set(this,f,Reflect.get(i,f)),this.initField(f))}get dirty(){return!X.isEmpty(this.modified_)}commit(){for(let i of B.fields(this))this.commitField(i.name);this.modified_={}}commitField(i){for(let f in this)f in this.modified_&&Reflect.set(this.committedData,f,this[f]);delete this.modified_[i],this.modified_=Object.assign({},this.modified_)}reject(){for(let i in this)i in this.modified_&&(this[i]=Reflect.get(this.modified_,i),this.commitField(i),this.defineFieldValue(i,this[i]));this.commit()}toInit(){return this.withHistoryMuted(()=>{for(let i in this)i in this.initData&&(this[i]=Reflect.get(this.initData,i),this.initField(i));this.init(this.initData)}),this}undo(){this.historyIndex<0||(this.applyHistoryPatches(this.history[this.historyIndex].inversePatches),this.historyIndex-=1,this.syncChangesFromHistory())}redo(){this.historyIndex>=this.history.length-1||(this.historyIndex=this.historyIndex+1,this.applyHistoryPatches(this.history[this.historyIndex].patches),this.syncChangesFromHistory())}goToHistory(i){if(!(i<-1||i>=this.history.length)&&i!==this.historyIndex){for(;this.historyIndex<i;)this.historyIndex=this.historyIndex+1,this.applyHistoryPatches(this.history[this.historyIndex].patches);for(;this.historyIndex>i;)this.applyHistoryPatches(this.history[this.historyIndex].inversePatches),this.historyIndex-=1;this.syncChangesFromHistory()}}loadData(i){return this.withHistoryMuted(()=>{this.init(i),this.defineData(this.initData)}),this}get dumpData(){this.initLegacyFields();const i=Object.create({}),f=g=>{try{return We.fieldInstance(g,this).callback(Reflect.get(this,g),this)}catch{return Reflect.get(this,g)}},m=g=>{const S=$e.fieldInstance(g,this);if(S)switch(typeof S.callback){case"boolean":return!!S.callback;case"function":return S.callback(Reflect.get(this,g),this)}return!1};return B.fields(this).forEach(g=>{var S;if(g.name in this)return!((S=this.options)===null||S===void 0)&&S.byFields&&!this.options.byFields.includes(g.name)||m(g.name)?void 0:Reflect.set(i,g.name,f(g.name))}),i}get validation(){this.initLegacyFields();const i={};for(const f in this){const m=Ue.fieldInstance(f,this);m&&Reflect.set(i,f,m.callback(this[f],this)||"")}return i}get validAndDirty(){return this.dirty&&Object.values(this.validation).filter(Boolean).length===0}get serviceApi(){return{loadData:i=>this.loadData(i),reject:()=>this.reject(),commit:()=>this.commit(),commitField:i=>this.commitField(i),toInit:()=>this.toInit(),undo:()=>this.undo(),redo:()=>this.redo(),goToHistory:i=>this.goToHistory(i)}}get service(){return Object.assign({dirty:this.dirty,dumpData:this.dumpData,validation:this.validation,changes:this.changes,inverseChanges:this.inverseChanges,history:this.history,historyIndex:this.historyIndex},this.serviceApi)}},(()=>{const T=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;E=[y.observable],F=[y.action],M=[y.computed],d=[y.action],D=[y.action],w=[y.action],V=[y.action],k=[y.action],C=[y.action],z=[y.action],N=[y.computed],W=[y.computed],J=[(A=y.computed).struct.bind(A)],h.__esDecorate(e,null,E,{kind:"accessor",name:"initData",static:!1,private:!1,access:{has:i=>"initData"in i,get:i=>i.initData,set:(i,f)=>{i.initData=f}},metadata:T},L,G),h.__esDecorate(e,null,F,{kind:"method",name:"produceDraft",static:!1,private:!1,access:{has:i=>"produceDraft"in i,get:i=>i.produceDraft},metadata:T},null,O),h.__esDecorate(e,null,M,{kind:"getter",name:"dirty",static:!1,private:!1,access:{has:i=>"dirty"in i,get:i=>i.dirty},metadata:T},null,O),h.__esDecorate(e,null,d,{kind:"method",name:"commit",static:!1,private:!1,access:{has:i=>"commit"in i,get:i=>i.commit},metadata:T},null,O),h.__esDecorate(e,null,D,{kind:"method",name:"commitField",static:!1,private:!1,access:{has:i=>"commitField"in i,get:i=>i.commitField},metadata:T},null,O),h.__esDecorate(e,null,w,{kind:"method",name:"reject",static:!1,private:!1,access:{has:i=>"reject"in i,get:i=>i.reject},metadata:T},null,O),h.__esDecorate(e,null,V,{kind:"method",name:"toInit",static:!1,private:!1,access:{has:i=>"toInit"in i,get:i=>i.toInit},metadata:T},null,O),h.__esDecorate(e,null,k,{kind:"method",name:"undo",static:!1,private:!1,access:{has:i=>"undo"in i,get:i=>i.undo},metadata:T},null,O),h.__esDecorate(e,null,C,{kind:"method",name:"redo",static:!1,private:!1,access:{has:i=>"redo"in i,get:i=>i.redo},metadata:T},null,O),h.__esDecorate(e,null,z,{kind:"method",name:"goToHistory",static:!1,private:!1,access:{has:i=>"goToHistory"in i,get:i=>i.goToHistory},metadata:T},null,O),h.__esDecorate(e,null,N,{kind:"getter",name:"validation",static:!1,private:!1,access:{has:i=>"validation"in i,get:i=>i.validation},metadata:T},null,O),h.__esDecorate(e,null,W,{kind:"getter",name:"validAndDirty",static:!1,private:!1,access:{has:i=>"validAndDirty"in i,get:i=>i.validAndDirty},metadata:T},null,O),h.__esDecorate(e,null,J,{kind:"getter",name:"service",static:!1,private:!1,access:{has:i=>"service"in i,get:i=>i.service},metadata:T},null,O),T&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:T})})(),e})();const Qe=()=>{var e;const t=globalThis;return!!((e=t.__MVVM_DEVTOOLS_HISTORY__)!==null&&e!==void 0?e:t.__MVVM_DEVTOOLS_AUTO__)},Je=e=>Qe()?!e||typeof e!="object"?{collectChanges:!0}:"collectChanges"in e?e:Object.assign(Object.assign({},e),{collectChanges:!0}):e,te=function(t,a){const o=Je(K(t,a)?void 0:t),s=(l,c)=>{const u=new he(Object.assign(Object.assign({},o),{name:String(c),ctx:null}));R(u.metadataKey,[...x(u.metadataKey,l,new Array),u],l),Object.getOwnPropertyDescriptor(l,c)||Object.defineProperty(l,c,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,c))return Reflect.get(this,c);if(this.initData&&c in this.initData&&typeof this.initField=="function")return this.initField.call(this,String(c),{skipValidation:!0}),Reflect.get(this,c)},set(v){if(this.initData&&!(c in this.initData)&&Reflect.set(this.initData,c,v),typeof this.initField=="function"){this.initField.call(this,String(c),{skipValidation:!0});return}Object.defineProperty(this,c,{value:v,writable:!0,configurable:!0,enumerable:!0})}})},n=l=>{l.addInitializer(function(){if(this instanceof Ie&&typeof this.initField=="function"){const c=new he(Object.assign(Object.assign({},o),{name:String(l.name),ctx:l}));R(c.metadataKey,[...x(c.metadataKey,this,new Array),c],this),this.initField.call(this,String(l.name))}})};function r(l,c){if(K(l,c)){s(l,c);return}if(H(c))return n(c),c.kind==="field"?u=>u:c}return K(t,a)?r(t,a):o&&!H(a)?(l,c)=>r(l,c):H(a)?r(void 0,a):(l,c)=>r(l,c)},Xe=e=>!e||typeof e!="object"?{noObserve:!0}:Object.assign(Object.assign({},e),{noObserve:!0}),Ze=function(t,a){return K(t,a)||H(a)?te({noObserve:!0})(t,a):te(Xe(t))};te.noObserve=Ze;function et(e){const t=(s,n)=>{const r=new de({callback:e,name:String(n)}),l=x(r.metadataKey,s,new Array);R(r.metadataKey,[...l,r],s)},a=s=>{const n=new de({callback:e,name:String(s.name)});s.addInitializer(function(){const r=x(n.metadataKey,this,new Array);R(n.metadataKey,[...r,n],this)})};function o(s,n){if(K(s,n)){t(s,n);return}if(H(n))return a(n),n.kind==="field"?r=>r:n}return e?((s,n)=>o(s,n)):(s=>s)}function tt(e){const t=(s,n)=>{const r=new ce({callback:e,name:String(n)}),l=x(r.metadataKey,s,new Array);R(r.metadataKey,[...l,r],s)},a=s=>{const n=new ce({callback:e,name:String(s.name)});s.addInitializer(function(){const r=x(n.metadataKey,this,new Array);R(n.metadataKey,[...r,n],this)})};function o(s,n){if(K(s,n)){t(s,n);return}if(H(n))return a(n),n.kind==="field"?r=>r:n}return e?((s,n)=>o(s,n)):(s=>s)}const Ae=Symbol("store-key"),it=()=>{var e;return(e=globalThis.__REDUX_DEVTOOLS_EXTENSION__)!==null&&e!==void 0?e:null},st=()=>{var e;return(e=globalThis.__MVVM_DEVTOOLS_APPLYING__)!==null&&e!==void 0?e:0},nt=e=>{var t,a;const o=globalThis;o.__MVVM_DEVTOOLS_APPLYING__=((t=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&t!==void 0?t:0)+1;try{return e()}finally{o.__MVVM_DEVTOOLS_APPLYING__=Math.max(0,((a=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&a!==void 0?a:1)-1)}},at=()=>st()>0,_e=e=>({items:e.items.map(t=>{var a,o;return{name:(o=(a=t.constructor)===null||a===void 0?void 0:a.name)!==null&&o!==void 0?o:"Model",data:t.service.dumpData,historyIndex:t.service.historyIndex}})}),rt=e=>!!(e&&typeof e=="object"&&Array.isArray(e.items)),ot=e=>{if(!e)return null;try{const t=JSON.parse(e);return rt(t)?t:null}catch{return null}},ke=(e,t={})=>{var a,o;const s=it();if(!s)return()=>{};const n=s.connect({name:t.name,instanceId:t.instanceId});let r=!1,l=(o=(a=e.items[0])===null||a===void 0?void 0:a.constructor)!==null&&o!==void 0?o:null;try{n.init(_e(e))}catch{}const c=y.reaction(()=>_e(e),v=>{var p;if(r||at())return;const b=(p=e.items[0])===null||p===void 0?void 0:p.constructor;b&&(l=b);try{n.send({type:"store:update"},v)}catch{}}),u=v=>(r=!0,nt(()=>{try{return v()}finally{r=!1}})),_=n.subscribe(v=>{var p;if(v.type!=="DISPATCH")return;const b=(p=v.payload)===null||p===void 0?void 0:p.type;if(b==="RESET"||b==="ROLLBACK"){u(()=>e.reset());return}if(b==="JUMP_TO_ACTION"||b==="JUMP_TO_STATE"){const A=ot(v.state);if(!A)return;u(()=>{var O,E,L;if(A.items.length===e.items.length&&e.items.every(D=>{var w,V;return typeof((w=D?.service)===null||w===void 0?void 0:w.goToHistory)=="function"||typeof((V=D?.service)===null||V===void 0?void 0:V.loadData)=="function"})){y.runInAction(()=>{A.items.forEach((D,w)=>{var V;const k=(V=e.items[w])===null||V===void 0?void 0:V.service,C=D.historyIndex,z=k?.history;if(Array.isArray(z)&&z.length>0&&typeof C=="number"&&typeof k?.goToHistory=="function"&&(C===-1&&z.length>0||C<z.length)){k.goToHistory(C);return}typeof k?.loadData=="function"&&k.loadData(D.data)})});return}const F=(E=(O=e.items[0])===null||O===void 0?void 0:O.constructor)!==null&&E!==void 0?E:l,M=A.items.map(D=>D.data);if(F){e.applyLoaded(M,{model:F,cash:!1}),l=F;return}e.applyLoaded(M,{cash:!1});const d=(L=e.items[0])===null||L===void 0?void 0:L.constructor;d&&(l=d)})}});return()=>{c(),typeof _=="function"&&_(),typeof n.unsubscribe=="function"&&n.unsubscribe(),typeof n.disconnect=="function"&&n.disconnect()}};let lt=(()=>{var e,t,a;let o=[],s,n=[],r=[],l,c=[],u=[],_,v,p,b,A,O,E,L,G,F;return e=class{get items(){return h.__classPrivateFieldGet(this,t,"f")}set items(d){h.__classPrivateFieldSet(this,t,d,"f")}get _cash(){return h.__classPrivateFieldGet(this,a,"f")}set _cash(d){h.__classPrivateFieldSet(this,a,d,"f")}constructor(){t.set(this,(h.__runInitializers(this,o),h.__runInitializers(this,n,[]))),a.set(this,(h.__runInitializers(this,r),h.__runInitializers(this,c,[]))),h.__runInitializers(this,u),y.makeObservable(this),this.autoAttachDevtools()}add(d){this.items.push(d)}addMany(d){d?.length&&(this.items=this.items.concat(d))}remove(d){this.items=this.items.filter(D=>D!==d)}find(d){return this.items.find(d)}filter(d){return this.items.filter(d)}findBy(d,D){return this.items.find(w=>w?.[d]===D)}clear(){this.items=[]}get size(){return this.items.length}get snapshot(){return _e(this)}get cash(){return this._cash}reset(){this.clear()}applyLoaded(d,D={}){const{model:w,mode:V="replace",cash:k=!0}=D;if(k&&this.setCash(d),V==="append"){const C=w?d.map(z=>new w(z)):d;this.addMany(C);return}this.items=w?d.map(C=>new w(C)):d}setCash(d){this._cash=d??[]}autoAttachDevtools(){var d,D,w,V,k,C,z,N;const W=globalThis;if(!W.__MVVM_DEVTOOLS_AUTO__)return;const J=x(Ae,this.constructor,{})||{};if(((d=J.devtools)===null||d===void 0?void 0:d.enabled)===!1)return;const T=(k=(w=(D=J.devtools)===null||D===void 0?void 0:D.name)!==null&&w!==void 0?w:(V=this.constructor)===null||V===void 0?void 0:V.name)!==null&&k!==void 0?k:"Store",i=((C=W.__MVVM_DEVTOOLS_STORE_SEQ__)!==null&&C!==void 0?C:0)+1;W.__MVVM_DEVTOOLS_STORE_SEQ__=i;const f=(N=(z=J.devtools)===null||z===void 0?void 0:z.instanceId)!==null&&N!==void 0?N:`${T}#${i}`;ke(this,{name:T,instanceId:f})}},t=new WeakMap,a=new WeakMap,(()=>{const M=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;s=[y.observable],l=[y.observable],_=[y.action],v=[y.action],p=[y.action],b=[y.action],A=[y.computed],O=[y.computed],E=[y.computed],L=[y.action],G=[y.action],F=[y.action],h.__esDecorate(e,null,s,{kind:"accessor",name:"items",static:!1,private:!1,access:{has:d=>"items"in d,get:d=>d.items,set:(d,D)=>{d.items=D}},metadata:M},n,r),h.__esDecorate(e,null,l,{kind:"accessor",name:"_cash",static:!1,private:!1,access:{has:d=>"_cash"in d,get:d=>d._cash,set:(d,D)=>{d._cash=D}},metadata:M},c,u),h.__esDecorate(e,null,_,{kind:"method",name:"add",static:!1,private:!1,access:{has:d=>"add"in d,get:d=>d.add},metadata:M},null,o),h.__esDecorate(e,null,v,{kind:"method",name:"addMany",static:!1,private:!1,access:{has:d=>"addMany"in d,get:d=>d.addMany},metadata:M},null,o),h.__esDecorate(e,null,p,{kind:"method",name:"remove",static:!1,private:!1,access:{has:d=>"remove"in d,get:d=>d.remove},metadata:M},null,o),h.__esDecorate(e,null,b,{kind:"method",name:"clear",static:!1,private:!1,access:{has:d=>"clear"in d,get:d=>d.clear},metadata:M},null,o),h.__esDecorate(e,null,A,{kind:"getter",name:"size",static:!1,private:!1,access:{has:d=>"size"in d,get:d=>d.size},metadata:M},null,o),h.__esDecorate(e,null,O,{kind:"getter",name:"snapshot",static:!1,private:!1,access:{has:d=>"snapshot"in d,get:d=>d.snapshot},metadata:M},null,o),h.__esDecorate(e,null,E,{kind:"getter",name:"cash",static:!1,private:!1,access:{has:d=>"cash"in d,get:d=>d.cash},metadata:M},null,o),h.__esDecorate(e,null,L,{kind:"method",name:"reset",static:!1,private:!1,access:{has:d=>"reset"in d,get:d=>d.reset},metadata:M},null,o),h.__esDecorate(e,null,G,{kind:"method",name:"applyLoaded",static:!1,private:!1,access:{has:d=>"applyLoaded"in d,get:d=>d.applyLoaded},metadata:M},null,o),h.__esDecorate(e,null,F,{kind:"method",name:"setCash",static:!1,private:!1,access:{has:d=>"setCash"in d,get:d=>d.setCash},metadata:M},null,o),M&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:M})})(),e})();function ct(e){return Y(e,"instance")}function dt(e){return((t,a)=>Me(e)(t,a))}function ut(e,t){const a=(o,s)=>{var n;const r=typeof e=="string"?{id:e}:typeof e=="object"?e:{id:(n=s?.name)!==null&&n!==void 0?n:o?.name};R(Ae,r,o),ve(r)(o,s)};return typeof e=="function"?a(e,t):(o,s)=>a(o,s)}class ht{}const oe=new fe;function ft(e,t){return Ee.observer((a={})=>{const{resolved:o,instance:s}=ge.useMemo(()=>{const r=Y(e)||(typeof e!="string"?{instance:new e}:void 0),l=r?.instance;return{resolved:r,instance:l}},[e]);if(ge.useEffect(()=>{if(s)return typeof s.onInit=="function"&&s.onInit(),()=>{typeof s.onDispose=="function"&&s.onDispose()}},[s]),o){const n=oe.fields(s),r=n.length>0?n:oe.fields(Object.getPrototypeOf(s));for(const l in a)if(r instanceof Array){const c=r.find(u=>u.name===l);c&&Reflect.set(s,c.originName,Reflect.get(a,l))}return R(oe.metadataKey,r,s),t(Object.assign({viewModel:s},a))}return t(Object.assign({},a))})}const Oe={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},_t={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},ee=()=>{};class vt{constructor(t,a){var o,s,n,r,l,c,u;this.isExecuting=!1,this.activeCount=0,this.isCanceled=!1,this.isDisposed=!1,this.error=null,this.controllers=new Set,this.queue=[],this.runningPromise=null,this.queueTail=Promise.resolve(),this.cancelToken=0,this.fn=t,this.opt=Object.assign({concurrency:(o=a?.concurrency)!==null&&o!==void 0?o:"ignore",trackError:(s=a?.trackError)!==null&&s!==void 0?s:!0,resetErrorOnExecute:(n=a?.resetErrorOnExecute)!==null&&n!==void 0?n:!0,swallowError:(r=a?.swallowError)!==null&&r!==void 0?r:!0,abortable:(l=a?.abortable)!==null&&l!==void 0?l:!1},a),this.states=Object.assign(Object.assign({},Oe),(c=a?.states)!==null&&c!==void 0?c:{}),this.stateKeys=Object.assign(Object.assign({},_t),(u=a?.stateKeys)!==null&&u!==void 0?u:{}),y.makeAutoObservable(this,{fn:!1,opt:!1,states:!1,stateKeys:!1,resolveState:!1,getScope:!1,controllers:!1,queue:!1,runningPromise:!1,queueTail:!1,cancelToken:!1},{autoBind:!0})}get canExecute(){return this.isDisposed||!(this.opt.canExecute?this.opt.canExecute(this.getScope()):!0)?!1:this.opt.concurrency==="ignore"?!this.isExecuting:!0}resolveState(t){var a,o;const s=(a=this.stateKeys[t])!==null&&a!==void 0?a:t;return(o=this.states[s])!==null&&o!==void 0?o:Oe[t]}getScope(){return{state:this.state,states:this.states,isExecuting:this.isExecuting,activeCount:this.activeCount,isCanceled:this.isCanceled,isDisposed:this.isDisposed,error:this.error}}get state(){return this.isDisposed?this.resolveState("disposed"):this.isExecuting?this.resolveState("load"):this.error?this.resolveState("failure"):this.isCanceled?this.resolveState("canceled"):this.resolveState("ready")}resetError(){this.error=null}cancel(){var t,a;this.cancelToken+=1,this.isCanceled=!0,(a=(t=this.opt).onCancel)===null||a===void 0||a.call(t),this.opt.cancelQueued&&this.clearQueue();for(const o of this.controllers)o.abort()}dispose(){this.isDisposed||(this.isDisposed=!0,this.clearQueue(),this.cancel())}clearQueue(){if(this.queue.length===0)return;const t=this.queue.splice(0,this.queue.length);for(const a of t)a.canceled=!0,a.settled||(a.settled=!0,a.resolve(void 0))}execute(...t){var a;if(this.isDisposed)return Promise.resolve(void 0);if(!this.canExecute)return(a=this.runningPromise)!==null&&a!==void 0?a:Promise.resolve(void 0);const o=n=>{this.runningPromise=n;const r=()=>{this.runningPromise===n&&(this.runningPromise=null)};return n.then(r,r),n},s=()=>h.__awaiter(this,void 0,void 0,function*(){var n,r,l,c,u,_,v,p;if(this.isDisposed)return;const b=this.opt.abortable?new AbortController:null;b&&this.controllers.add(b),y.runInAction(()=>{this.activeCount+=1,this.isExecuting=this.activeCount>0,this.isCanceled=!1,this.opt.trackError&&this.opt.resetErrorOnExecute&&(this.error=null)});const A=this.cancelToken;let O=!1,E=!1,L=null,G=null;try{(r=(n=this.opt).onStart)===null||r===void 0||r.call(n,...t);const F=this.opt.abortable?b.signal:void 0;G=this.fn(...t,F);const M=yield G;return E=this.cancelToken!==A,E?void 0:((c=(l=this.opt).onSuccess)===null||c===void 0||c.call(l,M,...t),O=!0,M)}catch(F){if(this.opt.abortable&&b?.signal.aborted){y.runInAction(()=>{this.isCanceled=!0}),E=!0,L=null;return}if(L=F,E=this.cancelToken!==A,this.opt.trackError&&y.runInAction(()=>{this.error=F}),(_=(u=this.opt).onError)===null||_===void 0||_.call(u,F),!this.opt.swallowError)throw F;return}finally{y.runInAction(()=>{this.activeCount=Math.max(0,this.activeCount-1),this.isExecuting=this.activeCount>0}),b&&this.controllers.delete(b),!E&&this.cancelToken!==A&&(E=!0),(p=(v=this.opt).onFinally)===null||p===void 0||p.call(v,{ok:O,canceled:E,error:L},...t)}});switch(this.opt.concurrency){case"parallel":return o(s());case"restart":return this.cancel(),o(s());case"queue":{const n=this.opt.queueLimit;if(typeof n=="number"&&n>0&&this.queue.length>=n)return Promise.resolve(void 0);const r={promise:Promise.resolve(void 0),resolve:ee,reject:ee,canceled:!1,settled:!1},l=this.activeCount===0&&this.queue.length===0;r.promise=new Promise((_,v)=>{r.resolve=_,r.reject=v}),this.queue.push(r);const c=()=>h.__awaiter(this,void 0,void 0,function*(){if(r.settled)return;if(r.canceled||this.isDisposed){r.settled=!0,r.resolve(void 0);return}const _=this.queue.indexOf(r);_>=0&&this.queue.splice(_,1);try{const v=yield s();r.settled||(r.settled=!0,r.resolve(v))}catch(v){r.settled||(r.settled=!0,r.reject(v))}}),u=l?c():this.queueTail.then(c,c);return this.queueTail=u.then(ee,ee),o(r.promise)}default:return this.isExecuting&&this.runningPromise?this.runningPromise:o(s())}}}function Pe(e,t){return new vt(e,t)}function yt(e,t){const a=y.flow(e),o=new Set,s=t?.onCancel;return Pe((...r)=>{const l=a(...r);o.add(l);const c=()=>{o.delete(l)};return l.then(c,c),new Promise((u,_)=>{l.then(u,v=>{if(y.isFlowCancellationError(v)){u(void 0);return}_(v)})})},Object.assign(Object.assign({},t),{onCancel:()=>{var r;for(const l of o)(r=l.cancel)===null||r===void 0||r.call(l);s?.()}}))}function mt(e){return function(...t){return y.runInAction(()=>e.apply(this,t))}}exports.GetService=Y;exports.GetStore=ct;exports.Inject=Me;exports.InjectStore=dt;exports.MakeObservable=Ce;exports.Model=Ie;exports.PropFromView=Ge;exports.Service=ve;exports.SetService=Ve;exports.Store=ut;exports.StoreBase=lt;exports.TODO=je;exports.ViewModel=ht;exports.asyncCommand=Pe;exports.attachModelDevtools=we;exports.attachStoreDevtools=ke;exports.commandAction=mt;exports.defineMetadata=R;exports.define_prop=Re;exports.exclude=qe;exports.field=te;exports.flowCommand=yt;exports.getExecutingFunctionNameByStack=Se;exports.getOwnMetadata=x;exports.isSerializable=Te;exports.submit=et;exports.validation=tt;exports.view=ft;
//# sourceMappingURL=index.cjs.map
