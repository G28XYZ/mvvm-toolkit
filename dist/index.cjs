"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("reflect-metadata");const f=require("./tslib.es6--9daFdVU.cjs"),J=require("lodash"),g=require("mobx"),we=require("mobx-react"),le=require("react"),P=(t,e,n)=>Reflect.getOwnMetadata(t,e)||n||{},R=(t,e,n)=>Reflect.defineMetadata(t,e,n);function Oe(...t){try{return JSON.stringify(t),!0}catch{return!1}}function ve(t){if(t&&typeof t=="string"){let[e]=t.split(`
`)[2].replace(/at (get)?/,"").match(/.*/g)||[];return e&&(e=e.trim()),e}}const de={},Z=[];let ue=!1;const Se=(t,...e)=>{const n=new Error().stack;if(!ue)console.log("%c TODO","background: #222; color: #bada55",de),ue=!0;else{const i=ve(n);Z.includes(i)===!1&&(Z.push(i),Reflect.set(de,`${Z.length}) ${t}`,{msg:e,get path(){return console.info(e,i),i}}))}function o(...i){}return o},z=(t,e)=>!!t&&(typeof e=="string"||typeof e=="symbol"),E=t=>!!t&&typeof t=="object"&&"kind"in t,Me=t=>({kind:"class",name:t,addInitializer:()=>{},metadata:{}}),q=Symbol("service-key"),ie=new Proxy({},Reflect);function be(t){const e=(o,i)=>{Object.defineProperty(o,i,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,i))return Reflect.get(this,i);const a=K(t,"instance");if(a)return Object.defineProperty(this,i,{value:a,writable:!0,configurable:!0,enumerable:!0}),a},set(a){const r=K(t,"instance");Object.defineProperty(this,i,{value:r??a,writable:!0,configurable:!0,enumerable:!0})}})};function n(o,i){if(z(o,i)){e(o,i);return}return i.addInitializer(function(){return f.__awaiter(this,void 0,void 0,function*(){const a=K(t,"instance");a&&Object.hasOwn(this,i.name)&&Reflect.set(this,i.name,a)})}),a=>a}return n}function K(t,e){var n;const o=P(q,ie);if(typeof t!="string"){const i=P(q,t);if(i)return e&&e in i?i[e]:i;for(const a in o){const r=o[a];if(r.target===t){t=r.context.name;break}}}if(typeof t=="string")return e?(n=o[t])===null||n===void 0?void 0:n[e]:o[t]}function ce(t,e){const n=(i,a)=>{const r=String(typeof t=="string"&&t||typeof t=="object"&&t?.id||a?.name||i?.name),c=P(q,ie),d=new Proxy({target:i,instance:typeof t=="object"&&Reflect.get(t,"transient")||typeof t=="object"&&Reflect.get(t,"lazy")?i:new i,context:a,options:t},{get(u,v,p){var k,w;if(v==="instance"&&(!((k=u?.options)===null||k===void 0)&&k.transient))return new i;if(v==="instance"&&(!((w=u?.options)===null||w===void 0)&&w.lazy)&&u.instance===i){const I=new i;return Reflect.set(u,v,I,p),I}return Reflect.get(u,v,p)},set(u,v,p,k){return Reflect.set(u,v,p,k)}});c[r]=d,R(q,c,ie),R(q,c[r],i)};function o(i,a){var r,c;const d=i.__legacy_source__,u=E(a)?a:Me((c=(r=d?.name)!==null&&r!==void 0?r:i?.name)!==null&&c!==void 0?c:"");n(i,u),d&&d!==i&&R(q,P(q,i),d)}return J.isFunction(t)?o(t,e):t?(i,a)=>o(i,a):o}const ke=(t,e)=>{const{kind:n="class",name:o="",addInitializer:i=()=>{},metadata:a}=e?.ctx||{};return ce(e)(t,{kind:n,name:o,addInitializer:i,metadata:a}),K(t).instance};function ee(t){var e,n,o;const i=Object.assign({enumerable:!1,writable:!0},t),a=Object.assign({configurable:!0,enumerable:!1,writable:!0},t),r={configurable:(e=a.configurable)!==null&&e!==void 0?e:!0,enumerable:(n=a.enumerable)!==null&&n!==void 0?n:!1,writable:(o=a.writable)!==null&&o!==void 0?o:!0,value:void 0};return function(c,d){if(z(c,d)){Object.defineProperty(c,d,{configurable:!0,enumerable:i.enumerable,get(){},set(u){r.value=u,Object.defineProperty(this,d,r),r.value=void 0}});return}if(E(d)){const u=d;return u.kind==="field"?function(v){return r.value=v,Object.defineProperty(this,u.name,r),r.value=void 0,v}:(u.addInitializer(function(){const v=Object.getOwnPropertyDescriptor(this,u.name);v&&Object.defineProperty(this,u.name,Object.assign(Object.assign({},v),{enumerable:i.enumerable}))}),c)}}}function De(t,e){return z(t,e)||E(e)?ee()(t,e):ee(t)}function Re(t,e){const n=a=>class extends a{constructor(...r){super(...r),g.makeObservable(this)}},o=(a,r)=>{if(typeof Reflect?.getOwnMetadataKeys=="function")for(const c of Reflect.getOwnMetadataKeys(a)){const d=Reflect.getOwnMetadata(c,a);Reflect.defineMetadata(c,d,r)}};function i(a,r){if(!E(r)){const c=a,d=n(c);return Object.defineProperty(d,"__legacy_source__",{value:c,configurable:!0}),o(c,d),d}r.addInitializer(function(){g.makeObservable(this)})}return t&&!E(e)||t?i(t,e):i}const L=Symbol("field-key"),B=Symbol("validation-key"),Y=Symbol("submit-key"),Q=Symbol("exclude-key"),je=Symbol("prop-from-view-key");class W{isPrototypeObject(e){const n=e?.constructor;return!!(n&&n.prototype===e)}getCacheTarget(e){return!e||typeof e!="object"?null:this.isPrototypeObject(e)?e:Object.getPrototypeOf(e)}computeFromPrototype(e){const n=[],o=new Map,i=new Set;let a=e;for(;a;){const c=Reflect.getOwnMetadata(this.metadataKey,a);if(Array.isArray(c))for(const d of c){const u=d?.name,v=String(u);i.has(v)||(i.add(v),n.push(d),o.set(v,d))}a=Object.getPrototypeOf(a)}return{ownRef:Reflect.getOwnMetadata(this.metadataKey,e),list:n,map:o}}constructor(e={}){this.metadataKey=null,this.isInit=!1,this.cache=new WeakMap,this.name=e?.name,this.callback=e?.callback}isInstance(e={}){return e instanceof W||Object.getOwnPropertyNames(this).some(n=>Object.keys(e).includes(n))}fieldInstance(e,n){const o=n&&typeof n=="object"?Reflect.getOwnMetadata(this.metadataKey,n):void 0;if(Array.isArray(o))return o.find(c=>c.name===e);const i=this.getCacheTarget(n);if(!i)return;const a=Reflect.getOwnMetadata(this.metadataKey,i),r=this.cache.get(i);if(!r||r.ownRef!==a){const c=this.computeFromPrototype(i);return this.cache.set(i,c),c.map.get(String(e))}return r.map.get(String(e))}fields(e){const n=e&&typeof e=="object"?Reflect.getOwnMetadata(this.metadataKey,e):void 0;if(Array.isArray(n)){const c=[],d=new Set;let u=e;for(;u;){const v=Reflect.getOwnMetadata(this.metadataKey,u);if(Array.isArray(v))for(const p of v){const k=p?.name,w=String(k);d.has(w)||(d.add(w),c.push(p))}u=Object.getPrototypeOf(u)}return c}const o=this.getCacheTarget(e);if(!o)return[];const i=Reflect.getOwnMetadata(this.metadataKey,o),a=this.cache.get(o);if(a&&a.ownRef===i)return a.list;const r=this.computeFromPrototype(o);return this.cache.set(o,r),r.list}}class ne extends W{constructor(){super(...arguments),this.metadataKey=B}}class ae extends W{constructor(){super(...arguments),this.metadataKey=Y}}class se extends W{constructor(){super(...arguments),this.metadataKey=Q}}class re extends W{constructor(e={}){super(e),this.factory=null,this.mapping=null,this.noObserve=null,this.collectChanges=!1,this.name=null,this.ctx=null,this.metadataKey=L,this.isInit=!1,this.factory=e.factory,this.mapping=e.mapping,this.noObserve=e.noObserve,this.name=e.name,this.ctx=e.ctx,this.collectChanges=!!e.collectChanges}}class oe extends W{constructor(e={}){super(e),this.metadataKey=je;for(const n in this)e&&n in e&&(this[n]=Reflect.get(e,n))}}function Pe(t){const e=(i,a)=>{const r=new oe({name:t,originName:String(a)});r.name=t,r.originName=String(a);const c=P(r.metadataKey,i,new Array);R(r.metadataKey,[...c,r],i)},n=i=>{i.addInitializer(function(){const a=new oe,r=a.fields(this);for(const c in this)r instanceof Array&&i.name===c&&(a.name=t,a.originName=c,a.value=this[c],r.push(a));R(a.metadataKey,r,this)})};function o(i,a){if(z(i,a)){e(i,a);return}if(E(a))return n(a),a.kind==="field"?r=>r:a}return t?((i,a)=>o(i,a)):(i=>i)}const fe=new WeakMap,Fe=(t,e)=>{if(!t)return;let n=fe.get(t);n||(n=new Set,fe.set(t,n));const o=String(e.name);if(n.has(o))return;const i=P(e.metadataKey,t,new Array);i.some(a=>a.name===o)||R(e.metadataKey,[...i,e],t),n.add(o)};function Ee(t){const e=(i,a)=>{const r=new se({callback:t,name:String(a)}),c=P(r.metadataKey,i,new Array);R(r.metadataKey,[...c,r],i)},n=i=>{i.addInitializer(function(){const a=new se({callback:t,name:String(i.name)});Fe(Object.getPrototypeOf(this),a)})};function o(i,a){if(z(i,a)){e(i,a);return}if(E(a))return n(a),a.kind==="field"?void 0:a}if(t)return((i,a)=>o(i,a))}const Ie=new ae,Ae=new re,Ce=new ne,xe=new se;let ye=(()=>{var t,e,n,o,i,a,r,c,d,u,v,p,k,w,I;let D=[],F,T=[],V=[],A,O,l,C,x,U,$,G;return t=class{get initData(){return f.__classPrivateFieldGet(this,e,"f")}set initData(s){f.__classPrivateFieldSet(this,e,s,"f")}get committedData(){return f.__classPrivateFieldGet(this,n,"f")}set committedData(s){f.__classPrivateFieldSet(this,n,s,"f")}get modified_(){return f.__classPrivateFieldGet(this,o,"f")}set modified_(s){f.__classPrivateFieldSet(this,o,s,"f")}get legacyInitDone(){return f.__classPrivateFieldGet(this,i,"f")}set legacyInitDone(s){f.__classPrivateFieldSet(this,i,s,"f")}get options(){return f.__classPrivateFieldGet(this,a,"f")}set options(s){f.__classPrivateFieldSet(this,a,s,"f")}get[(e=new WeakMap,n=new WeakMap,o=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,v=(F=[g.observable],L))](){return f.__classPrivateFieldGet(this,r,"f")}set[v](s){f.__classPrivateFieldSet(this,r,s,"f")}get[p=Y](){return f.__classPrivateFieldGet(this,c,"f")}set[p](s){f.__classPrivateFieldSet(this,c,s,"f")}get[k=Q](){return f.__classPrivateFieldGet(this,d,"f")}set[k](s){f.__classPrivateFieldSet(this,d,s,"f")}get[w=B](){return f.__classPrivateFieldGet(this,u,"f")}set[w](s){f.__classPrivateFieldSet(this,u,s,"f")}constructor(s={},h){e.set(this,(f.__runInitializers(this,D),f.__runInitializers(this,T,null))),n.set(this,(f.__runInitializers(this,V),{})),o.set(this,{}),i.set(this,!1),a.set(this,{}),r.set(this,void 0),c.set(this,void 0),d.set(this,void 0),u.set(this,void 0),this.options=h,this.init(s),this.initLegacyFields()}getFieldMetaCache(){const s=Reflect.getOwnMetadata(L,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(L,h):null,_=this[L];if(_&&_!==!0&&_.ownRef===s&&_.protoRef===m)return _;const S=Ae.fields(this),b=new Map;for(const y of S)b.set(String(y.name),y);return this[L]={ownRef:s,protoRef:m,list:S,map:b},this[L]}getFieldMeta(s){return this.getFieldMetaCache().map.get(String(s))}getSubmitMetaCache(){const s=Reflect.getOwnMetadata(Y,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(Y,h):null,_=this[Y];if(_&&_!==!0&&_.ownRef===s&&_.protoRef===m)return _;const S=Ie.fields(this),b=new Map;for(const M of S)b.set(String(M.name),M);const y={ownRef:s,protoRef:m,list:S,map:b};return this[Y]=y,y}getExcludeMetaCache(){const s=Reflect.getOwnMetadata(Q,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(Q,h):null,_=this[Q];if(_&&_!==!0&&_.ownRef===s&&_.protoRef===m)return _;const S=xe.fields(this),b=new Map;for(const M of S)b.set(String(M.name),M);const y={ownRef:s,protoRef:m,list:S,map:b};return this[Q]=y,y}getValidationMetaCache(){const s=Reflect.getOwnMetadata(B,this),h=Object.getPrototypeOf(this),m=h?Reflect.getOwnMetadata(B,h):null,_=this[B];if(_&&_!==!0&&_.ownRef===s&&_.protoRef===m)return _;const S=Ce.fields(this),b=new Map;for(const M of S)b.set(String(M.name),M);const y={ownRef:s,protoRef:m,list:S,map:b};return this[B]=y,y}initValidation(s){const h=this.validation;if(s)Reflect.get(h,s);else for(let m in h)h[m]}init(s={}){this.cloneForInit(s),this.defineData(this.initData)}initField(s,h){const m=this.getFieldMeta(s);if(m){const _=String(m.name);Object.prototype.hasOwnProperty.call(this.initData,_)||Reflect.set(this.initData,_,Reflect.get(this,_));let b=m?.factory?m.factory(this.initData,this):Reflect.get(this.initData,_);if(b===void 0&&!m?.factory){const y=Reflect.get(this,_);y!==void 0&&(b=y,Reflect.set(this.initData,_,y))}this.defineFieldValue(s,b,m),h?.skipValidation||this.initValidation(s)}}initLegacyFields(){if(this.legacyInitDone)return;const s=this.getFieldMetaCache().list;if(s.some(h=>Object.prototype.hasOwnProperty.call(this,h.name))){this.legacyInitDone=!0;for(let h of s){const m=String(h.name);this.initData&&m in this.initData||this.initField(m,{skipValidation:!0})}}}createObservable(s,h,m,_=m){return s=g.isObservable(s)?s:g.observable.box(s),new Proxy(s,{get:(S,b,y)=>{const M=Reflect.get(S,b,y);return M&&typeof M=="object"&&!(M instanceof t)&&!g.isObservable(s)?this.createObservable(M,String(b),h,`${_}.${String(b)}`):M},set:(S,b,y,M)=>(s=y,this.checkChange(m,Reflect.get(this,m)),Reflect.set(S,b,y,M))})}defineFieldValue(s,h,m){const _=m??this.getFieldMeta(s);return _.noObserve?Reflect.defineProperty(this,_.name,{value:h}):(h=g.observable.box(h),Reflect.defineProperty(this,_.name,{get:()=>h.get(),set:S=>{g.runInAction(()=>h.set(S)),this.checkChange(_.name,h.get())},enumerable:!0,configurable:!0})),h}cloneForInit(s={}){this.initData=s}checkChange(s,h){const m=Reflect.get(this.committedData,s)||Reflect.get(this.initData,s),_=s&&s in this.initData&&!J.isEqual(m,h);return g.runInAction(()=>{if(_){Reflect.set(this.modified_,s,m);return}s in this.modified_&&J.isEqual(m,h)&&delete this.modified_[s]}),_}defineData(s){const h=this.getFieldMetaCache().map;for(let m in this)Object.prototype.hasOwnProperty.call(this,m)&&h.has(m)&&(Reflect.set(this,m,Reflect.get(s,m)),this.initField(m))}get dirty(){return!J.isEmpty(this.modified_)}commit(){for(let s of this.getFieldMetaCache().list)this.commitField(s.name);this.modified_={}}commitField(s){for(let h in this)h in this.modified_&&Reflect.set(this.committedData,h,this[h]);delete this.modified_[s],this.modified_=Object.assign({},this.modified_)}reject(){for(let s in this)s in this.modified_&&(this[s]=Reflect.get(this.modified_,s),this.commitField(s),this.defineFieldValue(s,this[s]));this.commit()}toInit(){return this.init(this.initData),this}loadData(s){return this.init(s),this}get dumpData(){this.initLegacyFields();const s=Object.create({}),h=this.getSubmitMetaCache().map,m=this.getExcludeMetaCache().map,_=b=>{const y=Reflect.get(this,b),M=h.get(b),H=M?.callback;return typeof H=="function"?H(y,this):y},S=b=>{const y=m.get(b);if(y)switch(typeof y.callback){case"boolean":return!!y.callback;case"function":return y.callback(Reflect.get(this,b),this)}return!1};return this.getFieldMetaCache().list.forEach(b=>{var y;if(b.name in this)return!((y=this.options)===null||y===void 0)&&y.byFields&&!this.options.byFields.includes(b.name)||S(b.name)?void 0:Reflect.set(s,b.name,_(b.name))}),s}get validation(){this.initLegacyFields();const s={};for(const h of this.getValidationMetaCache().list){const m=String(h.name);Reflect.set(s,m,h.callback(Reflect.get(this,m),this)||"")}return s}get validAndDirty(){return this.dirty&&Object.values(this.validation).filter(Boolean).length===0}get serviceApi(){return{loadData:s=>this.loadData(s),reject:()=>this.reject(),commit:()=>this.commit(),commitField:s=>this.commitField(s),toInit:()=>this.toInit()}}get service(){return Object.assign({dirty:this.dirty,dumpData:this.dumpData,validation:this.validation},this.serviceApi)}},(()=>{const j=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;A=[g.computed],O=[g.action],l=[g.action],C=[g.action],x=[g.action],U=[g.computed],$=[g.computed],G=[(I=g.computed).struct.bind(I)],f.__esDecorate(t,null,F,{kind:"accessor",name:"initData",static:!1,private:!1,access:{has:s=>"initData"in s,get:s=>s.initData,set:(s,h)=>{s.initData=h}},metadata:j},T,V),f.__esDecorate(t,null,A,{kind:"getter",name:"dirty",static:!1,private:!1,access:{has:s=>"dirty"in s,get:s=>s.dirty},metadata:j},null,D),f.__esDecorate(t,null,O,{kind:"method",name:"commit",static:!1,private:!1,access:{has:s=>"commit"in s,get:s=>s.commit},metadata:j},null,D),f.__esDecorate(t,null,l,{kind:"method",name:"commitField",static:!1,private:!1,access:{has:s=>"commitField"in s,get:s=>s.commitField},metadata:j},null,D),f.__esDecorate(t,null,C,{kind:"method",name:"reject",static:!1,private:!1,access:{has:s=>"reject"in s,get:s=>s.reject},metadata:j},null,D),f.__esDecorate(t,null,x,{kind:"method",name:"toInit",static:!1,private:!1,access:{has:s=>"toInit"in s,get:s=>s.toInit},metadata:j},null,D),f.__esDecorate(t,null,U,{kind:"getter",name:"validation",static:!1,private:!1,access:{has:s=>"validation"in s,get:s=>s.validation},metadata:j},null,D),f.__esDecorate(t,null,$,{kind:"getter",name:"validAndDirty",static:!1,private:!1,access:{has:s=>"validAndDirty"in s,get:s=>s.validAndDirty},metadata:j},null,D),f.__esDecorate(t,null,G,{kind:"getter",name:"service",static:!1,private:!1,access:{has:s=>"service"in s,get:s=>s.service},metadata:j},null,D),j&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:j})})(),t})();const he=new WeakMap,ze=(t,e)=>{if(!t)return;let n=he.get(t);n||(n=new Set,he.set(t,n));const o=String(e.name);if(n.has(o))return;const i=P(e.metadataKey,t,new Array);i.some(a=>a.name===o)||R(e.metadataKey,[...i,e],t),n.add(o)},X=function(e,n){const o=z(e,n)?void 0:e,i=(c,d)=>{const u=new re(Object.assign(Object.assign({},o),{name:String(d),ctx:null}));R(u.metadataKey,[...P(u.metadataKey,c,new Array),u],c),Object.getOwnPropertyDescriptor(c,d)||Object.defineProperty(c,d,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,d))return Reflect.get(this,d);if(this.initData&&d in this.initData&&typeof this.initField=="function")return this.initField.call(this,String(d),{skipValidation:!0}),Reflect.get(this,d)},set(p){if(this.initData&&!(d in this.initData)&&Reflect.set(this.initData,d,p),typeof this.initField=="function"){this.initField.call(this,String(d),{skipValidation:!0});return}Object.defineProperty(this,d,{value:p,writable:!0,configurable:!0,enumerable:!0})}})},a=c=>{c.addInitializer(function(){if(this instanceof ye&&typeof this.initField=="function"){const d=new re(Object.assign(Object.assign({},o),{name:String(c.name),ctx:c}));ze(Object.getPrototypeOf(this),d),this.initField.call(this,String(c.name))}})};function r(c,d){if(z(c,d)){i(c,d);return}if(E(d))return a(d),d.kind==="field"?u=>u:d}return z(e,n)?r(e,n):o&&!E(n)?(c,d)=>r(c,d):E(n)?r(void 0,n):(c,d)=>r(c,d)},Te=t=>!t||typeof t!="object"?{noObserve:!0}:Object.assign(Object.assign({},t),{noObserve:!0}),Ve=function(e,n){return z(e,n)||E(n)?X({noObserve:!0})(e,n):X(Te(e))};X.noObserve=Ve;const me=new WeakMap,Ke=(t,e)=>{if(!t)return;let n=me.get(t);n||(n=new Set,me.set(t,n));const o=String(e.name);if(n.has(o))return;const i=P(e.metadataKey,t,new Array);i.some(a=>a.name===o)||R(e.metadataKey,[...i,e],t),n.add(o)};function Le(t){const e=(i,a)=>{const r=new ae({callback:t,name:String(a)}),c=P(r.metadataKey,i,new Array);R(r.metadataKey,[...c,r],i)},n=i=>{const a=new ae({callback:t,name:String(i.name)});i.addInitializer(function(){Ke(Object.getPrototypeOf(this),a)})};function o(i,a){if(z(i,a)){e(i,a);return}if(E(a))return n(a),a.kind==="field"?r=>r:a}return t?((i,a)=>o(i,a)):(i=>i)}const _e=new WeakMap,qe=(t,e)=>{if(!t)return;let n=_e.get(t);n||(n=new Set,_e.set(t,n));const o=String(e.name);if(n.has(o))return;const i=P(e.metadataKey,t,new Array);i.some(a=>a.name===o)||R(e.metadataKey,[...i,e],t),n.add(o)};function We(t){const e=(i,a)=>{const r=new ne({callback:t,name:String(a)}),c=P(r.metadataKey,i,new Array);R(r.metadataKey,[...c,r],i)},n=i=>{const a=new ne({callback:t,name:String(i.name)});i.addInitializer(function(){qe(Object.getPrototypeOf(this),a)})};function o(i,a){if(z(i,a)){e(i,a);return}if(E(a))return n(a),a.kind==="field"?r=>r:a}return t?((i,a)=>o(i,a)):(i=>i)}const Ge=t=>({items:t.items.map(e=>{var n,o;return{name:(o=(n=e.constructor)===null||n===void 0?void 0:n.name)!==null&&o!==void 0?o:"Model",data:e.service.dumpData}})});let Be=(()=>{var t,e,n;let o=[],i,a=[],r=[],c,d=[],u=[],v,p,k,w,I,D,F,T,V,A;return t=class{get items(){return f.__classPrivateFieldGet(this,e,"f")}set items(l){f.__classPrivateFieldSet(this,e,l,"f")}get _cash(){return f.__classPrivateFieldGet(this,n,"f")}set _cash(l){f.__classPrivateFieldSet(this,n,l,"f")}constructor(){e.set(this,(f.__runInitializers(this,o),f.__runInitializers(this,a,[]))),n.set(this,(f.__runInitializers(this,r),f.__runInitializers(this,d,[]))),f.__runInitializers(this,u),g.makeObservable(this)}add(l){this.items.push(l)}addMany(l){l?.length&&(this.items=this.items.concat(l))}remove(l){this.items=this.items.filter(C=>C!==l)}find(l){return this.items.find(l)}filter(l){return this.items.filter(l)}findBy(l,C){return this.items.find(x=>x?.[l]===C)}clear(){this.items=[]}get size(){return this.items.length}get snapshot(){return Ge(this)}get cash(){return this._cash}reset(){this.clear()}applyLoaded(l,C={}){const{model:x,mode:U="replace",cash:$=!0}=C;if($&&this.setCash(l),U==="append"){const G=x?l.map(j=>new x(j)):l;this.addMany(G);return}this.items=x?l.map(G=>new x(G)):l}setCash(l){this._cash=l??[]}},e=new WeakMap,n=new WeakMap,(()=>{const O=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;i=[g.observable],c=[g.observable],v=[g.action],p=[g.action],k=[g.action],w=[g.action],I=[g.computed],D=[g.computed],F=[g.computed],T=[g.action],V=[g.action],A=[g.action],f.__esDecorate(t,null,i,{kind:"accessor",name:"items",static:!1,private:!1,access:{has:l=>"items"in l,get:l=>l.items,set:(l,C)=>{l.items=C}},metadata:O},a,r),f.__esDecorate(t,null,c,{kind:"accessor",name:"_cash",static:!1,private:!1,access:{has:l=>"_cash"in l,get:l=>l._cash,set:(l,C)=>{l._cash=C}},metadata:O},d,u),f.__esDecorate(t,null,v,{kind:"method",name:"add",static:!1,private:!1,access:{has:l=>"add"in l,get:l=>l.add},metadata:O},null,o),f.__esDecorate(t,null,p,{kind:"method",name:"addMany",static:!1,private:!1,access:{has:l=>"addMany"in l,get:l=>l.addMany},metadata:O},null,o),f.__esDecorate(t,null,k,{kind:"method",name:"remove",static:!1,private:!1,access:{has:l=>"remove"in l,get:l=>l.remove},metadata:O},null,o),f.__esDecorate(t,null,w,{kind:"method",name:"clear",static:!1,private:!1,access:{has:l=>"clear"in l,get:l=>l.clear},metadata:O},null,o),f.__esDecorate(t,null,I,{kind:"getter",name:"size",static:!1,private:!1,access:{has:l=>"size"in l,get:l=>l.size},metadata:O},null,o),f.__esDecorate(t,null,D,{kind:"getter",name:"snapshot",static:!1,private:!1,access:{has:l=>"snapshot"in l,get:l=>l.snapshot},metadata:O},null,o),f.__esDecorate(t,null,F,{kind:"getter",name:"cash",static:!1,private:!1,access:{has:l=>"cash"in l,get:l=>l.cash},metadata:O},null,o),f.__esDecorate(t,null,T,{kind:"method",name:"reset",static:!1,private:!1,access:{has:l=>"reset"in l,get:l=>l.reset},metadata:O},null,o),f.__esDecorate(t,null,V,{kind:"method",name:"applyLoaded",static:!1,private:!1,access:{has:l=>"applyLoaded"in l,get:l=>l.applyLoaded},metadata:O},null,o),f.__esDecorate(t,null,A,{kind:"method",name:"setCash",static:!1,private:!1,access:{has:l=>"setCash"in l,get:l=>l.setCash},metadata:O},null,o),O&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:O})})(),t})();function Ye(t){return K(t,"instance")}function Qe(t){return((e,n)=>be(t)(e,n))}function Ue(t,e){const n=(o,i)=>{var a;const r=typeof t=="string"?{id:t}:typeof t=="object"?t:{id:(a=i?.name)!==null&&a!==void 0?a:o?.name};ce(r)(o,i)};return typeof t=="function"?n(t,e):(o,i)=>n(o,i)}class $e{}const te=new oe;function Ne(t,e){return we.observer((n={})=>{const{resolved:o,instance:i}=le.useMemo(()=>{const r=K(t)||(typeof t!="string"?{instance:new t}:void 0),c=r?.instance;return{resolved:r,instance:c}},[t]);if(le.useEffect(()=>{if(i)return typeof i.onInit=="function"&&i.onInit(),()=>{typeof i.onDispose=="function"&&i.onDispose()}},[i]),o){const a=te.fields(i),r=a.length>0?a:te.fields(Object.getPrototypeOf(i));for(const c in n)if(r instanceof Array){const d=r.find(u=>u.name===c);d&&Reflect.set(i,d.originName,Reflect.get(n,c))}return R(te.metadataKey,r,i),e(Object.assign({viewModel:i},n))}return e(Object.assign({},n))})}const ge={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},Je={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},N=()=>{};class Xe{constructor(e,n){var o,i,a,r,c,d,u;this.isExecuting=!1,this.activeCount=0,this.isCanceled=!1,this.isDisposed=!1,this.error=null,this.controllers=new Set,this.queue=[],this.runningPromise=null,this.queueTail=Promise.resolve(),this.cancelToken=0,this.fn=e,this.opt=Object.assign({concurrency:(o=n?.concurrency)!==null&&o!==void 0?o:"ignore",trackError:(i=n?.trackError)!==null&&i!==void 0?i:!0,resetErrorOnExecute:(a=n?.resetErrorOnExecute)!==null&&a!==void 0?a:!0,swallowError:(r=n?.swallowError)!==null&&r!==void 0?r:!0,abortable:(c=n?.abortable)!==null&&c!==void 0?c:!1},n),this.states=Object.assign(Object.assign({},ge),(d=n?.states)!==null&&d!==void 0?d:{}),this.stateKeys=Object.assign(Object.assign({},Je),(u=n?.stateKeys)!==null&&u!==void 0?u:{}),g.makeAutoObservable(this,{fn:!1,opt:!1,states:!1,stateKeys:!1,resolveState:!1,getScope:!1,controllers:!1,queue:!1,runningPromise:!1,queueTail:!1,cancelToken:!1},{autoBind:!0})}get canExecute(){return this.isDisposed||!(this.opt.canExecute?this.opt.canExecute(this.getScope()):!0)?!1:this.opt.concurrency==="ignore"?!this.isExecuting:!0}resolveState(e){var n,o;const i=(n=this.stateKeys[e])!==null&&n!==void 0?n:e;return(o=this.states[i])!==null&&o!==void 0?o:ge[e]}getScope(){return{state:this.state,states:this.states,isExecuting:this.isExecuting,activeCount:this.activeCount,isCanceled:this.isCanceled,isDisposed:this.isDisposed,error:this.error}}get state(){return this.isDisposed?this.resolveState("disposed"):this.isExecuting?this.resolveState("load"):this.error?this.resolveState("failure"):this.isCanceled?this.resolveState("canceled"):this.resolveState("ready")}resetError(){this.error=null}cancel(){var e,n;this.cancelToken+=1,this.isCanceled=!0,(n=(e=this.opt).onCancel)===null||n===void 0||n.call(e),this.opt.cancelQueued&&this.clearQueue();for(const o of this.controllers)o.abort()}dispose(){this.isDisposed||(this.isDisposed=!0,this.clearQueue(),this.cancel())}clearQueue(){if(this.queue.length===0)return;const e=this.queue.splice(0,this.queue.length);for(const n of e)n.canceled=!0,n.settled||(n.settled=!0,n.resolve(void 0))}execute(...e){var n;if(this.isDisposed)return Promise.resolve(void 0);if(!this.canExecute)return(n=this.runningPromise)!==null&&n!==void 0?n:Promise.resolve(void 0);const o=a=>{this.runningPromise=a;const r=()=>{this.runningPromise===a&&(this.runningPromise=null)};return a.then(r,r),a},i=()=>f.__awaiter(this,void 0,void 0,function*(){var a,r,c,d,u,v,p,k;if(this.isDisposed)return;const w=this.opt.abortable?new AbortController:null;w&&this.controllers.add(w),g.runInAction(()=>{this.activeCount+=1,this.isExecuting=this.activeCount>0,this.isCanceled=!1,this.opt.trackError&&this.opt.resetErrorOnExecute&&(this.error=null)});const I=this.cancelToken;let D=!1,F=!1,T=null,V=null;try{(r=(a=this.opt).onStart)===null||r===void 0||r.call(a,...e);const A=this.opt.abortable?w.signal:void 0;V=this.fn(...e,A);const O=yield V;return F=this.cancelToken!==I,F?void 0:((d=(c=this.opt).onSuccess)===null||d===void 0||d.call(c,O,...e),D=!0,O)}catch(A){if(this.opt.abortable&&w?.signal.aborted){g.runInAction(()=>{this.isCanceled=!0}),F=!0,T=null;return}if(T=A,F=this.cancelToken!==I,this.opt.trackError&&g.runInAction(()=>{this.error=A}),(v=(u=this.opt).onError)===null||v===void 0||v.call(u,A),!this.opt.swallowError)throw A;return}finally{g.runInAction(()=>{this.activeCount=Math.max(0,this.activeCount-1),this.isExecuting=this.activeCount>0}),w&&this.controllers.delete(w),!F&&this.cancelToken!==I&&(F=!0),(k=(p=this.opt).onFinally)===null||k===void 0||k.call(p,{ok:D,canceled:F,error:T},...e)}});switch(this.opt.concurrency){case"parallel":return o(i());case"restart":return this.cancel(),o(i());case"queue":{const a=this.opt.queueLimit;if(typeof a=="number"&&a>0&&this.queue.length>=a)return Promise.resolve(void 0);const r={promise:Promise.resolve(void 0),resolve:N,reject:N,canceled:!1,settled:!1},c=this.activeCount===0&&this.queue.length===0;r.promise=new Promise((v,p)=>{r.resolve=v,r.reject=p}),this.queue.push(r);const d=()=>f.__awaiter(this,void 0,void 0,function*(){if(r.settled)return;if(r.canceled||this.isDisposed){r.settled=!0,r.resolve(void 0);return}const v=this.queue.indexOf(r);v>=0&&this.queue.splice(v,1);try{const p=yield i();r.settled||(r.settled=!0,r.resolve(p))}catch(p){r.settled||(r.settled=!0,r.reject(p))}}),u=c?d():this.queueTail.then(d,d);return this.queueTail=u.then(N,N),o(r.promise)}default:return this.isExecuting&&this.runningPromise?this.runningPromise:o(i())}}}function pe(t,e){return new Xe(t,e)}function He(t,e){const n=g.flow(t),o=new Set,i=e?.onCancel;return pe((...r)=>{const c=n(...r);o.add(c);const d=()=>{o.delete(c)};return c.then(d,d),new Promise((u,v)=>{c.then(u,p=>{if(g.isFlowCancellationError(p)){u(void 0);return}v(p)})})},Object.assign(Object.assign({},e),{onCancel:()=>{var r;for(const c of o)(r=c.cancel)===null||r===void 0||r.call(c);i?.()}}))}function Ze(t){return function(...e){return g.runInAction(()=>t.apply(this,e))}}exports.GetService=K;exports.GetStore=Ye;exports.Inject=be;exports.InjectStore=Qe;exports.MakeObservable=Re;exports.Model=ye;exports.PropFromView=Pe;exports.Service=ce;exports.SetService=ke;exports.Store=Ue;exports.StoreBase=Be;exports.TODO=Se;exports.ViewModel=$e;exports.asyncCommand=pe;exports.commandAction=Ze;exports.defineMetadata=R;exports.define_prop=De;exports.exclude=Ee;exports.field=X;exports.flowCommand=He;exports.getExecutingFunctionNameByStack=ve;exports.getOwnMetadata=P;exports.isSerializable=Oe;exports.submit=Le;exports.validation=We;exports.view=Ne;
