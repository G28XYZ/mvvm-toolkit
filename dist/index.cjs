"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("reflect-metadata");const u=require("./tslib.es6--9daFdVU.cjs"),X=require("lodash"),y=require("mobx"),U=require("immer"),Te=require("mobx-react"),ge=require("react"),x=(e,t,r)=>Reflect.getOwnMetadata(e,t)||r||{},R=(e,t,r)=>Reflect.defineMetadata(e,t,r);function Ee(...e){try{return JSON.stringify(e),!0}catch{return!1}}function Se(e){if(e&&typeof e=="string"){let[t]=e.split(`
`)[2].replace(/at (get)?/,"").match(/.*/g)||[];return t&&(t=t.trim()),t}}const be={},ne=[];let pe=!1;const je=(e,...t)=>{const r=new Error().stack;if(!pe)console.log("%c TODO","background: #222; color: #bada55",be),pe=!0;else{const s=Se(r);ne.includes(s)===!1&&(ne.push(s),Reflect.set(be,`${ne.length}) ${e}`,{msg:t,get path(){return console.info(t,s),s}}))}function o(...s){}return o},H=(e,t)=>!!e&&(typeof t=="string"||typeof t=="symbol"),z=e=>!!e&&typeof e=="object"&&"kind"in e,Fe=e=>({kind:"class",name:e,addInitializer:()=>{},metadata:{}}),$=Symbol("service-key"),oe=new Proxy({},Reflect);function Me(e){const t=(o,s)=>{Object.defineProperty(o,s,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,s))return Reflect.get(this,s);const n=Y(e,"instance");if(n)return Object.defineProperty(this,s,{value:n,writable:!0,configurable:!0,enumerable:!0}),n},set(n){const a=Y(e,"instance");Object.defineProperty(this,s,{value:a??n,writable:!0,configurable:!0,enumerable:!0})}})};function r(o,s){if(H(o,s)){t(o,s);return}return s.addInitializer(function(){return u.__awaiter(this,void 0,void 0,function*(){const n=Y(e,"instance");n&&Object.hasOwn(this,s.name)&&Reflect.set(this,s.name,n)})}),n=>n}return r}function Y(e,t){var r;const o=x($,oe);if(typeof e!="string"){const s=x($,e);if(s)return t&&t in s?s[t]:s;for(const n in o){const a=o[n];if(a.target===e){e=a.context.name;break}}}if(typeof e=="string")return t?(r=o[e])===null||r===void 0?void 0:r[t]:o[e]}function ve(e,t){const r=(s,n)=>{const a=String(typeof e=="string"&&e||typeof e=="object"&&e?.id||n?.name||s?.name),l=x($,oe),d=new Proxy({target:s,instance:typeof e=="object"&&Reflect.get(e,"transient")||typeof e=="object"&&Reflect.get(e,"lazy")?s:new s,context:n,options:e},{get(h,_,v){var p,b;if(_==="instance"&&(!((p=h?.options)===null||p===void 0)&&p.transient))return new s;if(_==="instance"&&(!((b=h?.options)===null||b===void 0)&&b.lazy)&&h.instance===s){const A=new s;return Reflect.set(h,_,A,v),A}return Reflect.get(h,_,v)},set(h,_,v,p){return Reflect.set(h,_,v,p)}});l[a]=d,R($,l,oe),R($,l[a],s)};function o(s,n){var a,l;const d=s.__legacy_source__,h=z(n)?n:Fe((l=(a=d?.name)!==null&&a!==void 0?a:s?.name)!==null&&l!==void 0?l:"");r(s,h),d&&d!==s&&R($,x($,s),d)}return X.isFunction(e)?o(e,t):e?(s,n)=>o(s,n):o}const Ve=(e,t)=>{const{kind:r="class",name:o="",addInitializer:s=()=>{},metadata:n}=t?.ctx||{};return ve(t)(e,{kind:r,name:o,addInitializer:s,metadata:n}),Y(e).instance};function ae(e){var t,r,o;const s=Object.assign({enumerable:!1,writable:!0},e),n=Object.assign({configurable:!0,enumerable:!1,writable:!0},e),a={configurable:(t=n.configurable)!==null&&t!==void 0?t:!0,enumerable:(r=n.enumerable)!==null&&r!==void 0?r:!1,writable:(o=n.writable)!==null&&o!==void 0?o:!0,value:void 0};return function(l,d){if(H(l,d)){Object.defineProperty(l,d,{configurable:!0,enumerable:s.enumerable,get(){},set(h){a.value=h,Object.defineProperty(this,d,a),a.value=void 0}});return}if(z(d)){const h=d;return h.kind==="field"?function(_){return a.value=_,Object.defineProperty(this,h.name,a),a.value=void 0,_}:(h.addInitializer(function(){const _=Object.getOwnPropertyDescriptor(this,h.name);_&&Object.defineProperty(this,h.name,Object.assign(Object.assign({},_),{enumerable:s.enumerable}))}),l)}}}function Re(e,t){return H(e,t)||z(t)?ae()(e,t):ae(e)}function Ce(e,t){const r=n=>class extends n{constructor(...a){super(...a),y.makeObservable(this)}},o=(n,a)=>{if(typeof Reflect?.getOwnMetadataKeys=="function")for(const l of Reflect.getOwnMetadataKeys(n)){const d=Reflect.getOwnMetadata(l,n);Reflect.defineMetadata(l,d,a)}};function s(n,a){if(!z(a)){const l=n,d=r(l);return Object.defineProperty(d,"__legacy_source__",{value:l,configurable:!0}),o(l,d),d}a.addInitializer(function(){y.makeObservable(this)})}return e&&!z(t)||e?s(e,t):s}const xe=Symbol("field-key"),Le=Symbol("validation-key"),Ke=Symbol("submit-key"),ze=Symbol("exclude-key"),He=Symbol("prop-from-view-key");class Q{isPrototypeObject(t){const r=t?.constructor;return!!(r&&r.prototype===t)}getCacheTarget(t){return!t||typeof t!="object"?null:this.isPrototypeObject(t)?t:Object.getPrototypeOf(t)}computeFromPrototype(t){const r=[],o=new Map,s=new Set;let n=t;for(;n;){const l=Reflect.getOwnMetadata(this.metadataKey,n);if(Array.isArray(l))for(const d of l){const h=d?.name,_=String(h);s.has(_)||(s.add(_),r.push(d),o.set(_,d))}n=Object.getPrototypeOf(n)}return{ownRef:Reflect.getOwnMetadata(this.metadataKey,t),list:r,map:o}}constructor(t={}){this.metadataKey=null,this.cache=new WeakMap,this.name=t?.name,this.callback=t?.callback}isInstance(t={}){return t instanceof Q||Object.getOwnPropertyNames(this).some(r=>Object.keys(t).includes(r))}fieldInstance(t,r){const o=r&&typeof r=="object"?Reflect.getOwnMetadata(this.metadataKey,r):void 0;if(Array.isArray(o))return o.find(l=>l.name===t);const s=this.getCacheTarget(r);if(!s)return;const n=Reflect.getOwnMetadata(this.metadataKey,s),a=this.cache.get(s);if(!a||a.ownRef!==n){const l=this.computeFromPrototype(s);return this.cache.set(s,l),l.map.get(String(t))}return a.map.get(String(t))}fields(t){const r=t&&typeof t=="object"?Reflect.getOwnMetadata(this.metadataKey,t):void 0;if(Array.isArray(r)){const l=[],d=new Set;let h=t;for(;h;){const _=Reflect.getOwnMetadata(this.metadataKey,h);if(Array.isArray(_))for(const v of _){const p=v?.name,b=String(p);d.has(b)||(d.add(b),l.push(v))}h=Object.getPrototypeOf(h)}return l}const o=this.getCacheTarget(t);if(!o)return[];const s=Reflect.getOwnMetadata(this.metadataKey,o),n=this.cache.get(o);if(n&&n.ownRef===s)return n.list;const a=this.computeFromPrototype(o);return this.cache.set(o,a),a.list}}class le extends Q{constructor(){super(...arguments),this.metadataKey=Le}}class ce extends Q{constructor(){super(...arguments),this.metadataKey=Ke}}class de extends Q{constructor(){super(...arguments),this.metadataKey=ze}}class ue extends Q{constructor(t={}){super(t),this.factory=null,this.mapping=null,this.noObserve=null,this.collectChanges=!1,this.name=null,this.ctx=null,this.metadataKey=xe,this.factory=t.factory,this.mapping=t.mapping,this.noObserve=t.noObserve,this.name=t.name,this.ctx=t.ctx,this.collectChanges=!!t.collectChanges}}class he extends Q{constructor(t={}){super(t),this.metadataKey=He;for(const r in this)t&&r in t&&(this[r]=Reflect.get(t,r))}}function Ge(e){const t=(s,n)=>{const a=new he({name:e,originName:String(n)});a.name=e,a.originName=String(n);const l=x(a.metadataKey,s,new Array);R(a.metadataKey,[...l,a],s)},r=s=>{s.addInitializer(function(){const n=new he,a=n.fields(this);for(const l in this)a instanceof Array&&s.name===l&&(n.name=e,n.originName=l,n.value=this[l],a.push(n));R(n.metadataKey,a,this)})};function o(s,n){if(H(s,n)){t(s,n);return}if(z(n))return r(n),n.kind==="field"?a=>a:n}return e?((s,n)=>o(s,n)):(s=>s)}function qe(e){const t=(s,n)=>{const a=new de({callback:e,name:String(n)}),l=x(a.metadataKey,s,new Array);R(a.metadataKey,[...l,a],s)},r=s=>{s.addInitializer(function(){const n=new de({callback:e,name:String(s.name)}),a=x(n.metadataKey,this,new Array);R(n.metadataKey,[...a,n],this)})};function o(s,n){if(H(s,n)){t(s,n);return}if(z(n))return r(n),n.kind==="field"?void 0:n}if(e)return((s,n)=>o(s,n))}const Be=()=>{var e;return(e=globalThis.__REDUX_DEVTOOLS_EXTENSION__)!==null&&e!==void 0?e:null},Ye=()=>{var e;return(e=globalThis.__MVVM_DEVTOOLS_APPLYING__)!==null&&e!==void 0?e:0},Z=e=>{var t,r;const o=globalThis;o.__MVVM_DEVTOOLS_APPLYING__=((t=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&t!==void 0?t:0)+1;try{return e()}finally{o.__MVVM_DEVTOOLS_APPLYING__=Math.max(0,((r=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&r!==void 0?r:1)-1)}},Ne=()=>Ye()>0,De=e=>({data:e.service.dumpData,historyIndex:e.service.historyIndex}),we=(e,t={})=>{const r=Be();if(!r)return()=>{};const o=r.connect({name:t.name,instanceId:t.instanceId});let s=!1;try{o.init(De(e))}catch{}const n=y.reaction(()=>De(e),l=>{var d;if(!(s||Ne()))try{o.send({type:(d=t.actionType)!==null&&d!==void 0?d:"model:update"},l)}catch{}}),a=o.subscribe(l=>{var d;if(l.type!=="DISPATCH")return;const h=(d=l.payload)===null||d===void 0?void 0:d.type;if(h==="RESET"){s=!0,Z(()=>{try{e.service.toInit()}finally{s=!1}});return}if(h==="COMMIT"){s=!0,Z(()=>{try{e.service.commit()}finally{s=!1}});return}if(h==="ROLLBACK"){s=!0,Z(()=>{try{e.service.toInit()}finally{s=!1}});return}if(h==="JUMP_TO_ACTION"||h==="JUMP_TO_STATE"){if(!l.state)return;try{const _=JSON.parse(l.state),v=_.historyIndex,p=e.service.history,b=Array.isArray(p)&&p.length>0,A=typeof v=="number"&&(v===-1&&b||v>=0&&b&&v<p.length);s=!0,Z(()=>{var O;try{if(A){e.service.goToHistory(v);return}const T=(O=_.data)!==null&&O!==void 0?O:_;y.runInAction(()=>{e.service.loadData(T)})}finally{s=!1}})}catch{}}});return()=>{n(),typeof a=="function"&&a(),typeof o.unsubscribe=="function"&&o.unsubscribe(),typeof o.disconnect=="function"&&o.disconnect()}};U.enablePatches();const We=new ce,B=new ue,Ue=new le,$e=new de;let Ie=(()=>{var e,t,r,o,s,n,a,l,d,h,_,v,p,b,A;let O=[],T,L=[],G=[],F,M,c,D,w,V,k,C,K,N,W,J;return e=class{get[(t=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,n=new WeakMap,a=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,_=new WeakMap,v=new WeakMap,p=new WeakMap,b=U.immerable)](){return u.__classPrivateFieldGet(this,t,"f")}set[b](i){u.__classPrivateFieldSet(this,t,i,"f")}get initData(){return u.__classPrivateFieldGet(this,r,"f")}set initData(i){u.__classPrivateFieldSet(this,r,i,"f")}get committedData(){return u.__classPrivateFieldGet(this,o,"f")}set committedData(i){u.__classPrivateFieldSet(this,o,i,"f")}get modified_(){return u.__classPrivateFieldGet(this,s,"f")}set modified_(i){u.__classPrivateFieldSet(this,s,i,"f")}get draft(){return u.__classPrivateFieldGet(this,n,"f")}set draft(i){u.__classPrivateFieldSet(this,n,i,"f")}get changes(){return u.__classPrivateFieldGet(this,a,"f")}set changes(i){u.__classPrivateFieldSet(this,a,i,"f")}get inverseChanges(){return u.__classPrivateFieldGet(this,l,"f")}set inverseChanges(i){u.__classPrivateFieldSet(this,l,i,"f")}get history(){return u.__classPrivateFieldGet(this,d,"f")}set history(i){u.__classPrivateFieldSet(this,d,i,"f")}get historyIndex(){return u.__classPrivateFieldGet(this,h,"f")}set historyIndex(i){u.__classPrivateFieldSet(this,h,i,"f")}get legacyInitDone(){return u.__classPrivateFieldGet(this,_,"f")}set legacyInitDone(i){u.__classPrivateFieldSet(this,_,i,"f")}get options(){return u.__classPrivateFieldGet(this,v,"f")}set options(i){u.__classPrivateFieldSet(this,v,i,"f")}get historyMuted(){return u.__classPrivateFieldGet(this,p,"f")}set historyMuted(i){u.__classPrivateFieldSet(this,p,i,"f")}constructor(i={},f){t.set(this,(u.__runInitializers(this,O),!0)),r.set(this,u.__runInitializers(this,L,null)),o.set(this,(u.__runInitializers(this,G),{})),s.set(this,{}),n.set(this,null),a.set(this,[]),l.set(this,[]),d.set(this,[]),h.set(this,-1),_.set(this,!1),v.set(this,{}),p.set(this,!1),this.options=f,this[U.immerable]=!0,this.init(i),this.initLegacyFields(),this.autoAttachDevtools()}initValidation(i){if(i)Reflect.get(this.validation,i);else for(let f in this.validation)this.validation[f]}init(i={}){this.cloneForInit(i),this.createDraft(i),this.defineData(this.initData)}initField(i,f){const m=B.fieldInstance(i,this);if(m){i in this.initData||Reflect.set(this.initData,i,Reflect.get(this,i));const g=m?.factory?m.factory(this.initData,this):this.initData[m.name];this.defineFieldValue(i,g,m),f?.skipValidation||this.initValidation(i)}}initLegacyFields(){if(this.legacyInitDone)return;const i=B.fields(this);if(i.some(f=>Object.prototype.hasOwnProperty.call(this,f.name))){this.legacyInitDone=!0;for(let f of i)this.initData&&String(f.name)in this.initData||!B.fieldInstance(String(f.name),this)||this.initField(String(f.name),{skipValidation:!0})}}createDraft(i){this.draft=U.createDraft(i)}autoAttachDevtools(){var i,f,m,g,S,j,I,P,q,te,ie;const se=globalThis;if(!se.__MVVM_DEVTOOLS_AUTO__||((f=(i=this.options)===null||i===void 0?void 0:i.devtools)===null||f===void 0?void 0:f.enabled)===!1)return;const ye=(I=(S=(g=(m=this.options)===null||m===void 0?void 0:m.devtools)===null||g===void 0?void 0:g.name)!==null&&S!==void 0?S:(j=this.constructor)===null||j===void 0?void 0:j.name)!==null&&I!==void 0?I:"Model",me=((P=se.__MVVM_DEVTOOLS_SEQ__)!==null&&P!==void 0?P:0)+1;se.__MVVM_DEVTOOLS_SEQ__=me,we(this,{name:ye,instanceId:(ie=(te=(q=this.options)===null||q===void 0?void 0:q.devtools)===null||te===void 0?void 0:te.instanceId)!==null&&ie!==void 0?ie:`${ye}#${me}`})}withHistoryMuted(i){this.historyMuted=!0;try{i()}finally{this.historyMuted=!1}}syncChangesFromHistory(){const i=this.historyIndex>=0?this.history.slice(0,this.historyIndex+1):[];this.changes=i.flatMap(f=>f.patches),this.inverseChanges=i.flatMap(f=>f.inversePatches)}applyHistoryPatches(i){if(!i.length)return;U.applyPatches(this.draft,i);const f=new Set(i.map(m=>m.field).filter(Boolean));f.size!==0&&this.withHistoryMuted(()=>{var m;for(let g of f){const S=(m=Reflect.get(this.draft,g))!==null&&m!==void 0?m:Reflect.get(this.initData,g);Reflect.set(this,g,S),this.defineFieldValue(g,Reflect.get(this,g))}})}produceDraft(i,f,m){if(this.historyMuted)return;let g,S=[];i&&(g=i.split(".")[0],g&&!B.fieldInstance(g,this).collectChanges)||(U.produce(this.draft,j=>{if(i){let I=j;const P=i.split(".");if(P.length>1)for(let q=0;q<P.length&&!(q!=P.length-1&&!X.isObject(I));q++)X.isObject(I)&&(I=I[P[q]]);else m=i;I&&(I[m]=f)}},(j,I)=>{g&&(j=j.map(P=>Object.assign(Object.assign({},P),{field:g})),I=I.map(P=>Object.assign(Object.assign({},P),{field:g}))),S=j,!(!j.length&&!I.length)&&(this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1),this.syncChangesFromHistory()),this.changes.push(...j),this.inverseChanges.push(...I),this.history.push({patches:j,inversePatches:I}),this.historyIndex=this.history.length-1)}),S.length&&U.applyPatches(this.draft,S))}createObservable(i,f,m,g=m){return i=y.isObservable(i)?i:y.observable.box(i),new Proxy(i,{get:(S,j,I)=>{const P=Reflect.get(S,j,I);return P&&typeof P=="object"&&!(P instanceof e)&&!y.isObservable(i)?this.createObservable(P,String(j),f,`${g}.${String(j)}`):P},set:(S,j,I,P)=>(i=I,this.produceDraft(g,i,String(j)),this.checkChange(m,Reflect.get(this,m)),Reflect.set(S,j,I,P))})}defineFieldValue(i,f,m=B.fieldInstance(i,this)){return m.noObserve?Reflect.defineProperty(this,m.name,{value:f}):(f=y.observable.box(f),Reflect.defineProperty(this,m.name,{get:()=>f.get(),set:g=>{y.runInAction(()=>f.set(g)),this.produceDraft(m.name,f.get()),this.checkChange(m.name,f.get())},enumerable:!0,configurable:!0})),f}cloneForInit(i={}){this.initData=i}checkChange(i,f){const m=Reflect.get(this.committedData,i)||Reflect.get(this.initData,i),g=i&&i in this.initData&&!X.isEqual(m,f);return y.runInAction(()=>{g&&Reflect.set(this.modified_,i,m);for(const S in this.modified_)i===S&&i in this.modified_&&X.isEqual(m,f)&&delete this.modified_[S]}),g}defineData(i){for(let f in this)Object.prototype.hasOwnProperty.call(this,f)&&B.fieldInstance(f,this)&&(Reflect.set(this,f,Reflect.get(i,f)),this.initField(f))}get dirty(){return!X.isEmpty(this.modified_)}commit(){for(let i of B.fields(this))this.commitField(i.name);this.modified_={}}commitField(i){for(let f in this)f in this.modified_&&Reflect.set(this.committedData,f,this[f]);delete this.modified_[i],this.modified_=Object.assign({},this.modified_)}reject(){for(let i in this)i in this.modified_&&(this[i]=Reflect.get(this.modified_,i),this.commitField(i),this.defineFieldValue(i,this[i]));this.commit()}toInit(){return this.withHistoryMuted(()=>{for(let i in this)i in this.initData&&(this[i]=Reflect.get(this.initData,i),this.initField(i));this.init(this.initData)}),this}undo(){this.historyIndex<0||(this.applyHistoryPatches(this.history[this.historyIndex].inversePatches),this.historyIndex-=1,this.syncChangesFromHistory())}redo(){this.historyIndex>=this.history.length-1||(this.historyIndex=this.historyIndex+1,this.applyHistoryPatches(this.history[this.historyIndex].patches),this.syncChangesFromHistory())}goToHistory(i){if(!(i<-1||i>=this.history.length)&&i!==this.historyIndex){for(;this.historyIndex<i;)this.historyIndex=this.historyIndex+1,this.applyHistoryPatches(this.history[this.historyIndex].patches);for(;this.historyIndex>i;)this.applyHistoryPatches(this.history[this.historyIndex].inversePatches),this.historyIndex-=1;this.syncChangesFromHistory()}}loadData(i){return this.withHistoryMuted(()=>{this.init(i),this.defineData(this.initData)}),this}get dumpData(){this.initLegacyFields();const i=Object.create({}),f=g=>{try{return We.fieldInstance(g,this).callback(Reflect.get(this,g),this)}catch{return Reflect.get(this,g)}},m=g=>{const S=$e.fieldInstance(g,this);if(S)switch(typeof S.callback){case"boolean":return!!S.callback;case"function":return S.callback(Reflect.get(this,g),this)}return!1};return B.fields(this).forEach(g=>{var S;if(g.name in this)return!((S=this.options)===null||S===void 0)&&S.byFields&&!this.options.byFields.includes(g.name)||m(g.name)?void 0:Reflect.set(i,g.name,f(g.name))}),i}get validation(){this.initLegacyFields();const i={};for(const f in this){const m=Ue.fieldInstance(f,this);m&&Reflect.set(i,f,m.callback(this[f],this)||"")}return i}get validAndDirty(){return this.dirty&&Object.values(this.validation).filter(Boolean).length===0}get serviceApi(){return{loadData:i=>this.loadData(i),reject:()=>this.reject(),commit:()=>this.commit(),commitField:i=>this.commitField(i),toInit:()=>this.toInit(),undo:()=>this.undo(),redo:()=>this.redo(),goToHistory:i=>this.goToHistory(i)}}get service(){return Object.assign({dirty:this.dirty,dumpData:this.dumpData,validation:this.validation,changes:this.changes,inverseChanges:this.inverseChanges,history:this.history,historyIndex:this.historyIndex},this.serviceApi)}},(()=>{const E=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;T=[y.observable],F=[y.action],M=[y.computed],c=[y.action],D=[y.action],w=[y.action],V=[y.action],k=[y.action],C=[y.action],K=[y.action],N=[y.computed],W=[y.computed],J=[(A=y.computed).struct.bind(A)],u.__esDecorate(e,null,T,{kind:"accessor",name:"initData",static:!1,private:!1,access:{has:i=>"initData"in i,get:i=>i.initData,set:(i,f)=>{i.initData=f}},metadata:E},L,G),u.__esDecorate(e,null,F,{kind:"method",name:"produceDraft",static:!1,private:!1,access:{has:i=>"produceDraft"in i,get:i=>i.produceDraft},metadata:E},null,O),u.__esDecorate(e,null,M,{kind:"getter",name:"dirty",static:!1,private:!1,access:{has:i=>"dirty"in i,get:i=>i.dirty},metadata:E},null,O),u.__esDecorate(e,null,c,{kind:"method",name:"commit",static:!1,private:!1,access:{has:i=>"commit"in i,get:i=>i.commit},metadata:E},null,O),u.__esDecorate(e,null,D,{kind:"method",name:"commitField",static:!1,private:!1,access:{has:i=>"commitField"in i,get:i=>i.commitField},metadata:E},null,O),u.__esDecorate(e,null,w,{kind:"method",name:"reject",static:!1,private:!1,access:{has:i=>"reject"in i,get:i=>i.reject},metadata:E},null,O),u.__esDecorate(e,null,V,{kind:"method",name:"toInit",static:!1,private:!1,access:{has:i=>"toInit"in i,get:i=>i.toInit},metadata:E},null,O),u.__esDecorate(e,null,k,{kind:"method",name:"undo",static:!1,private:!1,access:{has:i=>"undo"in i,get:i=>i.undo},metadata:E},null,O),u.__esDecorate(e,null,C,{kind:"method",name:"redo",static:!1,private:!1,access:{has:i=>"redo"in i,get:i=>i.redo},metadata:E},null,O),u.__esDecorate(e,null,K,{kind:"method",name:"goToHistory",static:!1,private:!1,access:{has:i=>"goToHistory"in i,get:i=>i.goToHistory},metadata:E},null,O),u.__esDecorate(e,null,N,{kind:"getter",name:"validation",static:!1,private:!1,access:{has:i=>"validation"in i,get:i=>i.validation},metadata:E},null,O),u.__esDecorate(e,null,W,{kind:"getter",name:"validAndDirty",static:!1,private:!1,access:{has:i=>"validAndDirty"in i,get:i=>i.validAndDirty},metadata:E},null,O),u.__esDecorate(e,null,J,{kind:"getter",name:"service",static:!1,private:!1,access:{has:i=>"service"in i,get:i=>i.service},metadata:E},null,O),E&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:E})})(),e})();const Qe=()=>{var e;const t=globalThis;return!!((e=t.__MVVM_DEVTOOLS_HISTORY__)!==null&&e!==void 0?e:t.__MVVM_DEVTOOLS_AUTO__)},Je=e=>Qe()?!e||typeof e!="object"?{collectChanges:!0}:"collectChanges"in e?e:Object.assign(Object.assign({},e),{collectChanges:!0}):e;function fe(e,t){const r=Je(H(e,t)?void 0:e),o=(a,l)=>{const d=new ue(Object.assign(Object.assign({},r),{name:String(l),ctx:null})),h=x(d.metadataKey,a,new Array);R(d.metadataKey,[...h,d],a),Object.getOwnPropertyDescriptor(a,l)||Object.defineProperty(a,l,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,l))return Reflect.get(this,l);if(this.initData&&l in this.initData&&typeof this.initField=="function")return this.initField.call(this,String(l),{skipValidation:!0}),Reflect.get(this,l)},set(v){if(this.initData&&!(l in this.initData)&&Reflect.set(this.initData,l,v),typeof this.initField=="function"){this.initField.call(this,String(l),{skipValidation:!0});return}Object.defineProperty(this,l,{value:v,writable:!0,configurable:!0,enumerable:!0})}})},s=a=>{a.addInitializer(function(){if(this instanceof Ie&&typeof this.initField=="function"){const l=new ue(Object.assign(Object.assign({},r),{name:String(a.name),ctx:a})),d=x(l.metadataKey,this,new Array);R(l.metadataKey,[...d,l],this),this.initField.call(this,String(a.name))}})};function n(a,l){if(H(a,l)){o(a,l);return}if(z(l))return s(l),l.kind==="field"?d=>d:l}return H(e,t)?n(e,t):r&&!z(t)?(a,l)=>n(a,l):z(t)?n(void 0,t):(a,l)=>n(a,l)}const Xe=e=>!e||typeof e!="object"?{noObserve:!0}:Object.assign(Object.assign({},e),{noObserve:!0});(function(e){e.noObserve=(function(r,o){return H(r,o)||z(o)?e({noObserve:!0})(r,o):e(Xe(r))})})(fe||(fe={}));function Ze(e){const t=(s,n)=>{const a=new ce({callback:e,name:String(n)}),l=x(a.metadataKey,s,new Array);R(a.metadataKey,[...l,a],s)},r=s=>{const n=new ce({callback:e,name:String(s.name)});s.addInitializer(function(){const a=x(n.metadataKey,this,new Array);R(n.metadataKey,[...a,n],this)})};function o(s,n){if(H(s,n)){t(s,n);return}if(z(n))return r(n),n.kind==="field"?a=>a:n}return e?((s,n)=>o(s,n)):(s=>s)}function et(e){const t=(s,n)=>{const a=new le({callback:e,name:String(n)}),l=x(a.metadataKey,s,new Array);R(a.metadataKey,[...l,a],s)},r=s=>{const n=new le({callback:e,name:String(s.name)});s.addInitializer(function(){const a=x(n.metadataKey,this,new Array);R(n.metadataKey,[...a,n],this)})};function o(s,n){if(H(s,n)){t(s,n);return}if(z(n))return r(n),n.kind==="field"?a=>a:n}return e?((s,n)=>o(s,n)):(s=>s)}const Ae=Symbol("store-key"),tt=()=>{var e;return(e=globalThis.__REDUX_DEVTOOLS_EXTENSION__)!==null&&e!==void 0?e:null},it=()=>{var e;return(e=globalThis.__MVVM_DEVTOOLS_APPLYING__)!==null&&e!==void 0?e:0},st=e=>{var t,r;const o=globalThis;o.__MVVM_DEVTOOLS_APPLYING__=((t=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&t!==void 0?t:0)+1;try{return e()}finally{o.__MVVM_DEVTOOLS_APPLYING__=Math.max(0,((r=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&r!==void 0?r:1)-1)}},nt=()=>it()>0,_e=e=>({items:e.items.map(t=>{var r,o;return{name:(o=(r=t.constructor)===null||r===void 0?void 0:r.name)!==null&&o!==void 0?o:"Model",data:t.service.dumpData,historyIndex:t.service.historyIndex}})}),at=e=>!!(e&&typeof e=="object"&&Array.isArray(e.items)),rt=e=>{if(!e)return null;try{const t=JSON.parse(e);return at(t)?t:null}catch{return null}},ke=(e,t={})=>{var r,o;const s=tt();if(!s)return()=>{};const n=s.connect({name:t.name,instanceId:t.instanceId});let a=!1,l=(o=(r=e.items[0])===null||r===void 0?void 0:r.constructor)!==null&&o!==void 0?o:null;try{n.init(_e(e))}catch{}const d=y.reaction(()=>_e(e),v=>{var p;if(a||nt())return;const b=(p=e.items[0])===null||p===void 0?void 0:p.constructor;b&&(l=b);try{n.send({type:"store:update"},v)}catch{}}),h=v=>(a=!0,st(()=>{try{return v()}finally{a=!1}})),_=n.subscribe(v=>{var p;if(v.type!=="DISPATCH")return;const b=(p=v.payload)===null||p===void 0?void 0:p.type;if(b==="RESET"||b==="ROLLBACK"){h(()=>e.reset());return}if(b==="JUMP_TO_ACTION"||b==="JUMP_TO_STATE"){const A=rt(v.state);if(!A)return;h(()=>{var O,T,L;if(A.items.length===e.items.length&&e.items.every(D=>{var w,V;return typeof((w=D?.service)===null||w===void 0?void 0:w.goToHistory)=="function"||typeof((V=D?.service)===null||V===void 0?void 0:V.loadData)=="function"})){y.runInAction(()=>{A.items.forEach((D,w)=>{var V;const k=(V=e.items[w])===null||V===void 0?void 0:V.service,C=D.historyIndex,K=k?.history;if(Array.isArray(K)&&K.length>0&&typeof C=="number"&&typeof k?.goToHistory=="function"&&(C===-1&&K.length>0||C<K.length)){k.goToHistory(C);return}typeof k?.loadData=="function"&&k.loadData(D.data)})});return}const F=(T=(O=e.items[0])===null||O===void 0?void 0:O.constructor)!==null&&T!==void 0?T:l,M=A.items.map(D=>D.data);if(F){e.applyLoaded(M,{model:F,cash:!1}),l=F;return}e.applyLoaded(M,{cash:!1});const c=(L=e.items[0])===null||L===void 0?void 0:L.constructor;c&&(l=c)})}});return()=>{d(),typeof _=="function"&&_(),typeof n.unsubscribe=="function"&&n.unsubscribe(),typeof n.disconnect=="function"&&n.disconnect()}};let ot=(()=>{var e,t,r;let o=[],s,n=[],a=[],l,d=[],h=[],_,v,p,b,A,O,T,L,G,F;return e=class{get items(){return u.__classPrivateFieldGet(this,t,"f")}set items(c){u.__classPrivateFieldSet(this,t,c,"f")}get _cash(){return u.__classPrivateFieldGet(this,r,"f")}set _cash(c){u.__classPrivateFieldSet(this,r,c,"f")}constructor(){t.set(this,(u.__runInitializers(this,o),u.__runInitializers(this,n,[]))),r.set(this,(u.__runInitializers(this,a),u.__runInitializers(this,d,[]))),u.__runInitializers(this,h),y.makeObservable(this),this.autoAttachDevtools()}add(c){this.items.push(c)}addMany(c){c?.length&&(this.items=this.items.concat(c))}remove(c){this.items=this.items.filter(D=>D!==c)}find(c){return this.items.find(c)}filter(c){return this.items.filter(c)}findBy(c,D){return this.items.find(w=>w?.[c]===D)}clear(){this.items=[]}get size(){return this.items.length}get snapshot(){return _e(this)}get cash(){return this._cash}reset(){this.clear()}applyLoaded(c,D={}){const{model:w,mode:V="replace",cash:k=!0}=D;if(k&&this.setCash(c),V==="append"){const C=w?c.map(K=>new w(K)):c;this.addMany(C);return}this.items=w?c.map(C=>new w(C)):c}setCash(c){this._cash=c??[]}autoAttachDevtools(){var c,D,w,V,k,C,K,N;const W=globalThis;if(!W.__MVVM_DEVTOOLS_AUTO__)return;const J=x(Ae,this.constructor,{})||{};if(((c=J.devtools)===null||c===void 0?void 0:c.enabled)===!1)return;const E=(k=(w=(D=J.devtools)===null||D===void 0?void 0:D.name)!==null&&w!==void 0?w:(V=this.constructor)===null||V===void 0?void 0:V.name)!==null&&k!==void 0?k:"Store",i=((C=W.__MVVM_DEVTOOLS_STORE_SEQ__)!==null&&C!==void 0?C:0)+1;W.__MVVM_DEVTOOLS_STORE_SEQ__=i;const f=(N=(K=J.devtools)===null||K===void 0?void 0:K.instanceId)!==null&&N!==void 0?N:`${E}#${i}`;ke(this,{name:E,instanceId:f})}},t=new WeakMap,r=new WeakMap,(()=>{const M=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;s=[y.observable],l=[y.observable],_=[y.action],v=[y.action],p=[y.action],b=[y.action],A=[y.computed],O=[y.computed],T=[y.computed],L=[y.action],G=[y.action],F=[y.action],u.__esDecorate(e,null,s,{kind:"accessor",name:"items",static:!1,private:!1,access:{has:c=>"items"in c,get:c=>c.items,set:(c,D)=>{c.items=D}},metadata:M},n,a),u.__esDecorate(e,null,l,{kind:"accessor",name:"_cash",static:!1,private:!1,access:{has:c=>"_cash"in c,get:c=>c._cash,set:(c,D)=>{c._cash=D}},metadata:M},d,h),u.__esDecorate(e,null,_,{kind:"method",name:"add",static:!1,private:!1,access:{has:c=>"add"in c,get:c=>c.add},metadata:M},null,o),u.__esDecorate(e,null,v,{kind:"method",name:"addMany",static:!1,private:!1,access:{has:c=>"addMany"in c,get:c=>c.addMany},metadata:M},null,o),u.__esDecorate(e,null,p,{kind:"method",name:"remove",static:!1,private:!1,access:{has:c=>"remove"in c,get:c=>c.remove},metadata:M},null,o),u.__esDecorate(e,null,b,{kind:"method",name:"clear",static:!1,private:!1,access:{has:c=>"clear"in c,get:c=>c.clear},metadata:M},null,o),u.__esDecorate(e,null,A,{kind:"getter",name:"size",static:!1,private:!1,access:{has:c=>"size"in c,get:c=>c.size},metadata:M},null,o),u.__esDecorate(e,null,O,{kind:"getter",name:"snapshot",static:!1,private:!1,access:{has:c=>"snapshot"in c,get:c=>c.snapshot},metadata:M},null,o),u.__esDecorate(e,null,T,{kind:"getter",name:"cash",static:!1,private:!1,access:{has:c=>"cash"in c,get:c=>c.cash},metadata:M},null,o),u.__esDecorate(e,null,L,{kind:"method",name:"reset",static:!1,private:!1,access:{has:c=>"reset"in c,get:c=>c.reset},metadata:M},null,o),u.__esDecorate(e,null,G,{kind:"method",name:"applyLoaded",static:!1,private:!1,access:{has:c=>"applyLoaded"in c,get:c=>c.applyLoaded},metadata:M},null,o),u.__esDecorate(e,null,F,{kind:"method",name:"setCash",static:!1,private:!1,access:{has:c=>"setCash"in c,get:c=>c.setCash},metadata:M},null,o),M&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:M})})(),e})();function lt(e){return Y(e,"instance")}function ct(e){return((t,r)=>Me(e)(t,r))}function dt(e,t){const r=(o,s)=>{var n;const a=typeof e=="string"?{id:e}:typeof e=="object"?e:{id:(n=s?.name)!==null&&n!==void 0?n:o?.name};R(Ae,a,o),ve(a)(o,s)};return typeof e=="function"?r(e,t):(o,s)=>r(o,s)}class ut{}const re=new he;function ht(e,t){return Te.observer((r={})=>{const{resolved:o,instance:s}=ge.useMemo(()=>{const a=Y(e)||(typeof e!="string"?{instance:new e}:void 0),l=a?.instance;return{resolved:a,instance:l}},[e]);if(ge.useEffect(()=>{if(s)return typeof s.onInit=="function"&&s.onInit(),()=>{typeof s.onDispose=="function"&&s.onDispose()}},[s]),o){const n=re.fields(s),a=n.length>0?n:re.fields(Object.getPrototypeOf(s));for(const l in r)if(a instanceof Array){const d=a.find(h=>h.name===l);d&&Reflect.set(s,d.originName,Reflect.get(r,l))}return R(re.metadataKey,a,s),t(Object.assign({viewModel:s},r))}return t(Object.assign({},r))})}const Oe={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},ft={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},ee=()=>{};class _t{constructor(t,r){var o,s,n,a,l,d,h;this.isExecuting=!1,this.activeCount=0,this.isCanceled=!1,this.isDisposed=!1,this.error=null,this.controllers=new Set,this.queue=[],this.runningPromise=null,this.queueTail=Promise.resolve(),this.cancelToken=0,this.fn=t,this.opt=Object.assign({concurrency:(o=r?.concurrency)!==null&&o!==void 0?o:"ignore",trackError:(s=r?.trackError)!==null&&s!==void 0?s:!0,resetErrorOnExecute:(n=r?.resetErrorOnExecute)!==null&&n!==void 0?n:!0,swallowError:(a=r?.swallowError)!==null&&a!==void 0?a:!0,abortable:(l=r?.abortable)!==null&&l!==void 0?l:!1},r),this.states=Object.assign(Object.assign({},Oe),(d=r?.states)!==null&&d!==void 0?d:{}),this.stateKeys=Object.assign(Object.assign({},ft),(h=r?.stateKeys)!==null&&h!==void 0?h:{}),y.makeAutoObservable(this,{fn:!1,opt:!1,states:!1,stateKeys:!1,resolveState:!1,getScope:!1,controllers:!1,queue:!1,runningPromise:!1,queueTail:!1,cancelToken:!1},{autoBind:!0})}get canExecute(){return this.isDisposed||!(this.opt.canExecute?this.opt.canExecute(this.getScope()):!0)?!1:this.opt.concurrency==="ignore"?!this.isExecuting:!0}resolveState(t){var r,o;const s=(r=this.stateKeys[t])!==null&&r!==void 0?r:t;return(o=this.states[s])!==null&&o!==void 0?o:Oe[t]}getScope(){return{state:this.state,states:this.states,isExecuting:this.isExecuting,activeCount:this.activeCount,isCanceled:this.isCanceled,isDisposed:this.isDisposed,error:this.error}}get state(){return this.isDisposed?this.resolveState("disposed"):this.isExecuting?this.resolveState("load"):this.error?this.resolveState("failure"):this.isCanceled?this.resolveState("canceled"):this.resolveState("ready")}resetError(){this.error=null}cancel(){var t,r;this.cancelToken+=1,this.isCanceled=!0,(r=(t=this.opt).onCancel)===null||r===void 0||r.call(t),this.opt.cancelQueued&&this.clearQueue();for(const o of this.controllers)o.abort()}dispose(){this.isDisposed||(this.isDisposed=!0,this.clearQueue(),this.cancel())}clearQueue(){if(this.queue.length===0)return;const t=this.queue.splice(0,this.queue.length);for(const r of t)r.canceled=!0,r.settled||(r.settled=!0,r.resolve(void 0))}execute(...t){var r;if(this.isDisposed)return Promise.resolve(void 0);if(!this.canExecute)return(r=this.runningPromise)!==null&&r!==void 0?r:Promise.resolve(void 0);const o=n=>{this.runningPromise=n;const a=()=>{this.runningPromise===n&&(this.runningPromise=null)};return n.then(a,a),n},s=()=>u.__awaiter(this,void 0,void 0,function*(){var n,a,l,d,h,_,v,p;if(this.isDisposed)return;const b=this.opt.abortable?new AbortController:null;b&&this.controllers.add(b),y.runInAction(()=>{this.activeCount+=1,this.isExecuting=this.activeCount>0,this.isCanceled=!1,this.opt.trackError&&this.opt.resetErrorOnExecute&&(this.error=null)});const A=this.cancelToken;let O=!1,T=!1,L=null,G=null;try{(a=(n=this.opt).onStart)===null||a===void 0||a.call(n,...t);const F=this.opt.abortable?b.signal:void 0;G=this.fn(...t,F);const M=yield G;return T=this.cancelToken!==A,T?void 0:((d=(l=this.opt).onSuccess)===null||d===void 0||d.call(l,M,...t),O=!0,M)}catch(F){if(this.opt.abortable&&b?.signal.aborted){y.runInAction(()=>{this.isCanceled=!0}),T=!0,L=null;return}if(L=F,T=this.cancelToken!==A,this.opt.trackError&&y.runInAction(()=>{this.error=F}),(_=(h=this.opt).onError)===null||_===void 0||_.call(h,F),!this.opt.swallowError)throw F;return}finally{y.runInAction(()=>{this.activeCount=Math.max(0,this.activeCount-1),this.isExecuting=this.activeCount>0}),b&&this.controllers.delete(b),!T&&this.cancelToken!==A&&(T=!0),(p=(v=this.opt).onFinally)===null||p===void 0||p.call(v,{ok:O,canceled:T,error:L},...t)}});switch(this.opt.concurrency){case"parallel":return o(s());case"restart":return this.cancel(),o(s());case"queue":{const n=this.opt.queueLimit;if(typeof n=="number"&&n>0&&this.queue.length>=n)return Promise.resolve(void 0);const a={promise:Promise.resolve(void 0),resolve:ee,reject:ee,canceled:!1,settled:!1},l=this.activeCount===0&&this.queue.length===0;a.promise=new Promise((_,v)=>{a.resolve=_,a.reject=v}),this.queue.push(a);const d=()=>u.__awaiter(this,void 0,void 0,function*(){if(a.settled)return;if(a.canceled||this.isDisposed){a.settled=!0,a.resolve(void 0);return}const _=this.queue.indexOf(a);_>=0&&this.queue.splice(_,1);try{const v=yield s();a.settled||(a.settled=!0,a.resolve(v))}catch(v){a.settled||(a.settled=!0,a.reject(v))}}),h=l?d():this.queueTail.then(d,d);return this.queueTail=h.then(ee,ee),o(a.promise)}default:return this.isExecuting&&this.runningPromise?this.runningPromise:o(s())}}}function Pe(e,t){return new _t(e,t)}function vt(e,t){const r=y.flow(e),o=new Set,s=t?.onCancel;return Pe((...a)=>{const l=r(...a);o.add(l);const d=()=>{o.delete(l)};return l.then(d,d),new Promise((h,_)=>{l.then(h,v=>{if(y.isFlowCancellationError(v)){h(void 0);return}_(v)})})},Object.assign(Object.assign({},t),{onCancel:()=>{var a;for(const l of o)(a=l.cancel)===null||a===void 0||a.call(l);s?.()}}))}function yt(e){return function(...t){return y.runInAction(()=>e.apply(this,t))}}exports.GetService=Y;exports.GetStore=lt;exports.Inject=Me;exports.InjectStore=ct;exports.MakeObservable=Ce;exports.Model=Ie;exports.PropFromView=Ge;exports.Service=ve;exports.SetService=Ve;exports.Store=dt;exports.StoreBase=ot;exports.TODO=je;exports.ViewModel=ut;exports.asyncCommand=Pe;exports.attachModelDevtools=we;exports.attachStoreDevtools=ke;exports.commandAction=yt;exports.defineMetadata=R;exports.define_prop=Re;exports.exclude=qe;exports.field=fe;exports.flowCommand=vt;exports.getExecutingFunctionNameByStack=Se;exports.getOwnMetadata=x;exports.isSerializable=Ee;exports.submit=Ze;exports.validation=et;exports.view=ht;
