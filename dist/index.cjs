"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("reflect-metadata");const u=require("./tslib.es6--9daFdVU.cjs"),X=require("lodash"),y=require("mobx"),U=require("immer"),Pt=require("mobx-react"),mt=require("react"),C=(t,i,r)=>Reflect.getOwnMetadata(t,i)||r||{},R=(t,i,r)=>Reflect.defineMetadata(t,i,r);function Tt(...t){try{return JSON.stringify(t),!0}catch{return!1}}function Ot(t){if(t&&typeof t=="string"){let[i]=t.split(`
`)[2].replace(/at (get)?/,"").match(/.*/g)||[];return i&&(i=i.trim()),i}}const gt={},nt=[];let bt=!1;const Et=(t,...i)=>{const r=new Error().stack;if(!bt)console.log("%c TODO","background: #222; color: #bada55",gt),bt=!0;else{const s=Ot(r);nt.includes(s)===!1&&(nt.push(s),Reflect.set(gt,`${nt.length}) ${t}`,{msg:i,get path(){return console.info(i,s),s}}))}function o(...s){}return o},H=(t,i)=>!!t&&(typeof i=="string"||typeof i=="symbol"),z=t=>!!t&&typeof t=="object"&&"kind"in t,jt=t=>({kind:"class",name:t,addInitializer:()=>{},metadata:{}}),$=Symbol("service-key"),ot=new Proxy({},Reflect);function St(t){const i=(o,s)=>{Object.defineProperty(o,s,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,s))return Reflect.get(this,s);const n=Y(t,"instance");if(n)return Object.defineProperty(this,s,{value:n,writable:!0,configurable:!0,enumerable:!0}),n},set(n){const a=Y(t,"instance");Object.defineProperty(this,s,{value:a??n,writable:!0,configurable:!0,enumerable:!0})}})};function r(o,s){if(H(o,s)){i(o,s);return}return s.addInitializer(function(){return u.__awaiter(this,void 0,void 0,function*(){const n=Y(t,"instance");n&&Object.hasOwn(this,s.name)&&Reflect.set(this,s.name,n)})}),n=>n}return r}function Y(t,i){var r;const o=C($,ot);if(typeof t!="string"){const s=C($,t);if(s)return i&&i in s?s[i]:s;for(const n in o){const a=o[n];if(a.target===t){t=a.context.name;break}}}if(typeof t=="string")return i?(r=o[t])===null||r===void 0?void 0:r[i]:o[t]}function _t(t,i){const r=(s,n)=>{const a=String(typeof t=="string"&&t||typeof t=="object"&&t?.id||n?.name||s?.name),l=C($,ot),d=new Proxy({target:s,instance:typeof t=="object"&&Reflect.get(t,"transient")||typeof t=="object"&&Reflect.get(t,"lazy")?s:new s,context:n,options:t},{get(h,_,v){var p,b;if(_==="instance"&&(!((p=h?.options)===null||p===void 0)&&p.transient))return new s;if(_==="instance"&&(!((b=h?.options)===null||b===void 0)&&b.lazy)&&h.instance===s){const A=new s;return Reflect.set(h,_,A,v),A}return Reflect.get(h,_,v)},set(h,_,v,p){return Reflect.set(h,_,v,p)}});l[a]=d,R($,l,ot),R($,l[a],s)};function o(s,n){var a,l;const d=s.__legacy_source__,h=z(n)?n:jt((l=(a=d?.name)!==null&&a!==void 0?a:s?.name)!==null&&l!==void 0?l:"");r(s,h),d&&d!==s&&R($,C($,s),d)}return X.isFunction(t)?o(t,i):t?(s,n)=>o(s,n):o}const Ft=(t,i)=>{const{kind:r="class",name:o="",addInitializer:s=()=>{},metadata:n}=i?.ctx||{};return _t(i)(t,{kind:r,name:o,addInitializer:s,metadata:n}),Y(t).instance};function at(t){var i,r,o;const s=Object.assign({enumerable:!1,writable:!0},t),n=Object.assign({configurable:!0,enumerable:!1,writable:!0},t),a={configurable:(i=n.configurable)!==null&&i!==void 0?i:!0,enumerable:(r=n.enumerable)!==null&&r!==void 0?r:!1,writable:(o=n.writable)!==null&&o!==void 0?o:!0,value:void 0};return function(l,d){if(H(l,d)){Object.defineProperty(l,d,{configurable:!0,enumerable:s.enumerable,get(){},set(h){a.value=h,Object.defineProperty(this,d,a),a.value=void 0}});return}if(z(d)){const h=d;return h.kind==="field"?function(_){return a.value=_,Object.defineProperty(this,h.name,a),a.value=void 0,_}:(h.addInitializer(function(){const _=Object.getOwnPropertyDescriptor(this,h.name);_&&Object.defineProperty(this,h.name,Object.assign(Object.assign({},_),{enumerable:s.enumerable}))}),l)}}}function Vt(t,i){return H(t,i)||z(i)?at()(t,i):at(t)}function Rt(t,i){const r=n=>class extends n{constructor(...a){super(...a),y.makeObservable(this)}},o=(n,a)=>{if(typeof Reflect?.getOwnMetadataKeys=="function")for(const l of Reflect.getOwnMetadataKeys(n)){const d=Reflect.getOwnMetadata(l,n);Reflect.defineMetadata(l,d,a)}};function s(n,a){if(!z(a)){const l=n,d=r(l);return Object.defineProperty(d,"__legacy_source__",{value:l,configurable:!0}),o(l,d),d}a.addInitializer(function(){y.makeObservable(this)})}return t&&!z(i)||t?s(t,i):s}const xt=Symbol("field-key"),Ct=Symbol("validation-key"),Lt=Symbol("submit-key"),Kt=Symbol("exclude-key"),zt=Symbol("prop-from-view-key");class Q{isPrototypeObject(i){const r=i?.constructor;return!!(r&&r.prototype===i)}getCacheTarget(i){return!i||typeof i!="object"?null:this.isPrototypeObject(i)?i:Object.getPrototypeOf(i)}computeFromPrototype(i){const r=[],o=new Map,s=new Set;let n=i;for(;n;){const l=Reflect.getOwnMetadata(this.metadataKey,n);if(Array.isArray(l))for(const d of l){const h=d?.name,_=String(h);s.has(_)||(s.add(_),r.push(d),o.set(_,d))}n=Object.getPrototypeOf(n)}return{ownRef:Reflect.getOwnMetadata(this.metadataKey,i),list:r,map:o}}constructor(i={}){this.metadataKey=null,this.cache=new WeakMap,this.name=i?.name,this.callback=i?.callback}isInstance(i={}){return i instanceof Q||Object.getOwnPropertyNames(this).some(r=>Object.keys(i).includes(r))}fieldInstance(i,r){const o=r&&typeof r=="object"?Reflect.getOwnMetadata(this.metadataKey,r):void 0;if(Array.isArray(o))return o.find(l=>l.name===i);const s=this.getCacheTarget(r);if(!s)return;const n=Reflect.getOwnMetadata(this.metadataKey,s),a=this.cache.get(s);if(!a||a.ownRef!==n){const l=this.computeFromPrototype(s);return this.cache.set(s,l),l.map.get(String(i))}return a.map.get(String(i))}fields(i){const r=i&&typeof i=="object"?Reflect.getOwnMetadata(this.metadataKey,i):void 0;if(Array.isArray(r)){const l=[],d=new Set;let h=i;for(;h;){const _=Reflect.getOwnMetadata(this.metadataKey,h);if(Array.isArray(_))for(const v of _){const p=v?.name,b=String(p);d.has(b)||(d.add(b),l.push(v))}h=Object.getPrototypeOf(h)}return l}const o=this.getCacheTarget(i);if(!o)return[];const s=Reflect.getOwnMetadata(this.metadataKey,o),n=this.cache.get(o);if(n&&n.ownRef===s)return n.list;const a=this.computeFromPrototype(o);return this.cache.set(o,a),a.list}}class lt extends Q{constructor(){super(...arguments),this.metadataKey=Ct}}class ct extends Q{constructor(){super(...arguments),this.metadataKey=Lt}}class dt extends Q{constructor(){super(...arguments),this.metadataKey=Kt}}class ut extends Q{constructor(i={}){super(i),this.factory=null,this.mapping=null,this.collectChanges=!1,this.name=null,this.ctx=null,this.metadataKey=xt,this.factory=i.factory,this.mapping=i.mapping,this.name=i.name,this.ctx=i.ctx,this.collectChanges=!!i.collectChanges}}class ht extends Q{constructor(i={}){super(i),this.metadataKey=zt;for(const r in this)i&&r in i&&(this[r]=Reflect.get(i,r))}}function Ht(t){const i=(s,n)=>{const a=new ht({name:t,originName:String(n)});a.name=t,a.originName=String(n);const l=C(a.metadataKey,s,new Array);R(a.metadataKey,[...l,a],s)},r=s=>{s.addInitializer(function(){const n=new ht,a=n.fields(this);for(const l in this)a instanceof Array&&s.name===l&&(n.name=t,n.originName=l,n.value=this[l],a.push(n));R(n.metadataKey,a,this)})};function o(s,n){if(H(s,n)){i(s,n);return}if(z(n))return r(n),n.kind==="field"?a=>a:n}return t?((s,n)=>o(s,n)):(s=>s)}function Gt(t){const i=(s,n)=>{const a=new dt({callback:t,name:String(n)}),l=C(a.metadataKey,s,new Array);R(a.metadataKey,[...l,a],s)},r=s=>{s.addInitializer(function(){const n=new dt({callback:t,name:String(s.name)}),a=C(n.metadataKey,this,new Array);R(n.metadataKey,[...a,n],this)})};function o(s,n){if(H(s,n)){i(s,n);return}if(z(n))return r(n),n.kind==="field"?void 0:n}if(t)return((s,n)=>o(s,n))}const qt=()=>{var t;return(t=globalThis.__REDUX_DEVTOOLS_EXTENSION__)!==null&&t!==void 0?t:null},Bt=()=>{var t;return(t=globalThis.__MVVM_DEVTOOLS_APPLYING__)!==null&&t!==void 0?t:0},Z=t=>{var i,r;const o=globalThis;o.__MVVM_DEVTOOLS_APPLYING__=((i=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&i!==void 0?i:0)+1;try{return t()}finally{o.__MVVM_DEVTOOLS_APPLYING__=Math.max(0,((r=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&r!==void 0?r:1)-1)}},Yt=()=>Bt()>0,pt=t=>({data:t.service.dumpData,historyIndex:t.service.historyIndex}),Mt=(t,i={})=>{const r=qt();if(!r)return()=>{};const o=r.connect({name:i.name,instanceId:i.instanceId});let s=!1;try{o.init(pt(t))}catch{}const n=y.reaction(()=>pt(t),l=>{var d;if(!(s||Yt()))try{o.send({type:(d=i.actionType)!==null&&d!==void 0?d:"model:update"},l)}catch{}}),a=o.subscribe(l=>{var d;if(l.type!=="DISPATCH")return;const h=(d=l.payload)===null||d===void 0?void 0:d.type;if(h==="RESET"){s=!0,Z(()=>{try{t.service.toInit()}finally{s=!1}});return}if(h==="COMMIT"){s=!0,Z(()=>{try{t.service.commit()}finally{s=!1}});return}if(h==="ROLLBACK"){s=!0,Z(()=>{try{t.service.toInit()}finally{s=!1}});return}if(h==="JUMP_TO_ACTION"||h==="JUMP_TO_STATE"){if(!l.state)return;try{const _=JSON.parse(l.state),v=_.historyIndex,p=t.service.history,b=Array.isArray(p)&&p.length>0,A=typeof v=="number"&&(v===-1&&b||v>=0&&b&&v<p.length);s=!0,Z(()=>{var O;try{if(A){t.service.goToHistory(v);return}const T=(O=_.data)!==null&&O!==void 0?O:_;y.runInAction(()=>{t.service.loadData(T)})}finally{s=!1}})}catch{}}});return()=>{n(),typeof a=="function"&&a(),typeof o.unsubscribe=="function"&&o.unsubscribe(),typeof o.disconnect=="function"&&o.disconnect()}};U.enablePatches();const Nt=new ct,B=new ut,Wt=new lt,Ut=new dt;let wt=(()=>{var t,i,r,o,s,n,a,l,d,h,_,v,p,b,A;let O=[],T,L=[],G=[],F,M,c,D,w,V,k,x,K,N,W,J;return t=class{get[(i=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,n=new WeakMap,a=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,_=new WeakMap,v=new WeakMap,p=new WeakMap,b=U.immerable)](){return u.__classPrivateFieldGet(this,i,"f")}set[b](e){u.__classPrivateFieldSet(this,i,e,"f")}get initData(){return u.__classPrivateFieldGet(this,r,"f")}set initData(e){u.__classPrivateFieldSet(this,r,e,"f")}get committedData(){return u.__classPrivateFieldGet(this,o,"f")}set committedData(e){u.__classPrivateFieldSet(this,o,e,"f")}get modified_(){return u.__classPrivateFieldGet(this,s,"f")}set modified_(e){u.__classPrivateFieldSet(this,s,e,"f")}get draft(){return u.__classPrivateFieldGet(this,n,"f")}set draft(e){u.__classPrivateFieldSet(this,n,e,"f")}get changes(){return u.__classPrivateFieldGet(this,a,"f")}set changes(e){u.__classPrivateFieldSet(this,a,e,"f")}get inverseChanges(){return u.__classPrivateFieldGet(this,l,"f")}set inverseChanges(e){u.__classPrivateFieldSet(this,l,e,"f")}get history(){return u.__classPrivateFieldGet(this,d,"f")}set history(e){u.__classPrivateFieldSet(this,d,e,"f")}get historyIndex(){return u.__classPrivateFieldGet(this,h,"f")}set historyIndex(e){u.__classPrivateFieldSet(this,h,e,"f")}get legacyInitDone(){return u.__classPrivateFieldGet(this,_,"f")}set legacyInitDone(e){u.__classPrivateFieldSet(this,_,e,"f")}get options(){return u.__classPrivateFieldGet(this,v,"f")}set options(e){u.__classPrivateFieldSet(this,v,e,"f")}get historyMuted(){return u.__classPrivateFieldGet(this,p,"f")}set historyMuted(e){u.__classPrivateFieldSet(this,p,e,"f")}constructor(e={},f){i.set(this,(u.__runInitializers(this,O),!0)),r.set(this,u.__runInitializers(this,L,null)),o.set(this,(u.__runInitializers(this,G),{})),s.set(this,{}),n.set(this,null),a.set(this,[]),l.set(this,[]),d.set(this,[]),h.set(this,-1),_.set(this,!1),v.set(this,{}),p.set(this,!1),this.options=f,this[U.immerable]=!0,this.init(e),this.autoAttachDevtools(),this.initLegacyFields()}initValidation(e){if(e)Reflect.get(this.validation,e);else for(let f in this.validation)this.validation[f]}init(e={}){this.cloneForInit(e),this.createDraft(e),this.defineData(this.initData)}initField(e,f){const g=B.fieldInstance(e,this);if(g){e in this.initData||Reflect.set(this.initData,e,Reflect.get(this,e));const m=g?.factory?g.factory(this.initData,this):Reflect.get(this.initData,g.name);this.defineFieldValue(e,m,g),f?.skipValidation||this.initValidation(e)}}initLegacyFields(){if(this.legacyInitDone)return;const e=B.fields(this);if(e.some(f=>Object.prototype.hasOwnProperty.call(this,f.name))){this.legacyInitDone=!0;for(let f of e)this.initData&&String(f.name)in this.initData||!B.fieldInstance(String(f.name),this)||this.initField(String(f.name),{skipValidation:!0})}}createDraft(e){this.draft=U.createDraft(e)}autoAttachDevtools(){var e,f,g,m,S,j,I,P,q,et,it;const st=globalThis;if(!st.__MVVM_DEVTOOLS_AUTO__||((f=(e=this.options)===null||e===void 0?void 0:e.devtools)===null||f===void 0?void 0:f.enabled)===!1)return;const vt=(I=(S=(m=(g=this.options)===null||g===void 0?void 0:g.devtools)===null||m===void 0?void 0:m.name)!==null&&S!==void 0?S:(j=this.constructor)===null||j===void 0?void 0:j.name)!==null&&I!==void 0?I:"Model",yt=((P=st.__MVVM_DEVTOOLS_SEQ__)!==null&&P!==void 0?P:0)+1;st.__MVVM_DEVTOOLS_SEQ__=yt,Mt(this,{name:vt,instanceId:(it=(et=(q=this.options)===null||q===void 0?void 0:q.devtools)===null||et===void 0?void 0:et.instanceId)!==null&&it!==void 0?it:`${vt}#${yt}`})}withHistoryMuted(e){this.historyMuted=!0;try{e()}finally{this.historyMuted=!1}}syncChangesFromHistory(){const e=this.historyIndex>=0?this.history.slice(0,this.historyIndex+1):[];this.changes=e.flatMap(f=>f.patches),this.inverseChanges=e.flatMap(f=>f.inversePatches)}applyHistoryPatches(e){if(!e.length)return;U.applyPatches(this.draft,e);const f=new Set(e.map(g=>g.field).filter(Boolean));f.size!==0&&this.withHistoryMuted(()=>{var g;for(let m of f){const S=(g=Reflect.get(this.draft,m))!==null&&g!==void 0?g:Reflect.get(this.initData,m);Reflect.set(this,m,S),this.defineFieldValue(m,Reflect.get(this,m))}})}produceDraft(e,f,g){if(this.historyMuted)return;let m,S=[];e&&(m=e.split(".")[0],m&&!B.fieldInstance(m,this).collectChanges)||(U.produce(this.draft,j=>{if(e){let I=j;const P=e.split(".");if(P.length>1)for(let q=0;q<P.length&&!(q!=P.length-1&&!X.isObject(I));q++)X.isObject(I)&&(I=I[P[q]]);else g=e;I&&(I[g]=f)}},(j,I)=>{m&&(j=j.map(P=>Object.assign(Object.assign({},P),{field:m})),I=I.map(P=>Object.assign(Object.assign({},P),{field:m}))),S=j,!(!j.length&&!I.length)&&(this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1),this.syncChangesFromHistory()),this.changes.push(...j),this.inverseChanges.push(...I),this.history.push({patches:j,inversePatches:I}),this.historyIndex=this.history.length-1)}),S.length&&U.applyPatches(this.draft,S))}createObservable(e,f,g,m=g){return e=y.isObservable(e)?e:y.observable.box(e),new Proxy(e,{get:(S,j,I)=>{const P=Reflect.get(S,j,I);return P&&typeof P=="object"&&!(P instanceof t)&&!y.isObservable(e)?this.createObservable(P,String(j),f,`${m}.${String(j)}`):P},set:(S,j,I,P)=>(e=I,this.produceDraft(m,e,String(j)),this.checkChange(g,Reflect.get(this,g)),Reflect.set(S,j,I,P))})}defineFieldValue(e,f,g=B.fieldInstance(e,this)){return f=y.observable.box(f),Reflect.defineProperty(this,g.name,{get:()=>f.get(),set:m=>{y.runInAction(()=>f.set(m)),this.produceDraft(g.name,f.get()),this.checkChange(g.name,f.get())},enumerable:!0,configurable:!0}),f}cloneForInit(e={}){this.initData=e}checkChange(e,f){const g=Reflect.get(this.committedData,e)||Reflect.get(this.initData,e),m=e&&e in this.initData&&!X.isEqual(g,f);return y.runInAction(()=>{m&&Reflect.set(this.modified_,e,g);for(const S in this.modified_)e===S&&e in this.modified_&&X.isEqual(g,f)&&delete this.modified_[S]}),m}defineData(e){for(let f in this)Object.prototype.hasOwnProperty.call(this,f)&&B.fieldInstance(f,this)&&(Reflect.set(this,f,Reflect.get(e,f)),this.initField(f))}get dirty(){return!X.isEmpty(this.modified_)}commit(){for(let e of B.fields(this))this.commitField(e.name);this.modified_={}}commitField(e){for(let f in this)f in this.modified_&&Reflect.set(this.committedData,f,this[f]);delete this.modified_[e],this.modified_=Object.assign({},this.modified_)}reject(){for(let e in this)e in this.modified_&&(this[e]=Reflect.get(this.modified_,e),this.commitField(e),this.defineFieldValue(e,this[e]));this.commit()}toInit(){return this.withHistoryMuted(()=>{for(let e in this)e in this.initData&&(this[e]=Reflect.get(this.initData,e),this.initField(e));this.init(this.initData)}),this}undo(){this.historyIndex<0||(this.applyHistoryPatches(this.history[this.historyIndex].inversePatches),this.historyIndex-=1,this.syncChangesFromHistory())}redo(){this.historyIndex>=this.history.length-1||(this.historyIndex=this.historyIndex+1,this.applyHistoryPatches(this.history[this.historyIndex].patches),this.syncChangesFromHistory())}goToHistory(e){if(!(e<-1||e>=this.history.length)&&e!==this.historyIndex){for(;this.historyIndex<e;)this.historyIndex=this.historyIndex+1,this.applyHistoryPatches(this.history[this.historyIndex].patches);for(;this.historyIndex>e;)this.applyHistoryPatches(this.history[this.historyIndex].inversePatches),this.historyIndex-=1;this.syncChangesFromHistory()}}loadData(e){return this.withHistoryMuted(()=>{this.init(e),this.defineData(this.initData)}),this}get dumpData(){this.initLegacyFields();const e=Object.create({}),f=m=>{try{return Nt.fieldInstance(m,this).callback(Reflect.get(this,m),this)}catch{return Reflect.get(this,m)}},g=m=>{const S=Ut.fieldInstance(m,this);if(S)switch(typeof S.callback){case"boolean":return!!S.callback;case"function":return S.callback(Reflect.get(this,m),this)}return!1};return B.fields(this).forEach(m=>{var S;if(m.name in this)return!((S=this.options)===null||S===void 0)&&S.byFields&&!this.options.byFields.includes(m.name)||g(m.name)?void 0:Reflect.set(e,m.name,f(m.name))}),e}get validation(){this.initLegacyFields();const e={};for(const f in this){const g=Wt.fieldInstance(f,this);g&&Reflect.set(e,f,g.callback(this[f],this)||"")}return e}get validAndDirty(){return this.dirty&&Object.values(this.validation).filter(Boolean).length===0}get serviceApi(){return{loadData:e=>this.loadData(e),reject:()=>this.reject(),commit:()=>this.commit(),commitField:e=>this.commitField(e),toInit:()=>this.toInit(),undo:()=>this.undo(),redo:()=>this.redo(),goToHistory:e=>this.goToHistory(e)}}get service(){return Object.assign({dirty:this.dirty,dumpData:this.dumpData,validation:this.validation,changes:this.changes,inverseChanges:this.inverseChanges,history:this.history,historyIndex:this.historyIndex},this.serviceApi)}},(()=>{const E=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;T=[y.observable],F=[y.action],M=[y.computed],c=[y.action],D=[y.action],w=[y.action],V=[y.action],k=[y.action],x=[y.action],K=[y.action],N=[y.computed],W=[y.computed],J=[(A=y.computed).struct.bind(A)],u.__esDecorate(t,null,T,{kind:"accessor",name:"initData",static:!1,private:!1,access:{has:e=>"initData"in e,get:e=>e.initData,set:(e,f)=>{e.initData=f}},metadata:E},L,G),u.__esDecorate(t,null,F,{kind:"method",name:"produceDraft",static:!1,private:!1,access:{has:e=>"produceDraft"in e,get:e=>e.produceDraft},metadata:E},null,O),u.__esDecorate(t,null,M,{kind:"getter",name:"dirty",static:!1,private:!1,access:{has:e=>"dirty"in e,get:e=>e.dirty},metadata:E},null,O),u.__esDecorate(t,null,c,{kind:"method",name:"commit",static:!1,private:!1,access:{has:e=>"commit"in e,get:e=>e.commit},metadata:E},null,O),u.__esDecorate(t,null,D,{kind:"method",name:"commitField",static:!1,private:!1,access:{has:e=>"commitField"in e,get:e=>e.commitField},metadata:E},null,O),u.__esDecorate(t,null,w,{kind:"method",name:"reject",static:!1,private:!1,access:{has:e=>"reject"in e,get:e=>e.reject},metadata:E},null,O),u.__esDecorate(t,null,V,{kind:"method",name:"toInit",static:!1,private:!1,access:{has:e=>"toInit"in e,get:e=>e.toInit},metadata:E},null,O),u.__esDecorate(t,null,k,{kind:"method",name:"undo",static:!1,private:!1,access:{has:e=>"undo"in e,get:e=>e.undo},metadata:E},null,O),u.__esDecorate(t,null,x,{kind:"method",name:"redo",static:!1,private:!1,access:{has:e=>"redo"in e,get:e=>e.redo},metadata:E},null,O),u.__esDecorate(t,null,K,{kind:"method",name:"goToHistory",static:!1,private:!1,access:{has:e=>"goToHistory"in e,get:e=>e.goToHistory},metadata:E},null,O),u.__esDecorate(t,null,N,{kind:"getter",name:"validation",static:!1,private:!1,access:{has:e=>"validation"in e,get:e=>e.validation},metadata:E},null,O),u.__esDecorate(t,null,W,{kind:"getter",name:"validAndDirty",static:!1,private:!1,access:{has:e=>"validAndDirty"in e,get:e=>e.validAndDirty},metadata:E},null,O),u.__esDecorate(t,null,J,{kind:"getter",name:"service",static:!1,private:!1,access:{has:e=>"service"in e,get:e=>e.service},metadata:E},null,O),E&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:E})})(),t})();const $t=()=>{var t;const i=globalThis;return!!((t=i.__MVVM_DEVTOOLS_HISTORY__)!==null&&t!==void 0?t:i.__MVVM_DEVTOOLS_AUTO__)},Qt=t=>$t()?!t||typeof t!="object"?{collectChanges:!0}:"collectChanges"in t?t:Object.assign(Object.assign({},t),{collectChanges:!0}):t;function Jt(t,i){const r=Qt(H(t,i)?void 0:t),o=(a,l)=>{const d=new ut(Object.assign(Object.assign({},r),{name:String(l),ctx:null})),h=C(d.metadataKey,a,new Array);R(d.metadataKey,[...h,d],a),Object.getOwnPropertyDescriptor(a,l)||Object.defineProperty(a,l,{configurable:!0,enumerable:!0,get(){if(Object.prototype.hasOwnProperty.call(this,l))return Reflect.get(this,l);if(this.initData&&l in this.initData&&typeof this.initField=="function")return this.initField.call(this,String(l),{skipValidation:!0}),Reflect.get(this,l)},set(v){if(this.initData&&!(l in this.initData)&&Reflect.set(this.initData,l,v),typeof this.initField=="function"){this.initField.call(this,String(l),{skipValidation:!0});return}Object.defineProperty(this,l,{value:v,writable:!0,configurable:!0,enumerable:!0})}})},s=a=>{a.addInitializer(function(){if(this instanceof wt&&typeof this.initField=="function"){const l=new ut(Object.assign(Object.assign({},r),{name:String(a.name),ctx:a})),d=C(l.metadataKey,this,new Array);R(l.metadataKey,[...d,l],this),this.initField.call(this,String(a.name))}})};function n(a,l){if(H(a,l)){o(a,l);return}if(z(l))return s(l),l.kind==="field"?d=>d:l}return H(t,i)?n(t,i):r&&!z(i)?(a,l)=>n(a,l):z(i)?n(void 0,i):(a,l)=>n(a,l)}function Xt(t){const i=(s,n)=>{const a=new ct({callback:t,name:String(n)}),l=C(a.metadataKey,s,new Array);R(a.metadataKey,[...l,a],s)},r=s=>{const n=new ct({callback:t,name:String(s.name)});s.addInitializer(function(){const a=C(n.metadataKey,this,new Array);R(n.metadataKey,[...a,n],this)})};function o(s,n){if(H(s,n)){i(s,n);return}if(z(n))return r(n),n.kind==="field"?a=>a:n}return t?((s,n)=>o(s,n)):(s=>s)}function Zt(t){const i=(s,n)=>{const a=new lt({callback:t,name:String(n)}),l=C(a.metadataKey,s,new Array);R(a.metadataKey,[...l,a],s)},r=s=>{const n=new lt({callback:t,name:String(s.name)});s.addInitializer(function(){const a=C(n.metadataKey,this,new Array);R(n.metadataKey,[...a,n],this)})};function o(s,n){if(H(s,n)){i(s,n);return}if(z(n))return r(n),n.kind==="field"?a=>a:n}return t?((s,n)=>o(s,n)):(s=>s)}const It=Symbol("store-key"),te=()=>{var t;return(t=globalThis.__REDUX_DEVTOOLS_EXTENSION__)!==null&&t!==void 0?t:null},ee=()=>{var t;return(t=globalThis.__MVVM_DEVTOOLS_APPLYING__)!==null&&t!==void 0?t:0},ie=t=>{var i,r;const o=globalThis;o.__MVVM_DEVTOOLS_APPLYING__=((i=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&i!==void 0?i:0)+1;try{return t()}finally{o.__MVVM_DEVTOOLS_APPLYING__=Math.max(0,((r=o.__MVVM_DEVTOOLS_APPLYING__)!==null&&r!==void 0?r:1)-1)}},se=()=>ee()>0,ft=t=>({items:t.items.map(i=>{var r,o;return{name:(o=(r=i.constructor)===null||r===void 0?void 0:r.name)!==null&&o!==void 0?o:"Model",data:i.service.dumpData,historyIndex:i.service.historyIndex}})}),ne=t=>!!(t&&typeof t=="object"&&Array.isArray(t.items)),ae=t=>{if(!t)return null;try{const i=JSON.parse(t);return ne(i)?i:null}catch{return null}},At=(t,i={})=>{var r,o;const s=te();if(!s)return()=>{};const n=s.connect({name:i.name,instanceId:i.instanceId});let a=!1,l=(o=(r=t.items[0])===null||r===void 0?void 0:r.constructor)!==null&&o!==void 0?o:null;try{n.init(ft(t))}catch{}const d=y.reaction(()=>ft(t),v=>{var p;if(a||se())return;const b=(p=t.items[0])===null||p===void 0?void 0:p.constructor;b&&(l=b);try{n.send({type:"store:update"},v)}catch{}}),h=v=>(a=!0,ie(()=>{try{return v()}finally{a=!1}})),_=n.subscribe(v=>{var p;if(v.type!=="DISPATCH")return;const b=(p=v.payload)===null||p===void 0?void 0:p.type;if(b==="RESET"||b==="ROLLBACK"){h(()=>t.reset());return}if(b==="JUMP_TO_ACTION"||b==="JUMP_TO_STATE"){const A=ae(v.state);if(!A)return;h(()=>{var O,T,L;if(A.items.length===t.items.length&&t.items.every(D=>{var w,V;return typeof((w=D?.service)===null||w===void 0?void 0:w.goToHistory)=="function"||typeof((V=D?.service)===null||V===void 0?void 0:V.loadData)=="function"})){y.runInAction(()=>{A.items.forEach((D,w)=>{var V;const k=(V=t.items[w])===null||V===void 0?void 0:V.service,x=D.historyIndex,K=k?.history;if(Array.isArray(K)&&K.length>0&&typeof x=="number"&&typeof k?.goToHistory=="function"&&(x===-1&&K.length>0||x<K.length)){k.goToHistory(x);return}typeof k?.loadData=="function"&&k.loadData(D.data)})});return}const F=(T=(O=t.items[0])===null||O===void 0?void 0:O.constructor)!==null&&T!==void 0?T:l,M=A.items.map(D=>D.data);if(F){t.applyLoaded(M,{model:F,cash:!1}),l=F;return}t.applyLoaded(M,{cash:!1});const c=(L=t.items[0])===null||L===void 0?void 0:L.constructor;c&&(l=c)})}});return()=>{d(),typeof _=="function"&&_(),typeof n.unsubscribe=="function"&&n.unsubscribe(),typeof n.disconnect=="function"&&n.disconnect()}};let re=(()=>{var t,i,r;let o=[],s,n=[],a=[],l,d=[],h=[],_,v,p,b,A,O,T,L,G,F;return t=class{get items(){return u.__classPrivateFieldGet(this,i,"f")}set items(c){u.__classPrivateFieldSet(this,i,c,"f")}get _cash(){return u.__classPrivateFieldGet(this,r,"f")}set _cash(c){u.__classPrivateFieldSet(this,r,c,"f")}constructor(){i.set(this,(u.__runInitializers(this,o),u.__runInitializers(this,n,[]))),r.set(this,(u.__runInitializers(this,a),u.__runInitializers(this,d,[]))),u.__runInitializers(this,h),y.makeObservable(this),this.autoAttachDevtools()}add(c){this.items.push(c)}addMany(c){c?.length&&(this.items=this.items.concat(c))}remove(c){this.items=this.items.filter(D=>D!==c)}find(c){return this.items.find(c)}filter(c){return this.items.filter(c)}findBy(c,D){return this.items.find(w=>w?.[c]===D)}clear(){this.items=[]}get size(){return this.items.length}get snapshot(){return ft(this)}get cash(){return this._cash}reset(){this.clear()}applyLoaded(c,D={}){const{model:w,mode:V="replace",cash:k=!0}=D;if(k&&this.setCash(c),V==="append"){const x=w?c.map(K=>new w(K)):c;this.addMany(x);return}this.items=w?c.map(x=>new w(x)):c}setCash(c){this._cash=c??[]}autoAttachDevtools(){var c,D,w,V,k,x,K,N;const W=globalThis;if(!W.__MVVM_DEVTOOLS_AUTO__)return;const J=C(It,this.constructor,{})||{};if(((c=J.devtools)===null||c===void 0?void 0:c.enabled)===!1)return;const E=(k=(w=(D=J.devtools)===null||D===void 0?void 0:D.name)!==null&&w!==void 0?w:(V=this.constructor)===null||V===void 0?void 0:V.name)!==null&&k!==void 0?k:"Store",e=((x=W.__MVVM_DEVTOOLS_STORE_SEQ__)!==null&&x!==void 0?x:0)+1;W.__MVVM_DEVTOOLS_STORE_SEQ__=e;const f=(N=(K=J.devtools)===null||K===void 0?void 0:K.instanceId)!==null&&N!==void 0?N:`${E}#${e}`;At(this,{name:E,instanceId:f})}},i=new WeakMap,r=new WeakMap,(()=>{const M=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;s=[y.observable],l=[y.observable],_=[y.action],v=[y.action],p=[y.action],b=[y.action],A=[y.computed],O=[y.computed],T=[y.computed],L=[y.action],G=[y.action],F=[y.action],u.__esDecorate(t,null,s,{kind:"accessor",name:"items",static:!1,private:!1,access:{has:c=>"items"in c,get:c=>c.items,set:(c,D)=>{c.items=D}},metadata:M},n,a),u.__esDecorate(t,null,l,{kind:"accessor",name:"_cash",static:!1,private:!1,access:{has:c=>"_cash"in c,get:c=>c._cash,set:(c,D)=>{c._cash=D}},metadata:M},d,h),u.__esDecorate(t,null,_,{kind:"method",name:"add",static:!1,private:!1,access:{has:c=>"add"in c,get:c=>c.add},metadata:M},null,o),u.__esDecorate(t,null,v,{kind:"method",name:"addMany",static:!1,private:!1,access:{has:c=>"addMany"in c,get:c=>c.addMany},metadata:M},null,o),u.__esDecorate(t,null,p,{kind:"method",name:"remove",static:!1,private:!1,access:{has:c=>"remove"in c,get:c=>c.remove},metadata:M},null,o),u.__esDecorate(t,null,b,{kind:"method",name:"clear",static:!1,private:!1,access:{has:c=>"clear"in c,get:c=>c.clear},metadata:M},null,o),u.__esDecorate(t,null,A,{kind:"getter",name:"size",static:!1,private:!1,access:{has:c=>"size"in c,get:c=>c.size},metadata:M},null,o),u.__esDecorate(t,null,O,{kind:"getter",name:"snapshot",static:!1,private:!1,access:{has:c=>"snapshot"in c,get:c=>c.snapshot},metadata:M},null,o),u.__esDecorate(t,null,T,{kind:"getter",name:"cash",static:!1,private:!1,access:{has:c=>"cash"in c,get:c=>c.cash},metadata:M},null,o),u.__esDecorate(t,null,L,{kind:"method",name:"reset",static:!1,private:!1,access:{has:c=>"reset"in c,get:c=>c.reset},metadata:M},null,o),u.__esDecorate(t,null,G,{kind:"method",name:"applyLoaded",static:!1,private:!1,access:{has:c=>"applyLoaded"in c,get:c=>c.applyLoaded},metadata:M},null,o),u.__esDecorate(t,null,F,{kind:"method",name:"setCash",static:!1,private:!1,access:{has:c=>"setCash"in c,get:c=>c.setCash},metadata:M},null,o),M&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:M})})(),t})();function oe(t){return Y(t,"instance")}function le(t){return((i,r)=>St(t)(i,r))}function ce(t,i){const r=(o,s)=>{var n;const a=typeof t=="string"?{id:t}:typeof t=="object"?t:{id:(n=s?.name)!==null&&n!==void 0?n:o?.name};R(It,a,o),_t(a)(o,s)};return typeof t=="function"?r(t,i):(o,s)=>r(o,s)}class de{}const rt=new ht;function ue(t,i){return Pt.observer((r={})=>{const{resolved:o,instance:s}=mt.useMemo(()=>{const a=Y(t)||(typeof t!="string"?{instance:new t}:void 0),l=a?.instance;return{resolved:a,instance:l}},[t]);if(mt.useEffect(()=>{if(s)return typeof s.onInit=="function"&&s.onInit(),()=>{typeof s.onDispose=="function"&&s.onDispose()}},[s]),o){const n=rt.fields(s),a=n.length>0?n:rt.fields(Object.getPrototypeOf(s));for(const l in r)if(a instanceof Array){const d=a.find(h=>h.name===l);d&&Reflect.set(s,d.originName,Reflect.get(r,l))}return R(rt.metadataKey,a,s),i(Object.assign({viewModel:s},r))}return i(Object.assign({},r))})}const Dt={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},he={load:"load",failure:"failure",ready:"ready",canceled:"canceled",disposed:"disposed"},tt=()=>{};class fe{constructor(i,r){var o,s,n,a,l,d,h;this.isExecuting=!1,this.activeCount=0,this.isCanceled=!1,this.isDisposed=!1,this.error=null,this.controllers=new Set,this.queue=[],this.runningPromise=null,this.queueTail=Promise.resolve(),this.cancelToken=0,this.fn=i,this.opt=Object.assign({concurrency:(o=r?.concurrency)!==null&&o!==void 0?o:"ignore",trackError:(s=r?.trackError)!==null&&s!==void 0?s:!0,resetErrorOnExecute:(n=r?.resetErrorOnExecute)!==null&&n!==void 0?n:!0,swallowError:(a=r?.swallowError)!==null&&a!==void 0?a:!0,abortable:(l=r?.abortable)!==null&&l!==void 0?l:!1},r),this.states=Object.assign(Object.assign({},Dt),(d=r?.states)!==null&&d!==void 0?d:{}),this.stateKeys=Object.assign(Object.assign({},he),(h=r?.stateKeys)!==null&&h!==void 0?h:{}),y.makeAutoObservable(this,{fn:!1,opt:!1,states:!1,stateKeys:!1,resolveState:!1,getScope:!1,controllers:!1,queue:!1,runningPromise:!1,queueTail:!1,cancelToken:!1},{autoBind:!0})}get canExecute(){return this.isDisposed||!(this.opt.canExecute?this.opt.canExecute(this.getScope()):!0)?!1:this.opt.concurrency==="ignore"?!this.isExecuting:!0}resolveState(i){var r,o;const s=(r=this.stateKeys[i])!==null&&r!==void 0?r:i;return(o=this.states[s])!==null&&o!==void 0?o:Dt[i]}getScope(){return{state:this.state,states:this.states,isExecuting:this.isExecuting,activeCount:this.activeCount,isCanceled:this.isCanceled,isDisposed:this.isDisposed,error:this.error}}get state(){return this.isDisposed?this.resolveState("disposed"):this.isExecuting?this.resolveState("load"):this.error?this.resolveState("failure"):this.isCanceled?this.resolveState("canceled"):this.resolveState("ready")}resetError(){this.error=null}cancel(){var i,r;this.cancelToken+=1,this.isCanceled=!0,(r=(i=this.opt).onCancel)===null||r===void 0||r.call(i),this.opt.cancelQueued&&this.clearQueue();for(const o of this.controllers)o.abort()}dispose(){this.isDisposed||(this.isDisposed=!0,this.clearQueue(),this.cancel())}clearQueue(){if(this.queue.length===0)return;const i=this.queue.splice(0,this.queue.length);for(const r of i)r.canceled=!0,r.settled||(r.settled=!0,r.resolve(void 0))}execute(...i){var r;if(this.isDisposed)return Promise.resolve(void 0);if(!this.canExecute)return(r=this.runningPromise)!==null&&r!==void 0?r:Promise.resolve(void 0);const o=n=>{this.runningPromise=n;const a=()=>{this.runningPromise===n&&(this.runningPromise=null)};return n.then(a,a),n},s=()=>u.__awaiter(this,void 0,void 0,function*(){var n,a,l,d,h,_,v,p;if(this.isDisposed)return;const b=this.opt.abortable?new AbortController:null;b&&this.controllers.add(b),y.runInAction(()=>{this.activeCount+=1,this.isExecuting=this.activeCount>0,this.isCanceled=!1,this.opt.trackError&&this.opt.resetErrorOnExecute&&(this.error=null)});const A=this.cancelToken;let O=!1,T=!1,L=null,G=null;try{(a=(n=this.opt).onStart)===null||a===void 0||a.call(n,...i);const F=this.opt.abortable?b.signal:void 0;G=this.fn(...i,F);const M=yield G;return T=this.cancelToken!==A,T?void 0:((d=(l=this.opt).onSuccess)===null||d===void 0||d.call(l,M,...i),O=!0,M)}catch(F){if(this.opt.abortable&&b?.signal.aborted){y.runInAction(()=>{this.isCanceled=!0}),T=!0,L=null;return}if(L=F,T=this.cancelToken!==A,this.opt.trackError&&y.runInAction(()=>{this.error=F}),(_=(h=this.opt).onError)===null||_===void 0||_.call(h,F),!this.opt.swallowError)throw F;return}finally{y.runInAction(()=>{this.activeCount=Math.max(0,this.activeCount-1),this.isExecuting=this.activeCount>0}),b&&this.controllers.delete(b),!T&&this.cancelToken!==A&&(T=!0),(p=(v=this.opt).onFinally)===null||p===void 0||p.call(v,{ok:O,canceled:T,error:L},...i)}});switch(this.opt.concurrency){case"parallel":return o(s());case"restart":return this.cancel(),o(s());case"queue":{const n=this.opt.queueLimit;if(typeof n=="number"&&n>0&&this.queue.length>=n)return Promise.resolve(void 0);const a={promise:Promise.resolve(void 0),resolve:tt,reject:tt,canceled:!1,settled:!1},l=this.activeCount===0&&this.queue.length===0;a.promise=new Promise((_,v)=>{a.resolve=_,a.reject=v}),this.queue.push(a);const d=()=>u.__awaiter(this,void 0,void 0,function*(){if(a.settled)return;if(a.canceled||this.isDisposed){a.settled=!0,a.resolve(void 0);return}const _=this.queue.indexOf(a);_>=0&&this.queue.splice(_,1);try{const v=yield s();a.settled||(a.settled=!0,a.resolve(v))}catch(v){a.settled||(a.settled=!0,a.reject(v))}}),h=l?d():this.queueTail.then(d,d);return this.queueTail=h.then(tt,tt),o(a.promise)}default:return this.isExecuting&&this.runningPromise?this.runningPromise:o(s())}}}function kt(t,i){return new fe(t,i)}function _e(t,i){const r=y.flow(t),o=new Set,s=i?.onCancel;return kt((...a)=>{const l=r(...a);o.add(l);const d=()=>{o.delete(l)};return l.then(d,d),new Promise((h,_)=>{l.then(h,v=>{if(y.isFlowCancellationError(v)){h(void 0);return}_(v)})})},Object.assign(Object.assign({},i),{onCancel:()=>{var a;for(const l of o)(a=l.cancel)===null||a===void 0||a.call(l);s?.()}}))}function ve(t){return function(...i){return y.runInAction(()=>t.apply(this,i))}}exports.GetService=Y;exports.GetStore=oe;exports.Inject=St;exports.InjectStore=le;exports.MakeObservable=Rt;exports.Model=wt;exports.PropFromView=Ht;exports.Service=_t;exports.SetService=Ft;exports.Store=ce;exports.StoreBase=re;exports.TODO=Et;exports.ViewModel=de;exports.asyncCommand=kt;exports.attachModelDevtools=Mt;exports.attachStoreDevtools=At;exports.commandAction=ve;exports.defineMetadata=R;exports.define_prop=Vt;exports.exclude=Gt;exports.field=Jt;exports.flowCommand=_e;exports.getExecutingFunctionNameByStack=Ot;exports.getOwnMetadata=C;exports.isSerializable=Tt;exports.submit=Xt;exports.validation=Zt;exports.view=ue;
//# sourceMappingURL=index.cjs.map
